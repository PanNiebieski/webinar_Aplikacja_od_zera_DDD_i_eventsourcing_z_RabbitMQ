<!DOCTYPE html>
<html lang="en">
<head>
    <title>Aplikacja C# od Zera EventSourcing z RabbitMQ</title>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width" />
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans:400,900&amp;subset=latin-ext" rel="stylesheet" />
    <!-- Shower Theme -->
    <link rel="stylesheet" href="vendors/shower-ribbon/styles/screen-16x9.css" />
    <link rel="stylesheet" href="vendors/shower-CezaryWalenciuk/styles/main.css" />
    <!-- Prism.js -->
    <link rel="stylesheet" href="vendors/prism/prism-my.css" />
    <link rel="stylesheet" href="vendors/prism/custom-prism.css" />
    <link rel="stylesheet" href="codegrid.css" />
</head>
<body class="shower list">
    <header class="caption">
        <h1>Aplikacja C# od Zera DDD,EventSourcing z RabbitMQ</h1>
        <p></p>
    </header>

    <section class="slide front-page">

        <div class="details">
            <!-- 1. Avatar -->


            <h2>Cezary Walenciuk</h2>

            <!-- 3. Presentation title -->
            <h2 class="bigbig"><strong style="font-size: 35px;  line-height: 1.3;">

                    <span class="titlec1">Aplikacja C# od Zera</span>
                    <br />
                    <span class="titlec5">DDD, EventSourcing z RabbitMQ</span>
                    <span class="titlec3"></span></strong></h2>



            <!-- 5. Contact the speaker -->
            <h2><a href="https://twitter.com/WalenciukC">@walenciukC</a></h2>
        </div>
        <div>


            <!-- 2. Speaker -->

        </div>
        <div class="imag">
            <img src="images/my-avatar.jpg" alt="Speaker">
        </div>
    </section>



    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">JugdeRepository</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 17px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 17px !important;">








































                        public class JugdeRepository : IJudgeRepository
                        {
                    
                            private IJudgeAddDoer _judgeAddDoer;
                            private IJudgeUpdateDoer _judgeUpdateDoer;
                            private IJudgeDeleteDoer _judgeDeleteDoer;
                            private IJudgeGetAllDoer _judgeGetAllDoer;
                            private IJudgeGetByIdDoer _judgeGetByIdDoer;
                    
                    
                            public JugdeRepository(IJudgeAddDoer judgeAddDoer,
                                IJudgeUpdateDoer judgeUpdateDoer, IJudgeDeleteDoer judgeDeleteDoer,
                                IJudgeGetAllDoer judgeGetAllDoer, IJudgeGetByIdDoer judgeGetByIdDoer)
                            {
                                _judgeAddDoer = judgeAddDoer;
                                _judgeUpdateDoer = judgeUpdateDoer;
                                _judgeDeleteDoer = judgeDeleteDoer;
                                _judgeGetAllDoer = judgeGetAllDoer;
                                _judgeGetByIdDoer = judgeGetByIdDoer;
                            }
                    
                            public void ChangeContext(IGeekLemonDBContext geekLemonDB)
                            {
                                _judgeAddDoer.ChangeDBContext(geekLemonDB);
                                _judgeUpdateDoer.ChangeDBContext(geekLemonDB);
                                _judgeDeleteDoer.ChangeDBContext(geekLemonDB);
                                _judgeGetAllDoer.ChangeDBContext(geekLemonDB);
                                _judgeGetByIdDoer.ChangeDBContext(geekLemonDB);
                            }
                    
                            public Task&lt;ExecutionStatus&lt;JudgeIds&gt;&gt; AddAsync(Judge entity)
                            {
                                return _judgeAddDoer.Run(entity);
                            }
                    
                            public Task&lt;ExecutionStatus&gt; DeleteAsync(JudgeId entity)
                            {
                                return _judgeDeleteDoer.Run(entity);
                            }
                    
                            public Task&lt;ExecutionStatus&gt; DeleteAsync(JudgeUniqueId id)
                            {
                                return _judgeDeleteDoer.Run(id);
                            }
                    
                            public Task&lt;ExecutionStatus&lt;IReadOnlyList&lt;Judge&gt;&gt;&gt; GetAllAsync()
                            {
                                return _judgeGetAllDoer.Run();
                            }
                    
                            public Task&lt;ExecutionStatus&lt;Judge&gt;&gt; GetByIdAsync(JudgeId id)
                            {
                                return _judgeGetByIdDoer.Run(id);
                            }
                    
                            public Task&lt;ExecutionStatus&lt;Judge&gt;&gt; GetByIdAsync(JudgeUniqueId id)
                            {
                                return _judgeGetByIdDoer.Run(id);
                            }
                    
                            public Task&lt;ExecutionStatus&gt; UpdateByUniqueIdAsync(Judge entity)
                            {
                                return _judgeUpdateDoer.Run(entity, ByWhatId.UniqueId);
                            }
                    
                            public Task&lt;ExecutionStatus&gt; UpdateByIdAsync(Judge entity)
                            {
                                return _judgeUpdateDoer.Run(entity, ByWhatId.CreatedId);
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CallForSpeechRepository</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 17px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 17px !important;">





































































                        public class CallForSpeechRepository : ICallForSpeechRepository
                        {
                            private ICallForSpeechGetByIdDoer _callForSpeechGetByIdDoer;
                            private ICallForSpeechGetCollectionDoer _callForSpeechGetCollectionDoer;
                            private ICallForSpeechSaveAcceptenceDoer _callForSpeechSaveAcceptenceDoer;
                            private ICallForSpeechSaveEvaluatationDoer _callForSpeechSaveEvaluatationDoer;
                            private ICallForSpeechSavePreliminaryAcceptenceDoer _callForSpeechSavePreliminaryAcceptenceDoer;
                            private ICallForSpeechSaveRejectionDoer _callForSpeechSaveRejectionDoer;
                            private ICallForSpeechSubmitDoer _callForSpeechSubmitDoer;
                        
                            public CallForSpeechRepository(ICallForSpeechGetByIdDoer callForSpeechGetByIdDoer,
                                ICallForSpeechGetCollectionDoer callForSpeechGetCollectionDoer,
                                ICallForSpeechSaveAcceptenceDoer callForSpeechSaveAcceptenceDoer,
                                ICallForSpeechSaveEvaluatationDoer callForSpeechSaveEvaluatationDoer,
                                ICallForSpeechSavePreliminaryAcceptenceDoer callForSpeechSavePreliminaryAcceptenceDoer,
                                ICallForSpeechSaveRejectionDoer callForSpeechSaveRejectionDoer,
                                ICallForSpeechSubmitDoer callForSpeechSubmitDoer)
                            {
                                _callForSpeechGetByIdDoer = callForSpeechGetByIdDoer;
                                _callForSpeechGetCollectionDoer = callForSpeechGetCollectionDoer;
                                _callForSpeechSaveAcceptenceDoer = callForSpeechSaveAcceptenceDoer;
                                _callForSpeechSaveEvaluatationDoer = callForSpeechSaveEvaluatationDoer;
                                _callForSpeechSavePreliminaryAcceptenceDoer = callForSpeechSavePreliminaryAcceptenceDoer;
                                _callForSpeechSaveRejectionDoer = callForSpeechSaveRejectionDoer;
                                _callForSpeechSubmitDoer = callForSpeechSubmitDoer;
                            }
                        
                            public void ChangeContext(IGeekLemonDBContext geekLemonDB)
                            {
                                _callForSpeechGetByIdDoer.ChangeDBContext(geekLemonDB);
                                _callForSpeechGetCollectionDoer.ChangeDBContext(geekLemonDB);
                                _callForSpeechSaveAcceptenceDoer.ChangeDBContext(geekLemonDB);
                                _callForSpeechSaveEvaluatationDoer.ChangeDBContext(geekLemonDB);
                                _callForSpeechSavePreliminaryAcceptenceDoer.ChangeDBContext(geekLemonDB);
                                _callForSpeechSaveRejectionDoer.ChangeDBContext(geekLemonDB);
                                _callForSpeechSubmitDoer.ChangeDBContext(geekLemonDB);
                            }
                        
                            public Task&lt;ExecutionStatus&lt;CallForSpeech&gt;&gt; GetByIdAsync(CallForSpeechId id)
                            {
                                return _callForSpeechGetByIdDoer.Run(id);
                            }
                        
                            public Task&lt;ExecutionStatus&lt;CallForSpeech&gt;&gt; GetByIdAsync(CallForSpeechUniqueId id)
                            {
                                return _callForSpeechGetByIdDoer.Run(id);
                            }
                        
                            public Task&lt;ExecutionStatus&lt;IReadOnlyList&lt;CallForSpeech&gt;&gt;&gt; GetCollectionAsync(FilterCallForSpeechStyles filtrer)
                            {
                                return _callForSpeechGetCollectionDoer.Run(filtrer);
                            }
                        
                            public Task&lt;ExecutionStatus&gt; SaveAcceptenceAsync(CallForSpeechId id, JudgeId judge, CallForSpeechStatus status)
                            {
                                return _callForSpeechSaveAcceptenceDoer.Run(id, judge, status);
                            }
                        
                            public Task&lt;ExecutionStatus&gt; SaveAcceptenceAsync(CallForSpeechUniqueId id, JudgeId judge, CallForSpeechStatus status)
                            {
                                return _callForSpeechSaveAcceptenceDoer.Run(id, judge, status);
                            }
                        
                            public Task&lt;ExecutionStatus&gt; SaveEvaluatationAsync(CallForSpeechId id, CallForSpeechScoringResult score, CallForSpeechStatus status)
                            {
                                return _callForSpeechSaveEvaluatationDoer.Run(id, score, status);
                            }
                        
                            public Task&lt;ExecutionStatus&gt; SaveEvaluatationAsync(CallForSpeechUniqueId id, CallForSpeechScoringResult score, CallForSpeechStatus status)
                            {
                                return _callForSpeechSaveEvaluatationDoer.Run(id, score, status);
                            }
                        
                            public Task&lt;ExecutionStatus&gt; SavePreliminaryAcceptenceAsync(CallForSpeechId id, JudgeId judge, CallForSpeechStatus status)
                            {
                                return _callForSpeechSavePreliminaryAcceptenceDoer.Run(id, judge, status);
                            }
                        
                            public Task&lt;ExecutionStatus&gt; SavePreliminaryAcceptenceAsync(CallForSpeechUniqueId id, JudgeId judge, CallForSpeechStatus status)
                            {
                                return _callForSpeechSavePreliminaryAcceptenceDoer.Run(id, judge, status);
                            }
                        
                            public Task&lt;ExecutionStatus&gt; SaveRejectionAsync(CallForSpeechId id, JudgeId judge, CallForSpeechStatus status)
                            {
                                return _callForSpeechSaveRejectionDoer.Run(id, judge, status);
                            }
                        
                            public Task&lt;ExecutionStatus&gt; SaveRejectionAsync(CallForSpeechUniqueId id, JudgeId judge, CallForSpeechStatus status)
                            {
                                return _callForSpeechSaveRejectionDoer.Run(id, judge, status);
                            }
                        
                            public Task&lt;ExecutionStatus&lt;CallForSpeechIds&gt;&gt; SubmitAsync(CallForSpeech callForSpeech)
                            {
                                return _callForSpeechSubmitDoer.Run(callForSpeech);
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide creamPPPGragient">
        <span class="shout colors" ><span>Pokaż mi repozytoria do bazy na ścieżce EventSourcing
        </span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">ZEsCategoryRepository</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">




                        public class ZEsCategoryRepository : CategoryRepository, IZEsCategoryRepository
                        {
                        
                        
                            public ZEsCategoryRepository(ICategoryAddDoer categoryAddDoer,
                                ICategoryGetAllDoer categoryGetAllDoer, ICategoryDeleteDoer categoryDeleteDoer,
                                ICategoryGetByIdDoer categoryGetByIdDoer, ICategoryUpdateDoer categoryUpdateDoer,
                                IZEsGeekLemonDBContext zEsGeekLemonDBContext)
                                : base(categoryAddDoer, categoryGetAllDoer, categoryDeleteDoer, categoryGetByIdDoer,
                                     categoryUpdateDoer)
                        
                            {
                                GeekLemonDBContext context =
                                    new GeekLemonDBContext(zEsGeekLemonDBContext.ConnectionString);
                        
                                this.ChangeContext(context);
                            }
                        
                        
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">ZEsJugdeRepository</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">





                        public class ZEsJugdeRepository : JugdeRepository, IZEsJudgeRepository
                        {
                    
                            public ZEsJugdeRepository(IJudgeAddDoer judgeAddDoer,
                                IJudgeUpdateDoer judgeUpdateDoer, IJudgeDeleteDoer judgeDeleteDoer,
                                IJudgeGetAllDoer judgeGetAllDoer, IJudgeGetByIdDoer judgeGetByIdDoer,
                                IZEsGeekLemonDBContext zEsGeekLemonDBContext)
                                : base(judgeAddDoer, judgeUpdateDoer, judgeDeleteDoer, judgeGetAllDoer,
                                      judgeGetByIdDoer)
                            {
                                GeekLemonDBContext context =
                                    new GeekLemonDBContext(zEsGeekLemonDBContext.ConnectionString);
                    
                                this.ChangeContext(context);
                            }
                    
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">ZEsCallForSpeechRepository</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">





                        public class ZEsCallForSpeechRepository : CallForSpeechRepository,
                        IZEsCallForSpeechRepository
                        {
                    
                            public ZEsCallForSpeechRepository(ICallForSpeechGetByIdDoer callForSpeechGetByIdDoer,
                                ICallForSpeechGetCollectionDoer callForSpeechGetCollectionDoer,
                                ICallForSpeechSaveAcceptenceDoer callForSpeechSaveAcceptenceDoer,
                                ICallForSpeechSaveEvaluatationDoer callForSpeechSaveEvaluatationDoer,
                                ICallForSpeechSavePreliminaryAcceptenceDoer callForSpeechSavePreliminaryAcceptenceDoer,
                                ICallForSpeechSaveRejectionDoer callForSpeechSaveRejectionDoer,
                                ICallForSpeechSubmitDoer callForSpeechSubmitDoer,
                                IZEsGeekLemonDBContext _zEsGeekLemonDBContext)
                                : base(callForSpeechGetByIdDoer, callForSpeechGetCollectionDoer,
                                    callForSpeechSaveAcceptenceDoer, callForSpeechSaveEvaluatationDoer,
                                    callForSpeechSavePreliminaryAcceptenceDoer, callForSpeechSaveRejectionDoer,
                                    callForSpeechSubmitDoer)
                            {
                                GeekLemonDBContext context =
                                    new GeekLemonDBContext(_zEsGeekLemonDBContext.ConnectionString);
                    
                                this.ChangeContext(context);
                    
                            }
                    
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>

    <section class="slide creamPPPGragient">
        <span class="shout colors" ><span>Problem mapowania w Dapper
            <BR /> Trzeba napisać to samemu
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/infra/cat.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CategoryAddDoer</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">


















                        









                        









                        public class CategoryAddDoer
                        : BeforeDoer, ICategoryAddDoer
                        {
                        
                            private readonly IMapper _mapper;
                        
                            public CategoryAddDoer
                                (IGeekLemonDBContext geekLemonContext,
                                IMapper mapper)
                            {
                                _geekLemonContext = geekLemonContext;
                                _mapper = mapper;
                            }
                        
                            public async Task&lt;ExecutionStatus&lt;CategoryIds&gt;&gt; Run(Category entity)
                            {
                                using var connection = new SqliteConnection(_geekLemonContext.ConnectionString);
                        
                                //Nie ma SQL INjection
                                var q = @&quot;INSERT INTO Categories(Name, DisplayName, WhatWeAreLookingFor
                                    ,UniqueId, Version)
                                    VALUES (@Name, @DisplayName, @WhatWeAreLookingFor,@UniqueId, @Version);
                                    SELECT seq From sqlite_sequence Where Name=&#39;Categories&#39;&quot;;
                        
                                try
                                {
                                    var result = await connection.QueryAsync&lt;int&gt;(q,
                                    new
                                    {
                                        @Name = entity.Name,
                                        @DisplayName = entity.DisplayName,
                                        @WhatWeAreLookingFor = entity.WhatWeAreLookingFor,
                                        @UniqueId = entity.UniqueId.Value.ToString(),
                                        @Version = entity.Version,
                                    });
                        
                                    //var cmd = connection.CreateCommand();
                                    //cmd.CommandText = &quot;SELECT last_insert_rowid()&quot;;
                                    //Int64 i = (Int64)cmd.ExecuteScalar();
                        
                                    int createdId = result.FirstOrDefault();
                        
                                    CategoryIds ids = new CategoryIds()
                                    {
                                        CreatedId = new CategoryId(createdId),
                                        UniqueId = entity.UniqueId
                                    };
                        
                                    return ExecutionStatus
                                        &lt;CategoryIds&gt;
                                        .DbOk(ids);
                                }
                                catch (Exception ex)
                                {
                                    if (ExecutionFlow.Options.ThrowExceptions)
                                        throw;
                        
                                    return ExecutionStatus
                                        &lt;CategoryIds&gt;
                                        .DbError(ex);
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CategoryDeleteDoer</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        







































                        public class CategoryDeleteDoer : BeforeDoer, ICategoryDeleteDoer
                        {
                        
                            private readonly IMapper _mapper;
                        
                            public CategoryDeleteDoer
                                (IGeekLemonDBContext geekLemonContext,
                                IMapper mapper)
                            {
                                _geekLemonContext = geekLemonContext;
                                _mapper = mapper;
                            }
                        
                            public async Task&lt;ExecutionStatus&gt; Run(CategoryId categoryId)
                            {
                                using var connection = new SqliteConnection(_geekLemonContext.ConnectionString);
                        
                                var q = @&quot;DELETE FROM Categories WHERE Id=@Id;&quot;;
                        
                                try
                                {
                                    var result = await connection.QueryAsync&lt;int&gt;(q,
                                     new
                                     {
                                         @Id = categoryId.Value
                                     });
                                }
                                catch (Exception ex)
                                {
                                    if (ExecutionFlow.Options.ThrowExceptions)
                                        throw;
                        
                                    return ExecutionStatus.DbError(ex);
                                }
                        
                                return ExecutionStatus.DbOk();
                            }
                        
                            public async Task&lt;ExecutionStatus&gt; Run(CategoryUniqueId categoryId)
                            {
                                using var connection = new SqliteConnection(_geekLemonContext.ConnectionString);
                        
                                var q = @&quot;DELETE FROM Categories WHERE UniqueId=@UniqueId;&quot;;
                        
                                try
                                {
                                    var result = await connection.QueryAsync&lt;int&gt;(q,
                                     new
                                     {
                                         @UniqueId = categoryId.Value.ToString()
                                     });
                                }
                                catch (Exception ex)
                                {
                                    if (ExecutionFlow.Options.ThrowExceptions)
                                        throw;
                        
                                    return ExecutionStatus.DbError(ex);
                                }
                        
                                return ExecutionStatus.DbOk();
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CategoryGetAllDoer</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        













                        public class CategoryGetAllDoer : BeforeDoer, ICategoryGetAllDoer
                        {
                        
                            private readonly IMapper _mapper;
                        
                            public CategoryGetAllDoer
                                (IGeekLemonDBContext geekLemonContext,
                                IMapper mapper)
                            {
                                _geekLemonContext = geekLemonContext;
                                _mapper = mapper;
                            }
                        
                            public async Task&lt;ExecutionStatus&lt;IReadOnlyList&lt;Category&gt;&gt;&gt; Run()
                            {
                                using var connection = new SqliteConnection
                                    (_geekLemonContext.ConnectionString);
                        
                                try
                                {
                                    var r = await connection.QueryAsync&lt;CategoryTemp&gt;
                                    (@&quot;SELECT Id, DisplayName, Name ,
                                    WhatWeAreLookingFor,UniqueId ,Version FROM Categories;&quot;);
                        
                                    var rmaped = _mapper.Map&lt;IEnumerable&lt;Category&gt;&gt;(r);
                        
                                    return ExecutionStatus&lt;IReadOnlyList&lt;Category&gt;&gt;
                                        .DbIfDefaultThenError
                                        (rmaped.ToList().AsReadOnly());
                                }
                                catch (Exception ex)
                                {
                                    return ExecutionStatus&lt;IReadOnlyList&lt;Category&gt;&gt;
                                        .DbError(ex);
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CategoryGetByIdDoer</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">


























                        

























                        public class CategoryGetByIdDoer : BeforeDoer, ICategoryGetByIdDoer
                        {
                        
                            private readonly IMapper _mapper;
                        
                            public CategoryGetByIdDoer
                                (IGeekLemonDBContext geekLemonContext,
                                IMapper mapper)
                            {
                                _geekLemonContext = geekLemonContext;
                                _mapper = mapper;
                            }
                        
                            public async Task&lt;ExecutionStatus&lt;Category&gt;&gt; Run(CategoryUniqueId categoryId)
                            {
                                using var connection = new SqliteConnection
                                    (_geekLemonContext.ConnectionString);
                        
                                var q = @&quot;SELECT Id, DisplayName, Name,
                                    WhatWeAreLookingFor,UniqueId ,Version  FROM Categories
                                    Where UniqueId = @UniqueId&quot;;
                        
                                try
                                {
                                    var r = await connection.
                                    QueryFirstOrDefaultAsync&lt;CategoryTemp&gt;
                                    (q, new
                                    {
                                        @UniqueId = categoryId.Value.ToString(),
                                    });
                        
                                    var rmaped = _mapper.Map&lt;Category&gt;(r);
                        
                                    return ExecutionStatus&lt;Category&gt;.
                                        DbIfDefaultThenError(rmaped);
                                }
                                catch (Exception ex)
                                {
                                    return ExecutionStatus&lt;Category&gt;.DbError(ex);
                                }
                            }
                        
                            public async Task&lt;ExecutionStatus&lt;Category&gt;&gt; Run(CategoryId categoryId)
                            {
                                using var connection = new SqliteConnection
                                    (_geekLemonContext.ConnectionString);
                        
                                var q = @&quot;SELECT Id, DisplayName, Name,
                                    WhatWeAreLookingFor,UniqueId ,Version  FROM Categories
                                    Where Id = @Id&quot;;
                        
                                try
                                {
                                    var r = await connection.
                                    QueryFirstOrDefaultAsync&lt;CategoryTemp&gt;
                                    (q, new
                                    {
                                        @Id = categoryId.Value,
                                    });
                        
                                    var rmaped = _mapper.Map&lt;Category&gt;(r);
                        
                                    return ExecutionStatus&lt;Category&gt;.DbIfDefaultThenError(rmaped);
                                }
                                catch (Exception ex)
                                {
                                    return ExecutionStatus&lt;Category&gt;.DbError(ex);
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CategoryUpdateDoer</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">





























                        public class CategoryUpdateDoer : BeforeDoer, ICategoryUpdateDoer
                        {
                            private readonly IMapper _mapper;
                        
                            public CategoryUpdateDoer
                                (IGeekLemonDBContext geekLemonContext,
                                IMapper mapper)
                            {
                                _geekLemonContext = geekLemonContext;
                                _mapper = mapper;
                            }
                        
                            public async Task&lt;ExecutionStatus&gt; Run(Category entity, ByWhatId byWhatId)
                            {
                                using var connection = new SqliteConnection(_geekLemonContext.ConnectionString);
                        
                                //Nie ma SQL INjection
                                var q1 = @&quot;UPDATE Categories 
                                    SET Name = @Name, DisplayName = @DisplayName, WhatWeAreLookingFor=@WhatWeAreLookingFor
                                    ,Version = @Version
                                    WHERE UniqueId = @UniqueId; &quot;;
                        
                                var q = @&quot;UPDATE Categories 
                                    SET Name = @Name, DisplayName = @DisplayName, WhatWeAreLookingFor=@WhatWeAreLookingFor
                                    ,Version = @Version
                                    WHERE Id = @Id; &quot;;
                                try
                                {
                                    if (byWhatId == ByWhatId.UniqueId)
                                        q = q1;
                        
                                    var result = await connection.QueryAsync&lt;int&gt;(q,
                                     new
                                     {
                                         @UniqueId = entity.UniqueId.Value.ToString(),
                                         @Id = entity.Id.Value,
                                         @Name = entity.Name,
                                         @Version = entity.Version,
                                         @DisplayName = entity.DisplayName,
                                         @WhatWeAreLookingFor = entity.WhatWeAreLookingFor
                                     });
                        
                                    return ExecutionStatus.DbOk();
                                }
                                catch (Exception ex)
                                {
                                    if (ExecutionFlow.Options.ThrowExceptions)
                                        throw;
                        
                                    return ExecutionStatus.DbError(ex);
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>

    <section class="slide creamPPPGragient">
        <span class="shout colors" >Na razie nie ma problemu z mapowaniem ponieważ kolumny i właściwości nazywają się tak samo
        </span>
    </section>
  
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/infra/cat.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/infra/jud.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/infra/call.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamPPPGragient">
        <span class="shout colors" >Na pomoc przychodzą klasy tymczasowe i automapper
        </span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/infra/03.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CallForSpeechTemp</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
















                        












                        public class CallForSpeechTemp
                        {
                            public int Id { get; set; }
                            public string UniqueId { get; set; }
                            public int Version { get; set; }
                        
                            public string Number { get; set; }
                            public int Status { get; set; }
                        
                            public string PreliminaryDecision_Date { get; set; }
                            public int? PreliminaryDecision_DecisionBy { get; set; }
                        
                            public string FinalDecision_Date { get; set; }
                            public int? FinalDecision_DecisionBy { get; set; }
                        
                            public string Speaker_Name_First { get; set; }
                            public string Speaker_Name_Last { get; set; }
                            public string Speaker_Adress_Country { get; set; }
                            public string Speaker_Adress_ZipCode { get; set; }
                            public string Speaker_Adress_City { get; set; }
                            public string Speaker_Adress_Street { get; set; }
                            public string Speaker_Websites_Facebook { get; set; }
                            public string Speaker_Websites_Twitter { get; set; }
                            public string Speaker_Websites_Instagram { get; set; }
                            public string Speaker_Websites_LinkedIn { get; set; }
                            public string Speaker_Websites_TikTok { get; set; }
                            public string Speaker_Websites_Youtube { get; set; }
                            public string Speaker_Websites_FanPageOnFacebook { get; set; }
                            public string Speaker_Websites_GitHub { get; set; }
                            public string Speaker_Websites_Blog { get; set; }
                            public string Speaker_BIO { get; set; }
                            public string Speaker_Contact_Phone { get; set; }
                            public string Speaker_Contact_Email { get; set; }
                            public string Speaker_Birthdate { get; set; }
                        
                            public string Speech_Title { get; set; }
                            public string Speech_Description { get; set; }
                            public string Speech_Tags { get; set; }
                            public int Speech_ForWhichAudience { get; set; }
                            public int Speech_TechnologyOrBussinessStory { get; set; }
                            public string Registration_RegistrationDate { get; set; }
                            public int CategoryId { get; set; }
                            public int Score_Score { get; set; }
                        
                            public string Score_RejectExplanation { get; set; }
                            public string Score_WarringExplanation { get; set; }
                        
                            public string Category_DisplayName { get; set; }
                            public string Category_WhatWeAreLookingFor { get; set; }
                            public string Category_Name { get; set; }
                        
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">JudgeTemp</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        public class JudgeTemp
                        {
                            public int Id { get; set; }
                            public string UniqueId { get; set; }
                            public int Version { get; set; }
                        
                            public string Login { get; set; }
                            public string Password { get; set; }
                            public string BirthDate { get; set; }
                            public string Name_First { get; set; }
                            public string Name_Last { get; set; }
                            public string Email_ForeConference { get; set; }
                            public string Email_ForSpeakers { get; set; }
                            public string Phone_ForSpekers { get; set; }
                            public string Phone_ForConference { get; set; }
                            public int CategoryId { get; set; }
                        
                            public string Category_DisplayName { get; set; }
                            public string Category_WhatWeAreLookingFor { get; set; }
                            public string Category_Name { get; set; }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">MappingProfile</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        public class MappingProfile : Profile
                        {
                            public MappingProfile()
                            {
                                CreateMap&lt;CallForSpeech, CallForSpeechTemp&gt;().
                                    ConvertUsing(new CallForSpeechTempTypeConverter());
                                CreateMap&lt;CallForSpeechTemp, CallForSpeech&gt;().
                                    ConvertUsing(new CallForSpeechTypeConverter());
                        
                                CreateMap&lt;Category, CategoryTemp&gt;();
                                CreateMap&lt;CategoryTemp, Category&gt;();
                                CreateMap&lt;CategoryId, int&gt;().ConstructUsing(k =&gt; k.Value);
                                CreateMap&lt;int, CategoryId&gt;().ConstructUsing(k =&gt; new CategoryId(k));
                                CreateMap&lt;CategoryUniqueId, string&gt;().ConstructUsing(k =&gt; k.Value.ToString());
                                CreateMap&lt;string, CategoryUniqueId&gt;().
                                    ConstructUsing(k =&gt; new CategoryUniqueId(Guid.Parse(k)));
                        
                                CreateMap&lt;JudgeTemp, Judge&gt;().
                                    ConvertUsing(new JudgeTypeConverter());
                                CreateMap&lt;Judge, JudgeTemp&gt;().
                                    ConvertUsing(new JudgeTempTypeConverter());
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>

    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CallForSpeechTempTypeConverter</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 16px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 16px !important;">
































                        public class CallForSpeechTempTypeConverter : 
                        ITypeConverter&lt;CallForSpeech, CallForSpeechTemp&gt;
                        {
                            public CallForSpeechTemp Convert(CallForSpeech source, CallForSpeechTemp destination, ResolutionContext context)
                            {
                                CallForSpeechTemp sc = new CallForSpeechTemp();
                    
                                sc.CategoryId = source.Category.Id.Value;
                                sc.Number = source.Number.Number;
                                sc.Category_DisplayName = source.Category.DisplayName;
                                sc.Category_Name = source.Category.Name;
                                sc.Category_WhatWeAreLookingFor = source.Category.WhatWeAreLookingFor;
                                sc.FinalDecision_Date = source.FinalDecision?.DecisionDate.ToString(&quot;yyyy-MM-dd HH:mm:ss.fff&quot;,
                                                            CultureInfo.InvariantCulture);
                                sc.FinalDecision_DecisionBy = source.FinalDecision?.DecisionBy?.Value;
                                sc.PreliminaryDecision_Date = source.PreliminaryDecision?.DecisionDate.ToString(&quot;yyyy-MM-dd HH:mm:ss.fff&quot;,
                                                            CultureInfo.InvariantCulture);
                                sc.PreliminaryDecision_DecisionBy = source.PreliminaryDecision?.DecisionBy?.Value;
                                sc.Registration_RegistrationDate = source.Registration.RegistrationDate.ToString(&quot;yyyy-MM-dd HH:mm:ss.fff&quot;,
                                                            CultureInfo.InvariantCulture);
                                sc.Score_RejectExplanation = source.Score?.RejectExplanation;
                                sc.Score_WarringExplanation = source.Score?.WarringExplanation;
                                sc.Score_Score = (int)(source.Score?.Score ?? 0);
                    
                                if (source.Id != null)
                                    sc.Id = source.Id.Value;
                    
                                sc.Speaker_Adress_City = source.Speaker.Address.City;
                                sc.Speaker_Adress_Country = source.Speaker.Address.Country;
                                sc.Speaker_Adress_Street = source.Speaker.Address.Street;
                                sc.Speaker_Adress_ZipCode = source.Speaker.Address.ZipCode;
                                sc.Speaker_BIO = source.Speaker.Biography;
                                sc.Speaker_Birthdate = source.Speaker.Birthdate.ToString(&quot;dd-MM-yyyy&quot;);
                                sc.Speaker_Contact_Email = source.Speaker.Contact.Email;
                                sc.Speaker_Name_First = source.Speaker.Name.First;
                                sc.Speaker_Name_Last = source.Speaker.Name.Last;
                                sc.Speaker_Contact_Phone = source.Speaker.Contact.Phone;
                                sc.Speaker_Websites_Blog = source.Speaker.SpeakerWebsites.Blog;
                                sc.Speaker_Websites_Facebook = source.Speaker.SpeakerWebsites.Blog;
                                sc.Speaker_Websites_FanPageOnFacebook = source.Speaker.SpeakerWebsites.Blog;
                                sc.Speaker_Websites_GitHub = source.Speaker.SpeakerWebsites.Blog;
                                sc.Speaker_Websites_Instagram = source.Speaker.SpeakerWebsites.Blog;
                                sc.Speaker_Websites_LinkedIn = source.Speaker.SpeakerWebsites.Blog;
                                sc.Speaker_Websites_TikTok = source.Speaker.SpeakerWebsites.Blog;
                                sc.Speaker_Websites_Twitter = source.Speaker.SpeakerWebsites.Blog;
                                sc.Speaker_Websites_Youtube = source.Speaker.SpeakerWebsites.Blog;
                                sc.Speech_Description = source.Speech.Description;
                                sc.Speech_ForWhichAudience = (int)source.Speech.ForWhichAudience;
                                sc.Speech_Tags = string.Join(&quot;,&quot;, source.Speech.Tags);
                                sc.Speech_TechnologyOrBussinessStory = (int)source.Speech.TechnologyOrBussinessStory;
                                sc.Speech_Title = source.Speech.Description;
                                sc.Version = source.Version;
                                sc.UniqueId = source.UniqueId.Value.ToString();
                                sc.Status = (int)source.Status;
                    
                    
                    
                    
                                return sc;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">ByWhatId</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 16px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 16px !important;">

                        

















































































                        public class CallForSpeechTypeConverter : ITypeConverter&lt;CallForSpeechTemp, CallForSpeech&gt;
                        {
                            public CallForSpeech Convert(CallForSpeechTemp source, CallForSpeech destination, ResolutionContext context)
                            {
                                Category c = new Category(new CategoryId(source.CategoryId))
                                {
                                    DisplayName = source.Category_DisplayName,
                                    Name = source.Category_DisplayName,
                                    WhatWeAreLookingFor = source.Category_WhatWeAreLookingFor,
                                };
                    
                                SpeakerWebsites socialMedia = new SpeakerWebsites()
                                {
                                    Blog = source.Speaker_Websites_Blog,
                                    Facebook = source.Speaker_Websites_Facebook,
                                    FanPageOnFacebook = source.Speaker_Websites_FanPageOnFacebook,
                                    GitHub = source.Speaker_Websites_GitHub,
                                    Instagram = source.Speaker_Websites_Instagram,
                                    LinkedIN = source.Speaker_Websites_LinkedIn,
                                    TikTok = source.Speaker_Websites_TikTok,
                                    Twitter = source.Speaker_Websites_Twitter,
                                    YouTube = source.Speaker_Websites_Youtube
                                };
                    
                                Address address = new Address
                                    (
                                        source.Speaker_Adress_Country,
                                        source.Speaker_Adress_ZipCode,
                                        source.Speaker_Adress_Street,
                                        source.Speaker_Adress_City
                                    );
                    
                                Name name = new Name(
                                    source.Speaker_Name_First,
                                    source.Speaker_Name_Last);
                    
                                DateTime dateTime;
                                bool C = DateTime.TryParse(source.Speaker_Birthdate, out dateTime);
                    
                    
                                Contact cc = new Contact(source.Speaker_Contact_Email,
                                    source.Speaker_Contact_Phone);
                                Speaker speaker = new Speaker(name, dateTime, address, socialMedia
                                    , source.Speaker_BIO, cc);
                    
                    
                                CallForSpeechNumber callForSpeechNumber = new CallForSpeechNumber
                                    (source.Number);
                    
                                Speech speech = new Speech(source.Speech_Title, source.Speech_Description,
                                    source.Speech_Tags.Split(&quot;,&quot;),
                                    (ForWhichAudience)source.Speech_ForWhichAudience,
                                    (TechnologyOrBussinessStory)source.Speech_TechnologyOrBussinessStory);
                    
                                CallForSpeechStatus status = (CallForSpeechStatus)source.Status;
                    
                    
                                CallForSpeechMachineScore callForSpeechMachineScore =
                                    (CallForSpeechMachineScore)source.Score_Score;
                    
                    
                    
                                CallForSpeechScoringResult res =
                                    new CallForSpeechScoringResult(callForSpeechMachineScore,
                                    source.Score_RejectExplanation, source.Score_WarringExplanation);
                    
                                DateTime dateTime2 = DateTime.Parse(source.Registration_RegistrationDate);
                                Registration registration = new Registration(dateTime2);
                    
                                Decision decisionPreminal = null;
                                try
                                {
                                    DateTime dateTime3 = DateTime.Parse(source.PreliminaryDecision_Date);
                                    decisionPreminal =
                                        new Decision(dateTime3, new JudgeId(source.PreliminaryDecision_DecisionBy.Value));
                    
                                }
                                catch (Exception)
                                {
                    
                                }
                    
                                Decision decisionFinal = null;
                                try
                                {
                                    DateTime dateTime4 = DateTime.Parse(source.FinalDecision_Date);
                                    decisionFinal =
                                        new Decision(dateTime4, new JudgeId(source.FinalDecision_DecisionBy.Value));
                    
                                }
                                catch (Exception)
                                {
                    
                                }
                    
                                CallForSpeech sc = new CallForSpeech(callForSpeechNumber, status, speaker, speech, c,
                                    res, registration,
                                    decisionPreminal, decisionFinal, new CallForSpeechId(source.Id));
                    
                                if (source.UniqueId != &quot;&quot;)
                                    sc.UniqueId = new CallForSpeechUniqueId(Guid.Parse(source.UniqueId));
                    
                                sc.Version = source.Version;
                    
                                return sc;
                    
                    
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">JudgeTempTypeConverter</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
















                        public class JudgeTempTypeConverter : ITypeConverter&lt;Judge, JudgeTemp&gt;
                        {
                            private class ValuesFromJugde
                            {
                                public string Birthdate { get; set; }
                                public string EmailForeConference { get; set; }
                                public string EmailForSpeakers { get; set; }
                                public string PhoneForSpekers { get; set; }
                                public string PhoneForConference { get; set; }
                            }
                        
                            public JudgeTemp Convert(Judge source, JudgeTemp destination, ResolutionContext context)
                            {
                                var birthdate = source.Birthdate.ToString(&quot;dd-MM-yyyy&quot;);
                         
                        
                                int id = 0;
                        
                                if (source.Id != null)
                                    id = source.Id.Value;
                        
                                string uniqueId = &quot;&quot;;
                        
                                if (source.UniqueId != null)
                                    uniqueId = source.UniqueId.Value.ToString();
                        
                                JudgeTemp j = new JudgeTemp()
                                {
                                    Id = id,
                                    BirthDate = birthdate,
                                    CategoryId = source.Category.Id.Value,
                                    Login = source.Login,
                                    Name_First = source.Name.First,
                                    Name_Last = source.Name.Last,
                                    Password = source.Password,
                                    Version = source.Version,
                                    UniqueId = uniqueId,
                                };
                        
                                return j;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">JudgeTypeConverter</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">

                        













                        public class JudgeTypeConverter : ITypeConverter&lt;JudgeTemp, Judge&gt;
                        {
                            public Judge Convert(JudgeTemp source, Judge destination, ResolutionContext context)
                            {
                                Category c = new Category(new CategoryId(source.CategoryId))
                                {
                                    DisplayName = source.Category_DisplayName,
                                    Name = source.Category_Name,
                                    WhatWeAreLookingFor = source.Category_WhatWeAreLookingFor,
                                };
                        
                        
                        
                                Login login = new Login(source.Login);
                                Password password = new Password(source.Password);
                        
                                Name name = new Name(source.Name_First, source.Name_Last);
                        
                                Judge j = new Judge(source.Id, login, password, name, c);
                        
                        
                        
                                j.Birthdate = DateTime.Parse(source.BirthDate);
                        
                        
                        
                                if (source.UniqueId != &quot;&quot;)
                                    j.UniqueId = new JudgeUniqueId(Guid.Parse(source.UniqueId));
                                j.Version = source.Version;
                        
                                return j;
                            }

                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide creamPPPGragient">
        <span class="shout colors" ><span>Zobaczmy jak te klasy tymczasowe nam pomagają
        </span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">JudgeAddDoer</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">















                        














                        















                        public class JudgeAddDoer : BeforeDoer, IJudgeAddDoer
                        {
                            private readonly IMapper _mapper;
                        
                        
                            public JudgeAddDoer(IGeekLemonDBContext geekLemonContext,
                                IMapper mapper)
                            {
                                _geekLemonContext = geekLemonContext;
                                _mapper = mapper;
                            }
                        
                            public async Task&lt;ExecutionStatus&lt;JudgeIds&gt;&gt; Run(Judge entity)
                            {
                                using var connection = new SqliteConnection(_geekLemonContext.ConnectionString);
                        
                                var q = @&quot;INSERT INTO Judges 
                                    (Login, Password, BirthDate, Name_First,
                                     Name_Last,CategoryID,
                                    UniqueId, Version )
                                    VALUES(@Login, @Password, @BirthDate, 
                                    @Name_First, @Name_Last, @CategoryId, @UniqueId,@Version);
                        
                                    SELECT seq From sqlite_sequence Where Name=&#39;Judges&#39;&quot;;
                        
                                //var v = GetValuesFromJugde(entity);
                        
                                //var result = await connection.QueryAsync&lt;int&gt;(q,
                                //     new
                                //     {
                                //         @Id = entity.Id,
                                //         @Login = entity.Login,
                                //         @Password = entity.Password,
                                //         @BirthDate = v.Birthdate,
                                //         @Name_First = entity.Name.First,
                                //         @Name_Last = entity.Name.Last,
                                //         @Email_ForeConference = v.EmailForeConference,
                                //         @Email_ForSpeakers = v.EmailForSpeakers,
                                //         @Phone_ForSpekers = v.PhoneForSpekers,
                                //         @Phone_ForConference = v.PhoneForConference,
                                //         @CategoryID = entity.Category.Id.Value
                                //     });
                        
                                var temp = _mapper.Map&lt;JudgeTemp&gt;(entity);
                        
                                try
                                {
                                    var result = await connection.QueryAsync&lt;int&gt;(q, temp);
                                    int createdId = result.FirstOrDefault();
                        
                                    JudgeIds ids = new JudgeIds()
                                    {
                                        CreatedId = new JudgeId(createdId),
                                        UniqueId = entity.UniqueId
                                    };
                        
                                    return ExecutionStatus
                                        &lt;JudgeIds&gt;.
                                        DbIfDefaultThenError(ids);
                                }
                                catch (Exception ex)
                                {
                                    return ExecutionStatus&lt;JudgeIds&gt;
                                        .DbError(ex.Message);
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
   
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">JudgeGetAllDoer</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">





















                        










                        public class JudgeGetAllDoer : BeforeDoer, IJudgeGetAllDoer
                        {
                        
                        
                            private readonly IMapper _mapper;
                            
                            
                            public JudgeGetAllDoer(IGeekLemonDBContext geekLemonContext,
                                IMapper mapper)
                            {
                                _geekLemonContext = geekLemonContext;
                                _mapper = mapper;
                            }
                            
                            public async Task&lt;ExecutionStatus&lt;IReadOnlyList&lt;Judge&gt;&gt;&gt; Run()
                            {
                                using var connection = new SqliteConnection
                                    (_geekLemonContext.ConnectionString);
                            
                                var q = @$&quot;SELECT j.Id, j.Login,j.Password,j.BirthDate,j.Name_First, j.Name_Last,
                                    j.CategoryId, j.UniqueId ,j.Version ,
                                    c.Name AS {nameof(JudgeTemp.Category_Name)},
                                    c.DisplayName AS {nameof(JudgeTemp.Category_DisplayName)}
                                    ,c.WhatWeAreLookingFor AS {nameof(JudgeTemp.Category_WhatWeAreLookingFor)}
                                    FROM Judges AS j
                                    INNER JOIN Categories as C ON j.CategoryId = C.Id&quot;;
                            
                                try
                                {
                                    var r = await connection.QueryAsync&lt;JudgeTemp&gt;
                                        (q);
                            
                                    var rmaped = _mapper.Map&lt;IEnumerable&lt;Judge&gt;&gt;(r);
                            
                                    //var r2 = await connection.QueryAsync&lt;Judge&gt;
                                    //($&quot;SELECT Id,Login AS {nameof(Judge.Login.Value)},&quot; +
                                    //$&quot;Password AS {nameof(Judge.Password.Value)}, &quot; +
                                    //$&quot;BirthDate AS {nameof(Judge.Birthdate)}, &quot; +
                                    //$&quot;Name_First AS {nameof(Judge.Name.First)}, &quot; +
                                    //$&quot;Name_Last, AS {nameof(Judge.Name.Last)}&quot; +
                                    //$&quot;Email_ForeConference AS {nameof(Judg)}&quot; +
                                    //$&quot;,Email_ForSpeakers AS {nameof(Judge.Login.Value)},&quot; +
                                    //$&quot;Phone_ForConference AS {nameof(Judge.Login.Value)},&quot; +
                                    //$&quot;Phone_ForSpekers AS {nameof(Judge.Login.Value)}, &quot; +
                                    //$&quot;CategoryId AS {nameof(Judge.Login.Value)} FROM Judges; &quot;);
                            
                                    return ExecutionStatus&lt;IReadOnlyList&lt;Judge&gt;&gt;
                                        .DbIfDefaultThenError(rmaped.ToList().AsReadOnly());
                                }
                                catch (Exception ex)
                                {
                                    return ExecutionStatus&lt;IReadOnlyList&lt;Judge&gt;&gt;.DbError(ex.Message);
                                }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>


    <section class="slide creamGG">
        <span class="shout colors" ><span>Jak przechowywać zapytania SQL w takim projekcie
        </span></span>
    </section>
    <section class="slide creamGG">
        <span class="shout colors" ><span>Można by było użyć procedur i widoków, ale SQLite tego nie obsługuje
        </span></span>
    </section>
    <section class="slide creamGG">
        <span class="shout colors" ><span>Możne pliki zasobów .resx 
        </span></span>
    </section>

    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/infra/04.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CallForSpeechSubmitDoer</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">












                        







                        public class CallForSpeechSubmitDoer : BeforeDoer, ICallForSpeechSubmitDoer
                        {
                        
                            private readonly IMapper _mapper;
                        
                            public CallForSpeechSubmitDoer
                                (IGeekLemonDBContext geekLemonContext,
                                IMapper mapper)
                            {
                                _geekLemonContext = geekLemonContext;
                                _mapper = mapper;
                            }
                        
                            public async Task&lt;ExecutionStatus&lt;CallForSpeechIds&gt;&gt;
                                Run(CallForSpeech callForSpeech)
                            {
                                var temp = _mapper.Map&lt;CallForSpeechTemp&gt;(callForSpeech);
                        
                                using var connection = new SqliteConnection(_geekLemonContext.ConnectionString);
                        
                                var q = SqlQueries.CallForSpeechInsert;
                        
                                try
                                {
                                    var result = await connection.QueryAsync&lt;int&gt;(q, temp);
                        
                                    int createdId = result.FirstOrDefault();
                        
                                    CallForSpeechIds ids = new CallForSpeechIds()
                                    {
                                        CreatedId = new CallForSpeechId(createdId),
                                        UniqueId = callForSpeech.UniqueId
                                    };
                        
                                    return ExecutionStatus&lt;CallForSpeechIds&gt;.DbOk(ids);
                                }
                                catch (Exception ex)
                                {
                                    if (ExecutionFlow.Options.ThrowExceptions)
                                        throw;
                        
                                    return ExecutionStatus&lt;CallForSpeechIds&gt;.DbError(ex);
                                }
                        
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide creamGG">
        <span class="shout colors" ><span>Jak wygląda zapis odwołania ?
        </span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CallForSpeechSaveRejectionDoer</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">













































                        








                        public class CallForSpeechSaveRejectionDoer : BeforeDoer, ICallForSpeechSaveRejectionDoer
                        {
                        
                            private readonly IMapper _mapper;
                        
                            public CallForSpeechSaveRejectionDoer
                                (IGeekLemonDBContext geekLemonContext,
                                IMapper mapper)
                            {
                                _geekLemonContext = geekLemonContext;
                                _mapper = mapper;
                            }
                        
                            public async Task&lt;ExecutionStatus&gt; Run
                            (CallForSpeechUniqueId id, JudgeId judge, CallForSpeechStatus status)
                            {
                                using var connection = new SqliteConnection(_geekLemonContext.ConnectionString);
                        
                                var q = @&quot;UPDATE CallForSpeakes
                                    SET PreliminaryDecision_DecisionBy = @JudgeId, 
                                    PreliminaryDecision_Date = @Date,
                                    Status = @Status
                                    WHERE UniqueId = @UniqueId;&quot;;
                                try
                                {
                                    var result = await connection.ExecuteAsync(q,
                                     new
                                     {
                                         @JudgeId = judge.Value,
                                         @Date = AppTime.Now().ToLongDateString(),
                                         @UniqueId = id.Value.ToString(),
                                         @Status = (int)status
                                     });
                        
                        
                                    return ExecutionStatus.DbOk();
                                }
                                catch (Exception ex)
                                {
                                    if (ExecutionFlow.Options.ThrowExceptions)
                                        throw;
                        
                                    return ExecutionStatus.DbError(ex);
                                }
                        
                            }
                        
                            public async Task&lt;ExecutionStatus&gt; Run
                                (CallForSpeechId id, JudgeId judge, CallForSpeechStatus status)
                            {
                                using var connection = new SqliteConnection(_geekLemonContext.ConnectionString);
                        
                                var q = @&quot;UPDATE CallForSpeakes
                                    SET PreliminaryDecision_DecisionBy = @JudgeId, 
                                    PreliminaryDecision_Date = @Date,
                                    Status = @Status
                                    WHERE Id = @Id;&quot;;
                                try
                                {
                                    var result = await connection.ExecuteAsync(q,
                                     new
                                     {
                                         @JudgeId = judge.Value,
                                         @Date = AppTime.Now().ToLongDateString(),
                                         @Id = id.Value,
                                         @Status = (int)status
                                     });
                        
                        
                                    return ExecutionStatus.DbOk();
                                }
                                catch (Exception ex)
                                {
                                    if (ExecutionFlow.Options.ThrowExceptions)
                                        throw;
                        
                                    return ExecutionStatus.DbError(ex);
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide creamGG">
        <span class="shout colors" ><span>Jak wygląda zapis oceny punktowej maszynowej >?
        </span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CallForSpeechSaveEvaluatationDoer</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">























































                        public class CallForSpeechSaveEvaluatationDoer : BeforeDoer, 
                            ICallForSpeechSaveEvaluatationDoer
                        {
                            private readonly IMapper _mapper;
                        
                            public CallForSpeechSaveEvaluatationDoer
                                (IGeekLemonDBContext geekLemonContext,
                                IMapper mapper)
                            {
                                _geekLemonContext = geekLemonContext;
                                _mapper = mapper;
                            }
                        
                            public async Task&lt;ExecutionStatus&gt; Run(CallForSpeechUniqueId id,
                                CallForSpeechScoringResult score, CallForSpeechStatus status)
                            {
                                using var connection = new SqliteConnection(_geekLemonContext.ConnectionString);
                        
                                var q = @&quot;UPDATE CallForSpeakes
                                    SET Score_Score = @Score, 
                                    Score_RejectExplanation = @RejectExplanation,
                                    Score_WarringExplanation = @WarringExplanation,
                                    Status = @Status
                                    WHERE UniqueId = @UniqueId;&quot;;
                        
                                try
                                {
                                    var result = await connection.ExecuteAsync(q,
                                     new
                                     {
                                         @Score = (int)score.Score,
                                         @WarringExplanation = score.WarringExplanation,
                                         @RejectExplanation = score.RejectExplanation,
                                         @UniqueId = id.Value.ToString(),
                                         @Status = (int)status
                                     });
                                    return ExecutionStatus.DbOk();
                                }
                                catch (Exception ex)
                                {
                                    if (ExecutionFlow.Options.ThrowExceptions)
                                        throw;
                        
                                    return ExecutionStatus.DbError(ex);
                                }
                            }
                        
                            public async Task&lt;ExecutionStatus&gt; Run(CallForSpeechId id,
                                CallForSpeechScoringResult score, CallForSpeechStatus status)
                            {
                                using var connection = new SqliteConnection(_geekLemonContext.ConnectionString);
                        
                                var q = @&quot;UPDATE CallForSpeakes
                                    SET Score_Score = @Score, 
                                    Score_RejectExplanation = @RejectExplanation,
                                    Score_WarringExplanation = @WarringExplanation,
                                    Status = @Status
                                    WHERE Id = @Id;&quot;;
                        
                                try
                                {
                                    var result = await connection.ExecuteAsync(q,
                                     new
                                     {
                                         @Score = (int)score.Score,
                                         @WarringExplanation = score.WarringExplanation,
                                         @RejectExplanation = score.RejectExplanation,
                                         @Id = id.Value,
                                         @Status = (int)status
                                     });
                                    return ExecutionStatus.DbOk();
                                }
                                catch (Exception ex)
                                {
                                    if (ExecutionFlow.Options.ThrowExceptions)
                                        throw;
                        
                                    return ExecutionStatus.DbError(ex);
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide creamGG">
        <span class="shout colors" ><span>Jak to instalujemy?
        </span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">GeekLemonConferenceInstallers</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 17px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 17px !important;">










































                        public static partial class GeekLemonConferenceInstallers
                        {
                            public static IServiceCollection
                                AddGeekLemonPersistenceDapperSQLiteServices
                                (this IServiceCollection services,
                                IConfiguration configuration)
                            {                     
                                //If Scoped or Singleton then Two version of repositories will use one version of this
                                services.AddTransient&lt;ICallForSpeechGetByIdDoer, CallForSpeechGetByIdDoer&gt;();
                                services.AddTransient&lt;ICallForSpeechGetCollectionDoer, CallForSpeechGetCollectionDoer&gt;();
                                services.AddTransient&lt;ICallForSpeechSaveAcceptenceDoer, CallForSpeechSaveAcceptenceDoer&gt;();
                                services.AddTransient&lt;ICallForSpeechSaveEvaluatationDoer, CallForSpeechSaveEvaluatationDoer&gt;();
                                services.AddTransient&lt;ICallForSpeechSavePreliminaryAcceptenceDoer,
                                 CallForSpeechSavePreliminaryAcceptenceDoer&gt;();
                                services.AddTransient&lt;ICallForSpeechSaveRejectionDoer, CallForSpeechSaveRejectionDoer&gt;();
                                services.AddTransient&lt;ICallForSpeechSubmitDoer, CallForSpeechSubmitDoer&gt;();
                        
                                services.AddTransient&lt;ICategoryAddDoer, CategoryAddDoer&gt;();
                                services.AddTransient&lt;ICategoryGetAllDoer, CategoryGetAllDoer&gt;();
                                services.AddTransient&lt;ICategoryDeleteDoer, CategoryDeleteDoer&gt;();
                                services.AddTransient&lt;ICategoryGetByIdDoer, CategoryGetByIdDoer&gt;();
                                services.AddTransient&lt;ICategoryUpdateDoer, CategoryUpdateDoer&gt;();
                        
                                services.AddTransient&lt;IJudgeAddDoer, JudgeAddDoer&gt;();
                                services.AddTransient&lt;IJudgeUpdateDoer, JudgeUpdateDoer&gt;();
                                services.AddTransient&lt;IJudgeDeleteDoer, JudgeDeleteDoer&gt;();
                                services.AddTransient&lt;IJudgeGetAllDoer, JudgeGetAllDoer&gt;();
                                services.AddTransient&lt;IJudgeGetByIdDoer, JudgeGetByIdDoer&gt;();
                        
                                services.AddTransient&lt;ICategoryRepository, CategoryRepository&gt;();
                                services.AddTransient&lt;IJudgeRepository, JugdeRepository&gt;();
                                services.AddTransient&lt;ICallForSpeechRepository, CallForSpeechRepository&gt;();
                                services.AddTransient&lt;IZEsCategoryRepository, ZEsCategoryRepository&gt;();
                                services.AddTransient&lt;IZEsJudgeRepository, ZEsJugdeRepository&gt;();
                                services.AddTransient&lt;IZEsCallForSpeechRepository, ZEsCallForSpeechRepository&gt;();
                        
                                SqlMapper.RemoveTypeMap(typeof(DateTimeOffset));
                                SqlMapper.AddTypeHandler(DateTimeHandler.Default);
                                services.AddAutoMapper(Assembly.GetExecutingAssembly());
                        
                                var connection = configuration.
                                GetConnectionString(&quot;GeekLemonConferenceConnectionString&quot;);
                                var zEsConnection = configuration.
                                    GetConnectionString(&quot;ZEsGeekLemonConferenceConnectionString&quot;);
                        
                                services.AddTransient&lt;IGeekLemonDBContext, GeekLemonDBContext&gt;
                                    (
                                        (services) =&gt;
                                        {
                                            var c =
                                            new GeekLemonDBContext(connection);
                                            return c;
                                        }
                                    );
                        
                                services.AddTransient&lt;IZEsGeekLemonDBContext, ZEsGeekLemonDBContext&gt;
                                (
                                    (services) =&gt;
                                    {
                                        var c =
                                        new ZEsGeekLemonDBContext(zEsConnection);
                                        return c;
                                    }
                                );
                                
                                return services;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide conicG">
        <span class="shout colors" ><span>Koniec tej warstwy aplikacji<br />
            😁</span></span>
    </section>
    <section class="slide conicG">
        <span class="shout colors" ><span>Teraz napiszmy testy integracyjne aby przetestować te zapytania<br />
            😜</span></span>
    </section>
    <section class="slide cream">
        <span class="shout colors" ><span>Problem : SQlite obsługuje bazę danych w pamięci, ale przy
            1 połączeniu<br />
            🤕</span></span>
    </section>
    <section class="slide cream">
        <span class="shout colors" ><span>Ponieważ połączenia z bazą nie wstrzykuje to mam problem<br />
            😑</span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/api/03.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide cream">
        <span class="shout colors" ><span>Dlaczego nie kopiować pliku bazy i kasować go po skończonym teście<br />
            💡</span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">Judge CopyDataBase</h2>
            </div>
            <div class="PlaceCodeHere ">
                <pre style="font-size: 18px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 18px !important;">


                        public static class CopyDataBase
                        {
                            public static string Run()
                            {
                                int i = new Random().Next(0, int.MaxValue);
                                var codeBaseUrl = new Uri(Assembly.GetExecutingAssembly().Location);
                                var codeBasePath = Uri.UnescapeDataString(codeBaseUrl.AbsolutePath);
                                var dirPath = Path.GetDirectoryName(codeBasePath);
                                var pathtodatabasefile = dirPath + &quot;\\DataBaseExample&quot; + &quot;\\GeekLemonTestDataBase.db&quot;;
                                var folder = dirPath + &quot;\\DataBaseExample&quot; + $&quot;\\Temp\\&quot;;
                        
                                System.IO.DirectoryInfo di = new DirectoryInfo(folder);
                        
                                foreach (FileInfo file in di.GetFiles())
                                {
                                    file.Delete();
                                }
                                foreach (DirectoryInfo dir in di.GetDirectories())
                                {
                                    dir.Delete(true);
                                }
                        
                                Directory.CreateDirectory(folder);
                        
                                var dest = dirPath + &quot;\\DataBaseExample&quot; + $&quot;\\Temp\\TEMPCOPY{i}.db&quot;;
                                File.Copy(pathtodatabasefile, dest);
                        
                                return dest;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide cream">
        <span class="shout colors" ><span>Jak w XUnit incjuje się test i go czyści<br />
            💡</span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CategoryDataBaseIntegrationTest</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">













                        public class CategoryDataBaseIntegrationTest : IDisposable
                        {
                            private GeekLemonDBContext _geekLemonContex;
                            private IMapper _mapper;
                            private string _tempdatabasefile;
                            
                            public CategoryDataBaseIntegrationTest()
                            {
                                _tempdatabasefile = CopyDataBase.Run();
                            
                                if (_geekLemonContex == null)
                                    _geekLemonContex =
                                        new GeekLemonDBContext(
                                            $&quot;Data Source={_tempdatabasefile}&quot;);
                            
                                if (_mapper == null)
                                {
                                    var mappingConfig = new MapperConfiguration(mc =&gt;
                                    {
                                        mc.AddProfile(new MappingProfile());
                                    });
                                    IMapper mapper = mappingConfig.CreateMapper();
                                    _mapper = mapper;
                                }
                            }
                            
                            public void Dispose()
                            {
                                //try
                                //{
                                //    File.Delete(_tempdatabasefile);
                                //    Directory.Delete(_tempdatabasefile.Replace(&quot;\\TEMPCOPY{i}.db&quot;, &quot;&quot;));
                                //}
                                //catch (Exception
                                //ex)
                                //{
                            
                                //}
                            }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide cream">
        <span class="shout colors" ><span>Oto przykładowe testy integracyjne <br />
            💡</span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CreateCategoryShouldBeSuccessThenGetByIdShouldbeAlsoASuccess</h2>
            </div>
            <div class="PlaceCodeHere ">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        [Fact]
                        public async Task CreateCategoryShouldBeSuccessThenGetByIdShouldbeAlsoASuccess()
                        {
                            //SetupCategories();
                            CategoryAddDoer categoryAddDoer =
                                new CategoryAddDoer(_geekLemonContex, _mapper);
                
                            var cat = GivenCategory().WithId(1).WithName("AAA")
                                .Build();
                
                            var status = await categoryAddDoer.Run(cat);
                
                            status.Success.Should().BeTrue();
                
                            CategoryGetByIdDoer categoryGetByIdDoer =
                                new CategoryGetByIdDoer(_geekLemonContex, _mapper);
                
                            var status2 = await categoryGetByIdDoer.Run(
                                status.Value.CreatedId as CategoryId);
                
                            status2.Success.Should().BeTrue();
                
                            status2.Value.Should().Equals(cat);
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CreateCategoryShouldBeSuccessThenGetByUniqueIdShouldbeAlsoASuccess</h2>
            </div>
            <div class="PlaceCodeHere ">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        [Fact]
                        public async Task CreateCategoryShouldBeSuccessThenGetByUniqueIdShouldbeAlsoASuccess()
                        {
                            //SetupCategories();
                            CategoryAddDoer categoryAddDoer =
                                new CategoryAddDoer(_geekLemonContex, _mapper);
                
                            var cat = GivenCategory().WithId(1).WithName("AAA")
                                .Build();
                
                            var status = await categoryAddDoer.Run(cat);
                
                            status.Success.Should().BeTrue();
                
                            CategoryGetByIdDoer categoryGetByIdDoer =
                                new CategoryGetByIdDoer(_geekLemonContex, _mapper);
                
                            var status2 = await categoryGetByIdDoer.Run(
                                status.Value.UniqueId as CategoryUniqueId);
                
                            status2.Success.Should().BeTrue();
                
                            status2.Value.Should().Equals(cat);
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CreateCategoryShouldBeSuccessThenGetAllShouldbeAlsoASuccess</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">

                        [Fact]
                        public async Task CreateCategoryShouldBeSuccessThenGetAllShouldbeAlsoASuccess()
                        {
                            //SetupCategories();
                            CategoryAddDoer categoryAddDoer =
                                new CategoryAddDoer(_geekLemonContex, _mapper);
                
                            var cat = GivenCategory().WithId(1).WithName("AAA")
                                .Build();
                
                            var status = await categoryAddDoer.Run(cat);
                
                            status.Success.Should().BeTrue();
                
                            CategoryGetAllDoer categoryGetAllDoer =
                                new CategoryGetAllDoer(_geekLemonContex, _mapper);
                
                            var status2 = await categoryGetAllDoer.Run();
                
                            status2.Success.Should().BeTrue();
                
                            status2.Value.Should().HaveCount(1);
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CreateCategoryShouldBeSuccessThenDeleteThenTryGetByIdAndFail</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">



                        
                        [Fact]
                        public async Task CreateCategoryShouldBeSuccessThenDeleteThenTryGetByIdAndFail()
                        {
                            CategoryAddDoer categoryAddDoer =
                                new CategoryAddDoer(_geekLemonContex, _mapper);
                
                            var cat = GivenCategory().WithId(1).WithName("AAA")
                                .Build();
                
                            var status = await categoryAddDoer.Run(cat);
                
                            status.Success.Should().BeTrue();
                
                            CategoryDeleteDoer categoryDeleteDoer =
                                new CategoryDeleteDoer(_geekLemonContex, _mapper);
                
                            var status2 = await categoryDeleteDoer.Run(
                                status.Value.CreatedId as CategoryId);
                
                            status2.Success.Should().BeTrue();
                
                            CategoryGetByIdDoer categoryGetByIdDoer =
                                new CategoryGetByIdDoer(_geekLemonContex, _mapper);
                
                            var status3 = await categoryGetByIdDoer.Run(
                                status.Value.CreatedId as CategoryId);
                
                            status3.Success.Should().BeFalse();
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CreateCategoryShouldBeSuccessThenDeleteByUniqueIdThenTryGetByUniqueIdAndFail</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">





                        [Fact]
                        public async Task CreateCategoryShouldBeSuccessThenDeleteByUniqueIdThenTryGetByUniqueIdAndFail()
                        {
                            CategoryAddDoer categoryAddDoer =
                                new CategoryAddDoer(_geekLemonContex, _mapper);
                
                            var cat = GivenCategory().WithId(1).WithName("AAA")
                                .Build();
                
                            var status = await categoryAddDoer.Run(cat);
                
                            status.Success.Should().BeTrue();
                
                            CategoryDeleteDoer categoryDeleteDoer =
                                new CategoryDeleteDoer(_geekLemonContex, _mapper);
                
                            var status2 = await categoryDeleteDoer.Run(
                                status.Value.UniqueId as CategoryUniqueId);
                
                            status2.Success.Should().BeTrue();
                
                            CategoryGetByIdDoer categoryGetByIdDoer =
                                new CategoryGetByIdDoer(_geekLemonContex, _mapper);
                
                            var status3 = await categoryGetByIdDoer.Run(
                                status.Value.UniqueId as CategoryUniqueId);
                
                            status3.Success.Should().BeFalse();
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CreateCategoryThenUpdatedShoudlBeSuccessById</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">








                        [Fact]
                        public async Task CreateCategoryThenUpdatedShoudlBeSuccessById()
                        {
                            //SetupCategories();
                            CategoryAddDoer categoryAddDoer =
                                new CategoryAddDoer(_geekLemonContex, _mapper);
                
                            var cat = GivenCategory().WithId(1).WithName("AAA")
                                .Build();
                
                            var status = await categoryAddDoer.Run(cat);
                
                            status.Success.Should().BeTrue();
                
                            CategoryUpdateDoer categoryUpdateDoer =
                                new CategoryUpdateDoer(_geekLemonContex, _mapper);
                
                            var cat2 = GivenCategory().WithId(1).WithName("2222")
                                .WithDisplayName("3333")
                                .WithWhatWeAreLookingFor("4444")
                                .Build();
                
                            var status2 = await categoryUpdateDoer.Run(cat2, ByWhatId.CreatedId);
                            status2.Success.Should().BeTrue();
                
                            CategoryGetByIdDoer categoryGetByIdDoer =
                                new CategoryGetByIdDoer(_geekLemonContex, _mapper);
                
                            var status3 = await categoryGetByIdDoer.Run(
                                status.Value.UniqueId as CategoryUniqueId);
                
                            status3.Success.Should().BeTrue();
                
                            status3.Value.Should().NotBeSameAs(cat);
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CreateCategoryThenUpdatedShoudlBeSuccessByUniqueId</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">







                     
                        


                        [Fact]
                        public async Task CreateCategoryThenUpdatedShoudlBeSuccessByUniqueId()
                        {
                            //SetupCategories();
                            CategoryAddDoer categoryAddDoer =
                                new CategoryAddDoer(_geekLemonContex, _mapper);
                
                            var cat = GivenCategory().WithId(1).WithName("AAA")
                                .Build();
                
                            var status = await categoryAddDoer.Run(cat);
                
                            status.Success.Should().BeTrue();
                
                            CategoryGetByIdDoer categoryGetByIdDoer =
                                new CategoryGetByIdDoer(_geekLemonContex, _mapper);
                
                            var status2 = await categoryGetByIdDoer.Run(
                                status.Value.UniqueId as CategoryUniqueId);
                
                            CategoryUpdateDoer categoryUpdateDoer =
                                new CategoryUpdateDoer(_geekLemonContex, _mapper);
                
                            var cat2 = GivenCategory().WithId(1).WithName("2222")
                                .WithDisplayName("3333")
                                .WithWhatWeAreLookingFor("4444")
                                .Build();
                
                            var status3 = await categoryUpdateDoer.Run(cat2, ByWhatId.UniqueId);
                            status3.Success.Should().BeTrue();
                
                            var status4 = await categoryGetByIdDoer.Run(
                                status.Value.UniqueId as CategoryUniqueId);
                
                            status3.Success.Should().BeTrue();
                
                            status4.Value.Should().NotBeSameAs(cat);
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide conicG">
        <span class="shout colors" >To były wszystkie<br /> <span>Testy</span> na tym webinarze
        </span>
    </section>
    <section class="slide conicG">
        <span class="shout colors" >Idziemy dalej. <br />Piszemy więc projekty<br /> <span>API
            👨‍💻
        </span></span>
    </section>
    <section class="slide creamPP fullscreen">
        <div class="grid-container-slidepoint">
            <div class="SlidePointImage">
                <img  src="pictures/circular/circular desing-03-t.png" />
            </div>
            <div class="SlidePointText">
                <ol class="nonumbers">
                    <li class="next bold">API</li>
                    <ol class="nonumbers">
                        <li class="next">Zależne od Core</li>
                        <li class="next">Logika z myślą o oczach użytkownika</li>
                    </ol>
                </ol>
            </div>
          </div>
    </section>  
    <section class="slide creamPP fullscreen smaller">
        <div class="grid-container-slidepoint">
            <div class="SlidePointImage">
                <img  src="pictures/circular/circular desing-03-t.png" />
            </div>
            <div class="SlidePointText">
                <ol class="nonumbers">
                    <li class="next bold">Co idzie do API?</li>
                    <ol class="nonumbers">
                        <li class="next">ASP.NET MVC/Core, Razor Pages, Blazor &nbsp;&nbsp;</li>
                        <li class="next">Specficzne dla ASP.NET CORE rzeczy jak : Middleware&nbsp;&nbsp;</li>
                        <li class="next">Specficzne dla Blazor rzeczy jak : Razor Compoments &nbsp;&nbsp;</li>
                        <li class="next">Interakcja z innymi usługami przez MediatR&nbsp;&nbsp;</li>
                    </ol>
                </ol>
            </div>
          </div>
    </section> 
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/API/01.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamGG">
        <span class="shout colors" ><span>Jak testować REST API ?
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/fidlder.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Cezary Walenciuk</figcaption>
        </figure>
    </section>
    <section class="slide creamGG">
        <span class="shout colors" ><span>Dodajmy Swagger UI 😎
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/API/02.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">Projekt API</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 11px;overflow: hidden;  " class="language-xml">
                    <code style="line-height: 11px !important;">
                        &lt;Project Sdk=&quot;Microsoft.NET.Sdk.Web&quot;&gt;

                        &lt;PropertyGroup&gt;
                          &lt;TargetFramework&gt;net5.0&lt;/TargetFramework&gt;
                        &lt;/PropertyGroup&gt;
                      
                        &lt;ItemGroup&gt;
                          &lt;PackageReference Include=&quot;Microsoft.AspNet.WebApi.Core&quot; Version=&quot;5.2.7&quot; /&gt;
                          &lt;PackageReference Include=&quot;Microsoft.Extensions.DependencyInjection&quot; Version=&quot;5.0.1&quot; /&gt;
                          &lt;PackageReference Include=&quot;Swashbuckle.AspNetCore&quot; Version=&quot;6.0.7&quot; /&gt;
                          &lt;PackageReference Include=&quot;Swashbuckle.AspNetCore.SwaggerUI&quot; Version=&quot;6.0.7&quot; /&gt;
                          &lt;PackageReference Include=&quot;Swashbuckle.Core&quot; Version=&quot;5.6.0&quot; /&gt;
                        &lt;/ItemGroup&gt;
                      
                        &lt;ItemGroup&gt;
                          &lt;ProjectReference Include=&quot;..\GeekLemon.Infrastructure.Read.SQLite\GeekLemonConference.Persistence.Dapper.SQLite.csproj&quot; /&gt;
                          &lt;ProjectReference Include=&quot;..\GeekLemon.Infrastructure.Write.MongoDB\GeekLemonConference.Infrastructure.EventStoreAndBus.csproj&quot; /&gt;
                          &lt;ProjectReference Include=&quot;..\GeekLemonConference.Application.CQRS\GeekLemonConference.Application.CQRS.csproj&quot; /&gt;
                          &lt;ProjectReference Include=&quot;..\GeekLemonConference.Application.EventSourcing\GeekLemonConference.Application.EventSourcing.csproj&quot; /&gt;
                          &lt;ProjectReference Include=&quot;..\GeekLemonConference.Infrastructure.EventStore.MongoDb\GeekLemonConference.Infrastructure.EventStorePlugin.MongoDb.csproj&quot; /&gt;
                          &lt;ProjectReference Include=&quot;..\GeekLemonConference.Infrastructure.EventStore.SQLite\GeekLemonConference.Infrastructure.EventStorePlugin.SQLite.csproj&quot; /&gt;
                        &lt;/ItemGroup&gt;
                      
                      &lt;/Project&gt;
                      
                    </code>
                </pre>
            </div>
            <div class="AnswerCode">
                <div class="pytanie">
                    <h3></h3>
                </div>
                <div class="odpowiedz">
                    
                </div>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">public class Startup ConfigureServices</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 17px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 17px !important;">
























                        public class Startup
                        {
                            public IConfiguration Configuration { get; }
                    
                            public Startup(IConfiguration configuration)
                            {
                                Configuration = configuration;
                            }
                    
                            public void ConfigureServices(IServiceCollection services)
                            {
                                services.AddSwaggerGen(c =&gt;
                                {
                                    c.AddSecurityDefinition(&quot;Bearer&quot;, new OpenApiSecurityScheme
                                    {
                                        Description = @&quot;JWT Authorization header using the Bearer scheme. \r\n\r\n 
                                        Enter &#39;Bearer&#39; [space] and then your token in the text input below.
                                        \r\n\r\nExample: &#39;Bearer 12345abcdef&#39;&quot;,
                                        Name = &quot;Authorization&quot;,
                                        In = ParameterLocation.Header,
                                        Type = SecuritySchemeType.ApiKey,
                                        Scheme = &quot;Bearer&quot;
                                    });
                                
                                    c.AddSecurityRequirement(new OpenApiSecurityRequirement()
                                    {
                                        {
                                        new OpenApiSecurityScheme
                                        {
                                            Reference = new OpenApiReference
                                            {
                                                Type = ReferenceType.SecurityScheme,
                                                Id = &quot;Bearer&quot;
                                            },
                                            Scheme = &quot;oauth2&quot;,
                                            Name = &quot;Bearer&quot;,
                                            In = ParameterLocation.Header,
                                
                                            },
                                            new List&lt;string&gt;()
                                        }
                                        });
                                
                                    c.SwaggerDoc(&quot;v1&quot;, new OpenApiInfo
                                    {
                                        Version = &quot;v1&quot;,
                                        Title = &quot;GeekLemonConference API&quot;,
                                    });
                                
                                });
                      
                    </code>
                </pre>
            </div>
            <div class="AnswerCode">
                <div class="pytanie">
                    <h3></h3>
                </div>
                <div class="odpowiedz">
                    
                </div>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">public class Startup Configure</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 17px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 17px !important;">
                        public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
                        {
                            if (env.IsDevelopment())
                            {
                                app.UseDeveloperExceptionPage();
                            }
                        
                            app.UseHttpsRedirection();
                        
                            app.UseAuthentication();
                            app.UseRouting();
                            app.UseAuthorization();
                        
                            app.UseSwagger();
                            app.UseSwaggerUI(c =&gt;
                            {
                                c.SwaggerEndpoint(&quot;/swagger/v1/swagger.json&quot;, &quot;GeekLemonConference API&quot;);
                            });
                        
                            app.UseCors(&quot;Open&quot;);
                        
                            app.UseEndpoints(endpoints =&gt;
                            {
                                endpoints.MapControllers();
                            });
                        }
                      
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">ConfigureServices dodanie naszych instalatorów</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 17px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 17px !important;">
                        public IConfiguration Configuration { get; }

                        public Startup(IConfiguration configuration)
                        {
                            Configuration = configuration;
                        }
                        
                        public void ConfigureServices(IServiceCollection services)
                        {
                        
                            services.AddGeekLemonConferenceCQRS(Configuration);
                            services.AddGeekLemonPersistenceDapperSQLiteServices(Configuration);
                            ////services.AddDefaultEventStore();
                            //services.AddEventStoreSqlLite(Configuration);
                            ////services.AddEventStoreMongoDb(Configuration);
                            //services.AddBusAndRepository(Configuration);
                        
                            services.AddControllers();
                            services.AddCors(options =&gt;
                            {
                                options.AddPolicy(&quot;Open&quot;,
                                    builder =&gt; builder.AllowAnyOrigin().AllowAnyHeader().AllowAnyMethod());
                            });
                        }
                      
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/API/04.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">Projekt API</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 17px;overflow: hidden;  " class="language-json">
                    <code style="line-height: 17px !important;">
                        {
                            &quot;ConnectionStrings&quot;: {
                          
                              &quot;GeekLemonConferenceConnectionString&quot;: &quot;DataSource=./DataBase/GeekLemonDB.db&quot;,
                              &quot;ZEsGeekLemonConferenceConnectionString&quot;: &quot;DataSource=./DataBase/ZEsGeekLemonDB.db&quot;,
                              &quot;EventStoreSQLiteConnectionString&quot;: &quot;DataSource=./DataBase/EventStoreDB.db&quot;
                            },
                            &quot;RabbitMqSetting&quot;: {
                              &quot;username&quot;: &quot;guest&quot;,
                              &quot;password&quot;: &quot;guest&quot;,
                              &quot;hostname&quot;: &quot;localhost&quot;,
                              &quot;uri&quot;: &quot;amqp://localhost:5672/&quot;,
                              &quot;virtualhost&quot;: &quot;/&quot;
                            },
                            &quot;Logging&quot;: {
                              &quot;LogLevel&quot;: {
                                &quot;Default&quot;: &quot;Information&quot;,
                                &quot;Microsoft&quot;: &quot;Warning&quot;,
                                &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;
                              }
                            },
                            &quot;AllowedHosts&quot;: &quot;*&quot;
                          }
                      
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/API/05.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>

    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">BaseGeekLemonController</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 17px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 17px !important;">
                        public abstract class BaseGeekLemonController : Controller
                        {
                            protected virtual MethodFailureResult MethodFailure([ActionResultObjectValue] object value)
                            {
                                return new MethodFailureResult(value);
                            }
                        }
                        
                        [DefaultStatusCode(DefaultStatusCode)]
                        public class MethodFailureResult : ObjectResult
                        {
                            //private const int DefaultStatusCode = 420;
                            private const int DefaultStatusCode = 500;
                        
                            /// &lt;summary&gt;
                            /// Creates a new &lt;see cref=&quot;NotFoundObjectResult&quot;/&gt; instance.
                            /// &lt;/summary&gt;
                            /// &lt;param name=&quot;value&quot;&gt;The value to format in the entity body.&lt;/param&gt;
                            public MethodFailureResult([ActionResultObjectValue] object value)
                                    : base(value)
                            {
                                    StatusCode = DefaultStatusCode;
                            }
                        }
                      
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide creamPPPGragient">
        <span class="shout colors" >Czy REST api może zwrócić status błędu z kodem 200 HTTP <br />
           <span> 😶
        </span></span>
    </section>

    <section class="slide creamPPPGragient">
        <span class="shout colors" >NIE.<br />
             To nie WCF czy SOAP API <br />
           <span> 😎
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/yougavearestabadnae.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/yougavearestabadnae2.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamPPPGragient">
        <span class="shout colors" >Jakie kod HTTP będzie zwracać i kiedy ? <br />
           <span> 
            🤔
        </span></span>
    </section>
    <section class="slide creamGG   compact ">
        <h2>HTTP Codes</h2>
        <ol class="nonumbers">
            <li class="next">204 No Content : Gdy proces wykonał się OK, ale nie ma nic do zwrotu</li>
            <li class="next">404 NotFound : Gdy pytamy o ID czegoś i tego nie ma</li>
            <li class="next">400 Bad Request : Zapytanie ma błędne dane</li>
            <li class="next">500 : Gdy twoja metoda po stronie serwera coś skopie</li>
        </ol>
    </section>
    <section class="slide creamPPPGragient">
        <span class="shout colors" >Z ciekawości dla błędów aplikacji zwracałem kod 420<br />
           <span> 
            Ta podobno kiedyś robił Spring w Javie
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/API/06.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">Projekt API</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 17px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 17px !important;">






































































































































































































                        [Route(&quot;api/[controller]&quot;)]
                        [ApiController]
                        public class CallForSpeechController : BaseGeekLemonController
                        {
                            private readonly IMediator _mediator;
                        
                            public CallForSpeechController(IMediator mediator)
                            {
                                _mediator = mediator;
                            }
                        
                            [HttpGet(&quot;all/{filter}&quot;, Name = &quot;getallcallforspeeches&quot;)]
                            [ProducesResponseType(StatusCodes.Status200OK)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            public async Task&lt;ActionResult&lt;List&lt;CallForSpeechInListViewModel&gt;&gt;&gt; GetAllCallForSpeeches
                                (int filter)
                            {
                                GetAllCallForSpeechesQuery getAllCallForSpeechesQuery = new GetAllCallForSpeechesQuery()
                                {
                                    Filter = (FilterCallForSpeechStyles)filter,
                                    queryWitchDataBase = QueryWitchDataBase.NormalCQRS
                                };
                        
                                var result = await _mediator.Send(getAllCallForSpeechesQuery);
                        
                                if (result.Status == ResponseStatus.BussinesLogicError)
                                    return Forbid();
                                if (result.Status == ResponseStatus.NotFoundInDataBase)
                                    return NotFound();
                                if (result.Status == ResponseStatus.ValidationError)
                                    return BadRequest();
                                if (result.Status == ResponseStatus.BadQuery)
                                    return BadRequest();
                                if (!result.Success)
                                    return MethodFailure(result.Message);
                        
                        
                                return Ok(result.List);
                            }
                        
                            [HttpGet(&quot;id/{id}&quot;, Name = &quot;GetCallForSpeechById&quot;)]
                            [ProducesResponseType(StatusCodes.Status200OK)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            [ProducesDefaultResponseType]
                            public async Task&lt;ActionResult&lt;CallForSpeechViewModel&gt;&gt; GetCallForSpeechById(int id)
                            {
                                var result = await _mediator.Send(
                                    (new GetCallForSpeechQuery()
                                    {
                                        CallForSpeechId = new CallForSpeechId(id),
                                        queryWitchDataBase = QueryWitchDataBase.NormalCQRS
                                    }));
                        
                                if (result.Status == ResponseStatus.BussinesLogicError)
                                    return Forbid();
                                if (result.Status == ResponseStatus.NotFoundInDataBase)
                                    return NotFound();
                                if (result.Status == ResponseStatus.ValidationError)
                                    return BadRequest();
                                if (result.Status == ResponseStatus.BadQuery)
                                    return BadRequest();
                                if (!result.Success)
                                    return MethodFailure(result.Message);
                        
                                return Ok(result.CallForSpeech);
                            }
                        
                            [HttpGet(&quot;uniqueid/{uid}&quot;, Name = &quot;GetCallForSpeechByUniqueId&quot;)]
                            [ProducesResponseType(StatusCodes.Status200OK)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            [ProducesDefaultResponseType]
                            public async Task&lt;ActionResult&lt;CallForSpeechViewModel&gt;&gt; GetCallForSpeechByUniqueId(Guid uid)
                            {
                                var result = await _mediator.Send(
                                    (new GetCallForSpeechQuery()
                                    {
                                        CallForSpeechUniqueId = new CallForSpeechUniqueId(uid),
                                        queryWitchDataBase = QueryWitchDataBase.NormalCQRS
                                    }));
                        
                                return Ok(result.CallForSpeech);
                            }
                        
                            [HttpPost(&quot;submit&quot;, Name = &quot;submitcallforspeech&quot;)]
                            [ProducesResponseType(StatusCodes.Status200OK)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            public async Task&lt;ActionResult&lt;CallForSpeechIds&gt;&gt; Submit([FromBody] CreateCallForSpeaker request)
                            {
                                SubmitCallForSpeechCommand s = new SubmitCallForSpeechCommand()
                                {
                                    Speaker = request.Speaker,
                                    CategoryId = request.CategoryId,
                                    Speech = request.Speech,
                                    Number = request.Number,
                                };
                        
                                var result = await _mediator.Send(s);
                        
                                if (result.Status == ResponseStatus.BussinesLogicError)
                                    return Forbid();
                                if (result.Status == ResponseStatus.NotFoundInDataBase)
                                    return NotFound();
                                if (result.Status == ResponseStatus.ValidationError)
                                    return BadRequest();
                                if (result.Status == ResponseStatus.BadQuery)
                                    return BadRequest();
                                if (!result.Success)
                                    return MethodFailure(result.Message);
                        
                                return Ok(result.CallForSpeechCommandIds);
                            }
                        
                            [HttpPost(&quot;reject&quot;, Name = &quot;rejectcallforspeech&quot;)]
                            [ProducesResponseType(StatusCodes.Status204NoContent)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            public async Task&lt;ActionResult&lt;int&gt;&gt; Reject([FromBody] RejectCallForSpeechCommand rejectCallForSpeechCommand)
                            {
                                var result = await _mediator.Send(rejectCallForSpeechCommand);
                        
                                if (result.Status == ResponseStatus.BussinesLogicError)
                                    return Forbid();
                                if (result.Status == ResponseStatus.NotFoundInDataBase)
                                    return NotFound();
                                if (result.Status == ResponseStatus.ValidationError)
                                    return BadRequest();
                                if (result.Status == ResponseStatus.BadQuery)
                                    return BadRequest();
                                if (!result.Success)
                                    return MethodFailure(result.Message);
                        
                                return NoContent();
                            }
                        
                            [HttpPost(&quot;evaluate&quot;, Name = &quot;evaluatecallforspeech&quot;)]
                            [ProducesResponseType(StatusCodes.Status200OK)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            public async Task&lt;ActionResult&lt;int&gt;&gt; Evaluate([FromBody] EvaluateCallForSpeechCommand evaluateCallForSpeechCommand)
                            {
                                var result = await _mediator.Send(evaluateCallForSpeechCommand);
                        
                                if (result.Status == ResponseStatus.BussinesLogicError)
                                    return Forbid();
                                if (result.Status == ResponseStatus.NotFoundInDataBase)
                                    return NotFound();
                                if (result.Status == ResponseStatus.ValidationError)
                                    return BadRequest();
                                if (result.Status == ResponseStatus.BadQuery)
                                    return BadRequest();
                                if (!result.Success)
                                    return MethodFailure(result.Message);
                        
                                return Ok(result);
                            }
                        
                            [HttpPost(&quot;accept&quot;, Name = &quot;acceptcallforspeech&quot;)]
                            [ProducesResponseType(StatusCodes.Status204NoContent)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            public async Task&lt;ActionResult&lt;int&gt;&gt; Accept([FromBody] AcceptCallForSpeechCommand ccceptCallForSpeechCommand)
                            {
                                var result = await _mediator.Send(ccceptCallForSpeechCommand);
                        
                                if (result.Status == ResponseStatus.BussinesLogicError)
                                    return Forbid();
                                if (result.Status == ResponseStatus.NotFoundInDataBase)
                                    return NotFound();
                                if (result.Status == ResponseStatus.ValidationError)
                                    return BadRequest();
                                if (result.Status == ResponseStatus.BadQuery)
                                    return BadRequest();
                                if (!result.Success)
                                    return MethodFailure(result.Message);
                        
                                return NoContent();
                            }
                        
                            [HttpPost(&quot;preliminaryaccept&quot;, Name = &quot;preliminaryacceptcallforspeech&quot;)]
                            [ProducesResponseType(StatusCodes.Status204NoContent)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            public async Task&lt;ActionResult&lt;int&gt;&gt; PreliminaryAccept([FromBody] PreliminaryAcceptCallForSpeechCommand preliminaryCallForSpeechCommand)
                            {
                                var result = await _mediator.Send(preliminaryCallForSpeechCommand);
                        
                                if (result.Status == ResponseStatus.BussinesLogicError)
                                    return Forbid();
                                if (result.Status == ResponseStatus.NotFoundInDataBase)
                                    return NotFound();
                                if (result.Status == ResponseStatus.ValidationError)
                                    return BadRequest();
                                if (result.Status == ResponseStatus.BadQuery)
                                    return BadRequest();
                                if (!result.Success)
                                    return MethodFailure(result.Message);
                        
                                return NoContent();
                            }
                        
                        
                        
                        
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CategoryController</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 17px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 17px !important;">































































































                        







































                        [Route(&quot;api/[controller]&quot;)]
                        [ApiController]
                        public class CategoryController : BaseGeekLemonController
                        {
                            private readonly IMediator _mediator;
                        
                            public CategoryController(IMediator mediator)
                            {
                                _mediator = mediator;
                            }
                        
                            [HttpGet(&quot;all&quot;, Name = &quot;getallcategories&quot;)]
                            [ProducesResponseType(StatusCodes.Status200OK)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
             
                            public async Task&lt;ActionResult&lt;List&lt;CategoryInListViewModel&gt;&gt;&gt; GetAllCategories()
                            {
                                var result = await _mediator.Send(new GetCategoriesListQuery());
                        
                                if (result.Status == ResponseStatus.BussinesLogicError)
                                    return Forbid(result.Message);
                                if (result.Status == ResponseStatus.NotFoundInDataBase)
                                    return NotFound(result.Message);
                                if (result.Status == ResponseStatus.ValidationError)
                                    return BadRequest(result.Message);
                                if (result.Status == ResponseStatus.BadQuery)
                                    return BadRequest(result.Message);
                                if (!result.Success)
                                    return MethodFailure(result.Message);
                        
                                return Ok(result.List);
                            }
                        
                            [HttpGet(&quot;byId/{id}&quot;, Name = &quot;GetCategoryById&quot;)]
                            [ProducesResponseType(StatusCodes.Status200OK)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            [ProducesDefaultResponseType]
                            public async Task&lt;ActionResult&lt;CategoryDto&gt;&gt; GetCategoryById(int id)
                            {
                                var result = await _mediator.Send
                                    (new GetCategoryQuery()
                                    { CategoryId = new CategoryId(id) });
                        
                                if (result.Status == ResponseStatus.BussinesLogicError)
                                    return Forbid(result.Message);
                                if (result.Status == ResponseStatus.NotFoundInDataBase)
                                    return NotFound(result.Message);
                                if (result.Status == ResponseStatus.ValidationError)
                                    return BadRequest(result.Message);
                                if (result.Status == ResponseStatus.BadQuery)
                                    return BadRequest(result.Message);
                                if (!result.Success)
                                    return MethodFailure(result.Message);
                        
                                return Ok(result.Category);
                            }
                        
                            [HttpGet(&quot;byuniqueid/{uid}&quot;, Name = &quot;GetCategoryByUniqueId&quot;)]
                            [ProducesResponseType(StatusCodes.Status200OK)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            [ProducesDefaultResponseType]
                            public async Task&lt;ActionResult&lt;CategoryDto&gt;&gt; GetCategoryByUniqueId(Guid uid)
                            {
                                var result = await _mediator.Send
                                    (new GetCategoryQuery()
                                    { CategoryUniqueId = new CategoryUniqueId(uid) });
                        
                                if (result.Status == ResponseStatus.BussinesLogicError)
                                    return Forbid(result.Message);
                                if (result.Status == ResponseStatus.NotFoundInDataBase)
                                    return NotFound(result.Message);
                                if (result.Status == ResponseStatus.ValidationError)
                                    return BadRequest(result.Message);
                                if (result.Status == ResponseStatus.BadQuery)
                                    return BadRequest(result.Message);
                                if (!result.Success)
                                    return MethodFailure(result.Message);
                        
                                return Ok(result.Category);
                            }
                        
                            [HttpPut(&quot;byId&quot;, Name = &quot;updateByIdcategory&quot;)]
                            [ProducesResponseType(StatusCodes.Status204NoContent)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            [ProducesDefaultResponseType]
                            public async Task&lt;ActionResult&gt; UpdateById([FromBody] UpdateCategoryById u)
                            {
                                UpdateCategoryCommand updateCommand = new UpdateCategoryCommand()
                                {
                                    DisplayName = u.DisplayName,
                                    Id = u.Id,
                                    Name = u.Name,
                                    WhatWeAreLookingFor = u.WhatWeAreLookingFor
                                };
                        
                                var result = await _mediator.Send(updateCommand);
                        
                        
                        
                                return NoContent();
                            }
                        
                            [HttpPut(&quot;ByUniqueId&quot;, Name = &quot;updateByUniqueIdcategory&quot;)]
                            [ProducesResponseType(StatusCodes.Status204NoContent)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            [ProducesDefaultResponseType]
                            public async Task&lt;ActionResult&gt; UpdateByUniqueId([FromBody] UpdateCategoryByUniqueId u)
                            {
                                UpdateCategoryCommand updateCommand = new UpdateCategoryCommand()
                                {
                                    DisplayName = u.DisplayName,
                                    UniqueId = u.UniqueId,
                                    Name = u.Name,
                                    WhatWeAreLookingFor = u.WhatWeAreLookingFor
                                };
                        
                                var result = await _mediator.Send(updateCommand);
                        
                                return NoContent();
                            }
                        
                            [HttpPost(Name = &quot;addcategory&quot;)]
                            [ProducesResponseType(StatusCodes.Status200OK)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            public async Task&lt;ActionResult&lt;IdsDto&gt;&gt; Create
                                ([FromBody] CreatedCategoryCommand createCategoryCommand)
                            {
                                var result = await _mediator.Send(createCategoryCommand);
                        
                                if (result.Status == ResponseStatus.BussinesLogicError)
                                    return Forbid(result.Message);
                                if (result.Status == ResponseStatus.NotFoundInDataBase)
                                    return NotFound(result.Message);
                                if (result.Status == ResponseStatus.ValidationError)
                                    return BadRequest(result.Message);
                                if (result.Status == ResponseStatus.BadQuery)
                                    return BadRequest(result.Message);
                                if (!result.Success)
                                    return MethodFailure(result.Message);
                        
                                return Ok(result.CategoryIds);
                            }
                        }
                      
                    </code>
                </pre>
            </div>
        </div>
    </section>

    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">GeekLemonConferenceInstallers</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">




















































































































































































































                        [Route(&quot;api/[controller]&quot;)]
                        [ApiController]
                        public class JudgeController : BaseGeekLemonController
                        {
                            private readonly IMediator _mediator;

                            public JudgeController(IMediator mediator)
                            {
                                _mediator = mediator;
                            }

                            [HttpGet(&quot;all&quot;, Name = &quot;getalljudges&quot;)]
                            [ProducesResponseType(StatusCodes.Status200OK)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            public async Task&lt;ActionResult&lt;List&lt;JudgesInListViewModel&gt;&gt;&gt; GetAllPosts()
                            {
                                var result = await _mediator.Send(new GetJudgesInListQuery());

                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.Forbid)
                                    return Forbid(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.NotFound)
                                    return NotFound(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.BadRequest)
                                    return BadRequest(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.MethodFailure)
                                    return MethodFailure(result.Message);

                                return Ok(result.List);
                            }

                            [HttpGet(&quot;byid/{id}&quot;, Name = &quot;getjudge&quot;)]
                            [ProducesResponseType(StatusCodes.Status200OK)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            [ProducesDefaultResponseType]
                            public async Task&lt;ActionResult&lt;JudgeViewModel&gt;&gt; GetJudgeById(int id)
                            {
                                var result = await _mediator.Send
                                    (new GetJudgeQuery() { JudeId = new JudgeId(id) });

                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.Forbid)
                                    return Forbid(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.NotFound)
                                    return NotFound(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.BadRequest)
                                    return BadRequest(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.MethodFailure)
                                    return MethodFailure(result.Message);

                                return Ok(result.Judge);
                            }

                            [HttpGet(&quot;byuqniqueid/{uid}&quot;, Name = &quot;GetJudgeByUniqueId&quot;)]
                            [ProducesResponseType(StatusCodes.Status200OK)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            [ProducesDefaultResponseType]
                            public async Task&lt;ActionResult&lt;JudgeViewModel&gt;&gt; GetJudgeByUniqueId(Guid uid)
                            {
                                var result = await _mediator.Send
                                    (new GetJudgeQuery() { JudgeUniqueId = new JudgeUniqueId(uid) });

                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.Forbid)
                                    return Forbid(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.NotFound)
                                    return NotFound(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.BadRequest)
                                    return BadRequest(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.MethodFailure)
                                    return MethodFailure(result.Message);

                                return Ok(result.Judge);
                            }

                            [HttpPost(Name = &quot;addjudge&quot;)]
                            [ProducesResponseType(StatusCodes.Status200OK)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            public async Task&lt;ActionResult&lt;JudgeIds&gt;&gt; Create([FromBody] CreateJudgeRequest judge)
                            {
                                CreateJudgeCommand c = new CreateJudgeCommand()
                                {
                                    Birthdate = judge.Birthdate,
                                    CategoryId = judge.CategoryId,
                                    Login = judge.Login,
                                    Name = judge.Name,
                                    Password = judge.Password,
                                };

                                var result = await _mediator.Send(c);

                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.Forbid)
                                    return Forbid(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.NotFound)
                                    return NotFound(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.BadRequest)
                                    return BadRequest(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.MethodFailure)
                                    return MethodFailure(result.Message);

                                return Ok(result.JudgeIds);
                            }

                            [HttpPut(&quot;ByUniqueId&quot;, Name = &quot;UpdateByUniqueId&quot;)]
                            [ProducesResponseType(StatusCodes.Status204NoContent)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            [ProducesDefaultResponseType]
                            public async Task&lt;ActionResult&gt; UpdateByUniqueId([FromBody] UpdateJudgeByUniqueId u)
                            {
                                UpdateJudgeCommand updateJudge = new UpdateJudgeCommand()
                                {
                                    UniqueId = u.UniqueId,
                                    Name = u.Name,
                                    Login = u.Password,
                                    Password = u.Password,
                                    Birthdate = u.Birthdate,
                                    CategoryId = u.CategoryId,
                                };

                                var result = await _mediator.Send(updateJudge);

                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.Forbid)
                                    return Forbid(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.NotFound)
                                    return NotFound(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.BadRequest)
                                    return BadRequest(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.MethodFailure)
                                    return MethodFailure(result.Message);

                                return NoContent();
                            }

                            [HttpPut(&quot;ById&quot;, Name = &quot;UpdateById&quot;)]
                            [ProducesResponseType(StatusCodes.Status204NoContent)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            [ProducesDefaultResponseType]
                            public async Task&lt;ActionResult&gt; UpdateById([FromBody] UpdateJudgeById u)
                            {
                                UpdateJudgeCommand updateJudge = new UpdateJudgeCommand()
                                {
                                    Id = u.Id,
                                    Name = u.Name,
                                    Login = u.Password,
                                    Password = u.Password,
                                    Birthdate = u.Birthdate,
                                    CategoryId = u.CategoryId,
                                };

                                var result = await _mediator.Send(updateJudge);

                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.Forbid)
                                    return Forbid(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.NotFound)
                                    return NotFound(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.BadRequest)
                                    return BadRequest(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.MethodFailure)
                                    return MethodFailure(result.Message);

                                return NoContent();
                            }

                            [HttpDelete(&quot;byuniqueId/{id}&quot;, Name = &quot;deletejudgedByUniqueId&quot;)]
                            [ProducesResponseType(StatusCodes.Status204NoContent)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            [ProducesDefaultResponseType]
                            public async Task&lt;ActionResult&gt; DeleteByUniqueId(Guid id)
                            {
                                var deletepostCommand = new DeleteJudgeCommand()
                                {
                                    UniqueId
                                    = new JudgeUniqueId(id)
                                };

                                var result = await _mediator.Send(deletepostCommand);

                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.Forbid)
                                    return Forbid(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.NotFound)
                                    return NotFound(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.BadRequest)
                                    return BadRequest(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.MethodFailure)
                                    return MethodFailure(result.Message);

                                return NoContent();
                            }

                            [HttpDelete(&quot;byId/{id}&quot;, Name = &quot;deletejudgebyid&quot;)]
                            [ProducesResponseType(StatusCodes.Status204NoContent)]
                            [ProducesResponseType(StatusCodes.Status404NotFound)]
                            [ProducesResponseType(StatusCodes.Status400BadRequest)]
                            [ProducesResponseType(StatusCodes.Status403Forbidden)]
                            [ProducesResponseType(420)]
                            [ProducesDefaultResponseType]
                            public async Task&lt;ActionResult&gt; DeleteById(int id)
                            {
                                var deletepostCommand = new DeleteJudgeCommand()
                                {
                                    Id
                                    = new JudgeId(id)
                                };

                                var result = await _mediator.Send(deletepostCommand);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.Forbid)
                                    return Forbid(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.NotFound)
                                    return NotFound(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.BadRequest)
                                    return BadRequest(result.Message);
                                if (result.WhatHTTPCodeToBeRetruned == WhatHTTPCodeShouldBeRetruned.MethodFailure)
                                    return MethodFailure(result.Message);

                                return NoContent();
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <!-- <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/api/05.gif" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section> -->
    <section class="slide conicG">
        <span class="shout colors" ><span>DEMO
        </span></span>
    </section>
    <section class="slide conicG">
        <span class="shout colors" >Pora na EventSourcing<br />
            <span>👨‍💻
        </span></span>
    </section>
    <section class="slide creamPPPGragient">
        <span class="shout colors">Co to jest jest Event Sourcing?<br />
            <span>👨‍💻
            </span></span>
    </section>
    <section class="slide creamPP   compact ">
        <h2>Event sourcing</h2>
        <ol class="nonumbers">
            <li class="next"><span class="yellow">Zdarzenie</span> jest to fakt który się dokonał i nie może być zmieniony</li>
            <li class="next"><span class="yellow">Zdarzenie</span> jest w czasie przeszłym</li>
            <!-- <li class="next"><span class="green">Entity</span></li>
            <li class="next"><span class="purple">Aggregate</span></li> -->
        </ol>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/ADOBE/CQRS-03.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamPP fullscreen " >
        <div class="grid-container-slidepoint">
            <div class="SlidePointImage">
                <img  src="pictures/iconsFr2/cons.png" />
            </div>
            <div class="SlidePointText">
                <ol class="nonumbers ">
                    <li class="next bold">Problemy i wady Event Sourcing</li>
                    <ol class="nonumbers">
                        <li class="next">Zwiększona złożoność aplikacji</li>
                        <li class="next">Potrzeba unikatowych identyfikatorów encji przed operacjami</li>
                        <li class="next">Problemy z tak zwaną <br /> <span class="red">"eventual consistency"</span></li>
                  
                    </ol>
                </ol>
            </div>
          </div>
    </section>
    
    <section class="slide conicG2">
        <span class="shout colors" >O to moja prawdziwa historia z zakupem abonamentu w Player TVN
        </span></span>
    </section>
    <section class="slide conicG2">
        <span class="shout colors" >Kupiłem abonament, ale nawet po 5 minutach nie mogłem oglądać swojego pakietu
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/Screenshot_20210304-220055_player.jpg" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamPPPGragient">
        <span class="shout colors" >Godzinę później już tak
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/Screenshot_20210227-194753_player.jpg" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/ADOBE/CQRS-03.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamPP fullscreen " >
        <div class="grid-container-slidepoint">
            <div class="SlidePointImage">
                <img  src="pictures/iconsFr2/speedometer.png" />
            </div>
            <div class="SlidePointText">
                <ol class="nonumbers">
                    <li class="next bold">Zaleta : Lepszy Performance</li>
                    <ol class="nonumbers">
                        <li class="next">Prawdopodobnie najlepszy powód &nbsp;&nbsp;&nbsp;&nbsp;</li>
                        <li class="next">A to wynika z innego powodu. A dokładnie...</li>

                    </ol>
                </ol>
            </div>
          </div>
    </section>
    <section class="slide creamPP fullscreen " >
        <div class="grid-container-slidepoint">
            <div class="SlidePointImage">
                <img  src="pictures/iconsFr2/no-sick-people.png" />
            </div>
            <div class="SlidePointText smallerfont3">
                <ol class="nonumbers">
                    <li class="next bold">Zaleta : Oddziela model odczytu i zapisu </li>
                    <ol class="nonumbers">
                        <li class="next">Każda operacja zmieniajaca coś jest zdarzeniem. 
                         </li>
                            <li class="next">   Te zdarzenie trafia do kolejki</li>
                            
                        <li class="next">Kolejka może być obsłużona przez wiele endpointów i baz danych</li>
                        <li class="next">Kto powiedział, że możesz mieć jedną bazę do odczytu</li>
                </ol>
            </div>
          </div>
    </section>

    <section class="slide creamPP fullscreen " >
        <div class="grid-container-slidepoint">
            <div class="SlidePointImage">
                <img  src="pictures/iconsFr2/NOSQL.png" />
            </div>
            <div class="SlidePointText smallerfont3">
                <ol class="nonumbers">
                    <li class="next bold">Zaleta : Inne spojrzenie na bazę danych</li>
                    <ol class="nonumbers">
                        <li class="next">Dlaczego nie wyrzucić bazę relacyjną SQL do kosza</li>
                        <li class="next">Może niech log zdarzeniowy będzie głównym źródłem informacji</li>
                        <li class="next">Pomyśl o mikroserwisach które emitują zdarzenia, które są odczytywane wzajemnie</li>
                        <li class="next">Redis (NoSql) z event sourcing mógłby dać kopa</li>

                    </ol>
                </ol>
            </div>
          </div>
    </section>
    <section class="slide creamPP fullscreen " >
        <div class="grid-container-slidepoint">
            <div class="SlidePointImage">
                <img  src="pictures/iconsFr2/3d-modeling.png" />
            </div>
            <div class="SlidePointText smallerfont3">
                <ol class="nonumbers">
                    <li class="next bold">Zaleta : Alternatywne modelowanie danych</li>
                    <ol class="nonumbers">
                        <li class="next">Event Sourcing odwaraca związek pomiędzy danymi, a zdarzeniami</li>
                        <li class="next">Zdarzenia sterują logiką biznesową </li>
                        <li class="next">Zdarzenia są niezmiena i są pewną gwarnacją dokonanego stanu</li>
                        <li class="next">Zdarzenia byłby formą logów przepływu operacji na danej encji</li>
                    </ol>
                </ol>
            </div>
          </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/twitter.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamPP fullscreen " >
        <div class="grid-container-slidepoint">
            <div class="SlidePointImage">
                <img  src="pictures/iconsFr2/elastic.png" />
            </div>
            <div class="SlidePointText smallerfont3">
                <ol class="nonumbers">
                    <li class="next bold">Zaleta : Elastyczność </li>
                    <ol class="nonumbers">
                        <li class="next">Mamy sepracje akcji od efektu</li>
                        <li class="next">Co daje elastyczność </li>
                        <li class="next">Nie jesteś uwięziony w modelu który musi pasować do wszystkiego</li>
                        <li class="next">Trzeba tylko dobrze przetestować swój strumień zdarzeń</li>
                    </ol>
                </ol>
            </div>
          </div>
    </section>
    <section class="slide creamPP fullscreen " >
        <div class="grid-container-slidepoint">
            <div class="SlidePointImage">
                <img  src="pictures/iconsFr2/audit.png" />
            </div>
            <div class="SlidePointText smallerfont3">
                <ol class="nonumbers">
                    <li class="next bold">Zaleta : Audyt </li>
                    <ol class="nonumbers">
                        <li class="next">Masz historię operacji w swojej bazie danych</li>
                        <li class="next">Możesz to wykorzystać do analizy, do regulacji bezpieczeństwa</li>
                        <li class="next">Aplikację np. finasowe muszą posiadać taką historię</li>
                        <li class="next">Wyobraż sobie bank który nie pamięta gdzie zrobiłeś przelew</li>
                    </ol>
                </ol>
            </div>
          </div>
    </section>
    <section class="slide creamPP fullscreen " >
        <div class="grid-container-slidepoint">
            <div class="SlidePointImage">
                <img  src="pictures/iconsFr2/gdpr.png" />
            </div>
            <div class="SlidePointText">
                <ol class="nonumbers">
                    <li class="next bold">Problemy i wady Event Sourcing CDN</li>
                    <ol class="nonumbers">
                        <li class="next">Audyt? A co na to RODO ?</li>
                        <li class="next">Jak kasować tę historię ?</li>
                    </ol>
                </ol>
            </div>
          </div>
    </section>
    <section class="slide creamPP fullscreen " >
        <div class="grid-container-slidepoint">
            <div class="SlidePointImage">
                <img  src="pictures/iconsFr2/restore.png" />
            </div>
            <div class="SlidePointText">
                <ol class="nonumbers">
                    <li class="next bold">Zaleta : Snapshoot</li>
                    <ol class="nonumbers">
                        <li class="next">Mając historię zdarzeń byłoby możliwe cofnać system w historii</li>
                        <li class="next">Temat jednak jeszcze bardziej zaawansowany i go wam dziś nie pokaże</li>
                    </ol>
                </ol>
            </div>
          </div>
    </section>
    <section class="slide creamPP smaller   compact ">
        <h2>Podsumowanie EventSourcing</h2>
        <ol class="nonumbers">
            <li class="next">Zdolność skalowania odczytu i zapisu niezależnie od siebie</li>
            <li class="next">Wolność w tworzeniu dwolnie dopasowanych modelu</li>
            <li class="next">Dato centryczne podejście do modelowanie systemu</li>
            <li class="next">Luźno powiązana logika biznesowa</li>
            <li class="next">Audit Driven Application</li>
        </ol>
    </section>
    <section class="slide conicG2">
        <span class="shout colors" >Co zmienia event sourcing w naszym systemie ?
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/ADOBE/workflow-normal2.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/ADOBE/workflow.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/ADOBE/workflow-02.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/ADOBE/workflow-03.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/ADOBE/proces.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/ADOBE/workflow-04.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/ADOBE/workflow-05.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/ADOBE/workflow-06.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>

    <section class="slide conicG">
        <span class="shout colors" >Piszemy więc projekty<br /> <span>Domain.Events
            👨‍💻
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/domainE/01.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">Interface IMessage i IEvent</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        public interface IMessage
                        {
                        }
                        
                        public interface IEvent : IMessage
                        {
                            public int Version { get; set; }
                            DateTimeOffset TimeStamp { get; set; }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">DomainEvent</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        public abstract class DomainEvent : IEvent
                        {
                            public AggregateKey Key { get; set; }
                        
                            public int Version { get; set; }
                            public DateTimeOffset TimeStamp { get; set; }
                        
                            protected DomainEvent(DateTimeOffset occuredOn, int version)
                            {
                                TimeStamp = occuredOn;
                                Version = version;
                            }
                        
                            protected DomainEvent(int version)
                            {
                                TimeStamp = AppTime.Now();
                                Version = version;
                            }
                        
                            protected DomainEvent()
                            {
                        
                            }
                        
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AggregateKey</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        public class AggregateKey : ValueObject&lt;AggregateKey&gt;
                        {
                            public string Type { get; set; }
                            public string Id { get; set; }
                        
                            protected override IEnumerable&lt;object&gt; GetAttributesToIncludeInEqualityCheck()
                            {
                                yield return Type;
                                yield return Id;
                            }
                        
                            public static readonly AggregateKey Empty = new AggregateKey();
                        
                            public override string ToString()
                            {
                                return Id;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">BaseUniqueId</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 22px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 22px !important;">
                        public abstract class BaseUniqueId&lt;T&gt; 
                        : ValueObject&lt;T&gt; where T : ValueObject&lt;T&gt;
                        {

                            public abstract string ValueInString();
                        
                            protected abstract string GetName();
                        
                            public AggregateKey GetAggregateKey()
                            {
                                return new AggregateKey
                                {
                                    Id = ValueInString(),
                                    Type = GetName()
                                };
                            }
                        
                            public BaseUniqueId()
                            {
                        
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AppTime, aby czas można było testować</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 22px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 22px !important;">

                        public class CategoryCreateEvent : DomainEvent
                        {
                            public CategoryUniqueId UniqueId { get; init; }
                        
                            public string Name { get; init; }
                        
                            public string DisplayName { get; init; }
                        
                            public string WhatWeAreLookingFor { get; init; }
                        
                            public CategoryCreateEvent(CategoryUniqueId uniqueId,
                                string Name, string displayName, string whatWeAreLookingFor,
                                int version)
                                : base(version)
                            {
                        
                                UniqueId = uniqueId;
                                Key = this.UniqueId.GetAggregateKey();
                                DisplayName = displayName;
                                WhatWeAreLookingFor = whatWeAreLookingFor;
                            }
                        
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CategoryUpdateEvent</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 22px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 22px !important;">
                        public class CategoryUpdateEvent : DomainEvent
                        {
                            public CategoryUniqueId UniqueId { get; init; }
                    
                            public string Name { get; init; }
                    
                            public string DisplayName { get; init; }
                    
                            public string WhatWeAreLookingFor { get; init; }
                    
                            public CategoryUpdateEvent(CategoryUniqueId uniqueId,
                                string Name, string displayName, string whatWeAreLookingFor,
                                int version)
                                : base(version)
                            {
                    
                                UniqueId = uniqueId;
                                Key = this.UniqueId.GetAggregateKey();
                                DisplayName = displayName;
                                WhatWeAreLookingFor = whatWeAreLookingFor;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">JudgeCreatedEvent</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">





                        public class JudgeCreatedEvent : DomainEvent
                        {
                            public Login Login { get; init; }
                            public Password Password { get; init; }
                            public Name Name { get; init; }
                            public Category Category { get; init; }
                            public DateTime Birthdate { get; init; }
                            public JudgeUniqueId UniqueId { get; init; }
                        
                            public JudgeCreatedEvent(DateTime birthdate,
                                Category category, JudgeUniqueId uniqueId,
                                Login login, Password password, Name name,
                                int version) :
                                base(version)
                            {
                                Birthdate = birthdate;
                                Category = category;
                                UniqueId = uniqueId;
                                Login = login;
                                Name = name;
                                Password = password;
                                Key = this.UniqueId.GetAggregateKey();
                                Version = version;
                            }
                        
                            public JudgeCreatedEvent()
                            {
                        
                            }
                        
                        
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">JudgeDeletedEvent</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 22px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 22px !important;">
                        public class JudgeDeletedEvent : DomainEvent
                        {
                            public JudgeUniqueId UniqueId { get; init; }
                    
                            public JudgeDeletedEvent(int version) :
                                base(version)
                            {
                    
                    
                            }
                    
                    
                            public JudgeDeletedEvent()
                            {
                    
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">JudgeUpdatedEvent</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 22px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 22px !important;">















                        public class JudgeUpdatedEvent : DomainEvent
                        {
                            public Login Login { get; init; }
                            public Password Password { get; init; }
                            public Name Name { get; init; }
                            public Category Category { get; init; }
                            public DateTime Birthdate { get; init; }
                            public JudgeUniqueId UniqueId { get; init; }
                    
                            public JudgeUpdatedEvent(DateTime birthdate,
                                Category category, JudgeUniqueId uniqueId,
                                Login login, Password password, Name name,
                                int version) :
                                base(version)
                            {
                                Birthdate = birthdate;
                                Category = category;
                                UniqueId = uniqueId;
                                Login = login;
                                Name = name;
                                Password = password;
                                Key = this.UniqueId.GetAggregateKey();
                                Version = version;
                            }
                    
                            public JudgeUpdatedEvent()
                            {
                    
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>


    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CallForSpeechSubmitedEvent</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 18px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 18px !important;">











   






                        public class CallForSpeechSubmitedEvent : DomainEvent
                        {
                            public Speaker Speaker { get; init; }
                            public Speech Speech { get; init; }
                            public Registration Registration { get; init; }
                            public CallForSpeechNumber Number { get; init; }
                    
                            public Category Category { get; init; }
                            public CallForSpeechStatus Status { get; init; }
                    
                            public CallForSpeechScoringResult Score { get; init; }
                    
                            public Decision PreliminaryDecision { get; init; }
                            public Decision FinalDecision { get; init; }
                    
                            public CallForSpeechUniqueId UniqueId { get; init; }
                    
                            public CallForSpeechSubmitedEvent(Speaker speaker, Speech speech,
                                Registration registration, CallForSpeechNumber number, Category category,
                                CallForSpeechStatus status, CallForSpeechScoringResult score,
                                Decision preliminaryDecision, Decision finalDecision, CallForSpeechUniqueId uniqueId,
                                int version)
                                : base(version)
                            {
                                Speaker = speaker;
                                Speech = speech;
                                Registration = registration;
                                Number = number;
                                Category = category;
                                Status = status;
                                Score = score;
                                PreliminaryDecision = preliminaryDecision;
                                FinalDecision = finalDecision;
                                UniqueId = uniqueId;
                                this.Key = UniqueId.GetAggregateKey();
                            }
                    
                            public CallForSpeechSubmitedEvent()
                            {
                    
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CallForSpeechRejectedEvent</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 18px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 18px !important;">
















                        public class CallForSpeechRejectedEvent : DomainEvent
                        {
                            public Speaker Speaker { get; init; }
                            public Speech Speech { get; init; }
                            public Registration Registration { get; init; }
                            public CallForSpeechNumber Number { get; init; }
                    
                            public Category Category { get; init; }
                            public CallForSpeechStatus Status { get; init; }
                    
                            public CallForSpeechScoringResult Score { get; init; }
                    
                            public Decision PreliminaryDecision { get; init; }
                            public Decision FinalDecision { get; init; }
                    
                            public CallForSpeechUniqueId UniqueId { get; init; }
                    
                            public CallForSpeechRejectedEvent(Speaker speaker, Speech speech,
                                Registration registration, CallForSpeechNumber number, Category category,
                                CallForSpeechStatus status, CallForSpeechScoringResult score,
                                Decision preliminaryDecision, Decision finalDecision, CallForSpeechUniqueId uniqueId,
                                int version)
                                : base(version)
                            {
                                Speaker = speaker;
                                Speech = speech;
                                Registration = registration;
                                Number = number;
                                Category = category;
                                Status = status;
                                Score = score;
                                PreliminaryDecision = preliminaryDecision;
                                FinalDecision = finalDecision;
                                UniqueId = uniqueId;
                                this.Key = UniqueId.GetAggregateKey();
                            }
                    
                            //public CallForSpeechRejectedEvent()
                            //{
                    
                            //}
                    
                    
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide conicG">
        <span class="shout colors" >Piszemy więc projekty<br /> <span>Application.EventSourcing
            👨‍💻
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/applicationE/01.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide conicG2">
        <span class="shout colors" >Co to jest wzorzec projektowy Aggregate ?
            <br /><span>🗃️</span>
      </span>
    </section>
    <section class="slide conicG2">
        <span class="shout colors" >Aggregate to najtrudniejszy blok DDD
            <br /><span>🗃️</span>
       </span>
    </section>
    <section class="slide creamPP   compact ">
        <h2>Bloki DDD</h2>
        <ol class="nonumbers">
            <li class="next"><span class="yellow">ValueObject</span></li>
            <li class="next"><span class="green">Entity</span></li>
            <li class="next"><span class="blue">Aggregate</span></li>
        </ol>
    </section>
    <section class="slide conicG2">
        <span class="shout colors" >Aggregate : to kolekcja obiektów którą chcemy traktować jako jednostkę
            <br />
            <span>🗃️
           
        </span></span>
    </section>
    <section class="slide conicG2">
        <span class="shout colors" >Aggregate : to encja która trzyma inne encje , a w niej są obiekty wartościowe
            <br /><span>🗃️

        </span></span>
    </section>
    <section class="slide conicG2">
        <span class="shout colors" >Celem aggregatu jest trzymanie modelu domenowego do 1 typu</span>
    </section>
    <section class="slide conicG2">
        <span class="shout colors" >Aggregat sam sobie też jest atomowy w swojej persystencji</span>
    </section>
    <section class="slide conicG2">
        <span class="shout colors" >Jak widzisz mamy zdarzenia różne per model domenowy
    </section>
    <section class="slide conicG2">
        <span class="shout colors" >W tym przypadku będziemy mieli listę zdarzeń per model domenowy to nasz agreggat</span>
    </section>

    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AggregateRoot</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 22px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 22px !important;">














































                        public abstract class AggregateRoot
                        {
                            private readonly List&lt;DomainEvent&gt; _changes = new List&lt;DomainEvent&gt;();
                        
                            public AggregateKey Key { get; protected set; }
                            public int Version { get; protected set; }
                        
                            public override string ToString()
                            {
                                return Key.Id + Key.Type;
                            }
                        
                            public IEnumerable&lt;DomainEvent&gt; GetUncommittedChanges()
                            {
                                lock (_changes)
                                {
                                    return _changes.ToArray();
                                }
                            }
                        
                            public void MarkChangesAsCommitted()
                            {
                                lock (_changes)
                                {
                                    Version = Version + _changes.Count;
                                    _changes.Clear();
                                }
                            }
                        
                            public void LoadFromHistory(IEnumerable&lt;DomainEvent&gt; history)
                            {
                                foreach (var e in history)
                                {
                                    //if (e.Version != Version + 1)
                                    //    throw new EventsOutOfOrderException(e.Key);

                                    ApplyChange(e, false);
                                }

                            }F
                        
                            protected void ApplyChange(DomainEvent @event)
                            {
                                ApplyChange(@event, true);
                            }
                        
                            private void ApplyChange(DomainEvent @event, bool isNew)
                            {
                                lock (_changes)
                                {
                                    this.AsDynamic().Apply(@event);
                        
                                    if (isNew)
                                    {
                                        _changes.Add(@event);
                                    }
                                    else
                                    {
                                        Key = @event.Key;
                                        //Version++;
                                    }
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide conicG2">
        <span class="shout colors" >Pomocna refleksja przy ApplyChange</span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">PrivateReflectionDynamicObjectExtensions</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 22px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 22px !important;">
                        internal static class PrivateReflectionDynamicObjectExtensions
                        {
                            public static dynamic AsDynamic(this object o)
                            {
                                return PrivateReflectionDynamicObject.WrapObjectIfNeeded(o);
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>

    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">PrivateReflectionDynamicObject</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">




                        


























                        internal class PrivateReflectionDynamicObject : DynamicObject
                        {
                            public object RealObject { get; set; }
                            private const BindingFlags bindingFlags = 
                            BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic;
                        
                            internal static object WrapObjectIfNeeded(object o)
                            {
                                // Don&#39;t wrap primitive types, which don&#39;t have many interesting internal APIs
                                if (o == null || o.GetType().IsPrimitive || o is string)
                                    return o;
                        
                                return new PrivateReflectionDynamicObject() { RealObject = o };
                            }
                        
                            // Called when a method is called
                            public override bool TryInvokeMember
                            (InvokeMemberBinder binder, object[] args, out object result)
                            {
                                result = InvokeMemberOnType(RealObject.GetType(), RealObject, binder.Name, args);
                        
                                // Wrap the sub object if necessary. This allows nested anonymous objects to work.
                                result = WrapObjectIfNeeded(result);
                        
                                return true;
                            }
                        
                            private static object InvokeMemberOnType
                            (Type type, object target, string name, object[] args)
                            {
                                try
                                {
                                    // Try to incoke the method
                                    return type.InvokeMember(
                                        name,
                                        BindingFlags.InvokeMethod | bindingFlags,
                                        null,
                                        target,
                                        args);
                                }
                                catch (MissingMethodException)
                                {
                                    // If we couldn&#39;t find the method, try on the base class
                                    if (type.BaseType != null)
                                    {
                                        return InvokeMemberOnType(type.BaseType, target, name, args);
                                    }
                                    //Don&#39;t care if the method don&#39;t exist.
                                    return null;
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">ApplyChange  w Aggregate</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">

                        private void ApplyChange(DomainEvent @event, bool isNew)
                        {
                            lock (_changes)
                            {
                                this.AsDynamic().Apply(@event);
                    
                                if (isNew)
                                {
                                    _changes.Add(@event);
                                }
                                else
                                {
                                    Key = @event.Key;
                                    Version++;
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/applicationE/03.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CategoryAggregate</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">










                        









                        











                        public class CategoryAggregate : AggregateRoot
                        {
                            public string Name { get; private set; }
                        
                            public string DisplayName { get; private set; }
                        
                            public string WhatWeAreLookingFor { get; private set; }
                        
                            public CategoryUniqueId UniqueId { get; private set; }
                        
                            private void Apply(CategoryCreateEvent e)
                            {
                                Version = e.Version;
                                Name = e.Name;
                                DisplayName = e.DisplayName;
                                UniqueId = e.UniqueId;
                                WhatWeAreLookingFor = e.WhatWeAreLookingFor;
                                this.Key = e.UniqueId.GetAggregateKey();
                            }
                        
                            private void Apply(CategoryUpdateEvent e)
                            {
                                Version = e.Version++;
                                Name = e.Name;
                                DisplayName = e.DisplayName;
                                UniqueId = e.UniqueId;
                                WhatWeAreLookingFor = e.WhatWeAreLookingFor;
                                this.Key = e.UniqueId.GetAggregateKey();
                            }
                        
                            public CategoryAggregate(Category cc)
                            {
                                var c = new CategoryCreateEvent(cc.UniqueId, cc.Name,
                                    cc.DisplayName, cc.WhatWeAreLookingFor,
                                    cc.Version);
                        
                                ApplyChange(c);
                            }
                        
                            public CategoryAggregate()
                            {
                        
                            }
                        
                            public void Update(Category cc)
                            {
                                var c = new CategoryUpdateEvent(cc.UniqueId, cc.Name,
                                    cc.DisplayName, cc.WhatWeAreLookingFor,
                                    cc.Version);
                        
                                ApplyChange(c);
                            }
                        
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">ApplyChange</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">

                        private void ApplyChange(DomainEvent @event, bool isNew)
                        {
                            lock (_changes)
                            {
                                this.AsDynamic().Apply(@event);
                    
                                if (isNew)
                                {
                                    _changes.Add(@event);
                                }
                                else
                                {
                                    Key = @event.Key;
                                    Version++;
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>




    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AppTime, aby czas można było testować</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 23px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 23px !important;">
                        public static class AggregateFactory
                        {
                            public static T CreateAggregate&lt;T&gt;()
                            {
                                try
                                {
                                    return (T)Activator.CreateInstance(typeof(T), true);
                                }
                                catch (MissingMethodException)
                                {
                                    throw new MissingParameterLessConstructorException(typeof(T));
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>

    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">JudgeAggregate</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">




































                        





















                        public class JudgeAggregate : AggregateRoot
                        {
                            public Login Login { get; private set; }
                            public Password Password { get; private set; }
                            public Name Name { get; private set; }
                        
                            public Category Category { get; private set; }
                        
                            public DateTime Birthdate { get; private set; }
                            public JudgeUniqueId UniqueId { get; private set; }
                        
                            private void Apply(JudgeCreatedEvent e)
                            {
                                Version = e.Version;
                                Login = e.Login;
                                Password = e.Password;
                                Category = e.Category;
                                Birthdate = e.Birthdate;
                                UniqueId = e.UniqueId;
                                Key = e.Key;
                            }
                        
                            private void Apply(JudgeUpdatedEvent e)
                            {
                                Version = e.Version++;
                                Login = e.Login;
                                Password = e.Password;
                                Category = e.Category;
                                Birthdate = e.Birthdate;
                                UniqueId = e.UniqueId;
                                Key = e.Key;
                            }
                        
                            private void Apply(JudgeDeletedEvent e)
                            {
                                Version = e.Version++;
                                UniqueId = e.UniqueId;
                                Key = e.Key;
                            }
                        
                            public JudgeAggregate()
                            {
                        
                            }
                        
                            public JudgeAggregate(Judge j)
                            {
                                var c = new JudgeCreatedEvent(j.Birthdate,
                                    j.Category, j.UniqueId,
                                    j.Login,
                                    j.Password,
                                    j.Name, j.Version);
                        
                                ApplyChange(c);
                            }
                        
                            public void Update(Judge j)
                            {
                        
                        
                                var c = new JudgeUpdatedEvent(Birthdate,
                                        Category, UniqueId,
                                        Login,
                                        Password,
                                        Name, Version);
                        
                                c.Key = c.UniqueId.GetAggregateKey();
                                ApplyChange(c);
                            }
                        
                            public void Delete(JudgeUniqueId id, int version)
                            {
                                var eve = new
                                    JudgeDeletedEvent(version)
                                { UniqueId = id };
                        
                                eve.Key = eve.UniqueId.GetAggregateKey();
                        
                                ApplyChange(eve);
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CallForSpeechAggregate</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">






































































































































                        public class CallForSpeechAggregate : AggregateRoot
                        {
                            public Speaker Speaker { get; set; }
                            public Speech Speech { get; set; }
                            public Registration Registration { get; set; }
                            public CallForSpeechNumber Number { get; set; }
                        
                            public Category Category { get; set; }
                            public CallForSpeechStatus Status { get; set; }
                        
                            public CallForSpeechScoringResult Score { get; set; }
                        
                            public CallForSpeechUniqueId UniqueId { get; set; }
                        
                            public Decision PreliminaryDecision { get; set; }
                            public Decision FinalDecision { get; set; }
                        
                            private void Apply(CallForSpeechSubmitedEvent e)
                            {
                                Speaker = e.Speaker;
                                Speech = e.Speech;
                                Registration = e.Registration;
                                Number = e.Number;
                                Category = e.Category;
                                Status = e.Status;
                                PreliminaryDecision = e.PreliminaryDecision;
                                FinalDecision = e.FinalDecision;
                                UniqueId = e.UniqueId;
                                Version = e.Version++;
                                this.Key = e.UniqueId.GetAggregateKey();
                            }
                        
                            private void Apply(CallForSpeechRejectedEvent e)
                            {
                                Speaker = e.Speaker;
                                Speech = e.Speech;
                                Registration = e.Registration;
                                Number = e.Number;
                                Category = e.Category;
                                Status = e.Status;
                                PreliminaryDecision = e.PreliminaryDecision;
                                FinalDecision = e.FinalDecision;
                                UniqueId = e.UniqueId;
                                Version = e.Version++;
                                this.Key = e.UniqueId.GetAggregateKey();
                            }
                        
                            private void Apply(CallForSpeechPreliminaryAcceptEvent e)
                            {
                                Speaker = e.Speaker;
                                Speech = e.Speech;
                                Registration = e.Registration;
                                Number = e.Number;
                                Category = e.Category;
                                Status = e.Status;
                                PreliminaryDecision = e.PreliminaryDecision;
                                FinalDecision = e.FinalDecision;
                                UniqueId = e.UniqueId;
                                Version = e.Version++;
                                this.Key = e.UniqueId.GetAggregateKey();
                            }
                        
                        
                            private void Apply(CallForSpeechAcceptedEvent e)
                            {
                                Speaker = e.Speaker;
                                Speech = e.Speech;
                                Registration = e.Registration;
                                Number = e.Number;
                                Category = e.Category;
                                Status = e.Status;
                                PreliminaryDecision = e.PreliminaryDecision;
                                FinalDecision = e.FinalDecision;
                                UniqueId = e.UniqueId;
                                Version = e.Version++;
                                this.Key = e.UniqueId.GetAggregateKey();
                            }
                        
                            private void Apply(CallForSpeechEvaulatedEvent e)
                            {
                                Speaker = e.Speaker;
                                Speech = e.Speech;
                                Registration = e.Registration;
                                Number = e.Number;
                                Category = e.Category;
                                Status = e.Status;
                                PreliminaryDecision = e.PreliminaryDecision;
                                FinalDecision = e.FinalDecision;
                                UniqueId = e.UniqueId;
                                Version = e.Version++;
                                this.Key = e.UniqueId.GetAggregateKey();
                            }
                        
                        
                        
                            public CallForSpeechAggregate(CallForSpeech cc)
                            {
                                var c = new CallForSpeechSubmitedEvent
                                    (cc.Speaker, cc.Speech, cc.Registration,
                                    cc.Number, cc.Category, cc.Status, cc.Score,
                                    cc.PreliminaryDecision, cc.FinalDecision,
                                    cc.UniqueId, cc.Version);
                                this.Key = c.UniqueId.GetAggregateKey();
                                ApplyChange(c);
                            }
                        
                            public void Rejected(CallForSpeech cc)
                            {
                                var c = new CallForSpeechRejectedEvent
                                    (cc.Speaker, cc.Speech, cc.Registration,
                                    cc.Number, cc.Category, cc.Status, cc.Score,
                                    cc.PreliminaryDecision, cc.FinalDecision,
                                    cc.UniqueId, cc.Version);
                                this.Key = c.UniqueId.GetAggregateKey();
                                ApplyChange(c);
                            }
                        
                            public void PreliminaryAccepted(CallForSpeech cc)
                            {
                                var c = new CallForSpeechPreliminaryAcceptEvent
                                    (cc.Speaker, cc.Speech, cc.Registration,
                                    cc.Number, cc.Category, cc.Status, cc.Score,
                                    cc.PreliminaryDecision, cc.FinalDecision,
                                    cc.UniqueId, cc.Version);
                                this.Key = c.UniqueId.GetAggregateKey();
                                ApplyChange(c);
                            }
                        
                            public void Evaulated(CallForSpeech cc)
                            {
                                var c = new CallForSpeechEvaulatedEvent
                                    (cc.Speaker, cc.Speech, cc.Registration,
                                    cc.Number, cc.Category, cc.Status, cc.Score,
                                    cc.PreliminaryDecision, cc.FinalDecision,
                                    cc.UniqueId, cc.Version);
                                this.Key = c.UniqueId.GetAggregateKey();
                                ApplyChange(c);
                            }
                        
                            public void Accepted(CallForSpeech cc)
                            {
                                var c = new CallForSpeechAcceptedEvent
                                    (cc.Speaker, cc.Speech, cc.Registration,
                                    cc.Number, cc.Category, cc.Status, cc.Score,
                                    cc.PreliminaryDecision, cc.FinalDecision,
                                    cc.UniqueId, cc.Version);
                                this.Key = c.UniqueId.GetAggregateKey();
                                ApplyChange(c);
                            }
                        
                            public CallForSpeechAggregate()
                            {
                        
                            }
                        
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide conicG">
        <span class="shout colors" ><span>Kontrakty czyli interfejsy dla EventSourcing
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/applicationE/04.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamGG">
        <span class="shout colors" ><span>Przykład wzorca Unity Of Work
        </span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">ISessionForEventSourcing</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        public interface ISessionForEventSourcing
                        {
                            ExecutionStatus Add&lt;T&gt;(T aggregate) 
                            where T : AggregateRoot;

                            ExecutionStatus&lt;T&gt; Get&lt;T&gt;
                            (AggregateKey id, int? expectedVersion = null) 
                            where T : AggregateRoot;

                            ExecutionStatus Commit();
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/Session.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">IEventRepository</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        public interface IEventRepository
                        {
                            void Save&lt;T&gt;
                            (T aggregate, int? expectedVersion = null) 
                            where T : AggregateRoot;

                            T Get&lt;T&gt;
                            (AggregateKey aggregateId) 
                            where T : AggregateRoot;
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/Session2.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/Session3.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">IEventStore</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        public interface IEventStore
                        {
                            void Save(DomainEvent @event);
                            List&lt;DomainEvent&gt; Get(AggregateKey aggregateId, int fromVersion);
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AppTime, aby czas można było testować</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        public interface IEventPublisher
                        {
                            void Publish&lt;T&gt;(T @event) where T : DomainEvent;
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/applicationE/07.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AggregateNotFoundException</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 15px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 15px !important;">












                        
























                        public class AggregateNotFoundException : System.Exception
                        {
                            public AggregateNotFoundException(AggregateKey id)
                                : base
                                (string.Format
                                (&quot;Aggregate {0} was not found&quot;, id))
                            {

                            }
                        }
                        
                        public class AggregateOrEventMissingIdException : System.Exception
                        {
                            public AggregateOrEventMissingIdException(Type aggregateType, Type eventType)
                                : base(
                                    string.Format
                                    (&quot;An event of type {0} was tried to save from {1} but no id where set on either&quot;
                                    , eventType.FullName, aggregateType.FullName))
                            {
                        
                            }
                        }
                        
                        public class ConcurrencyException : System.Exception
                        {
                            public ConcurrencyException(AggregateKey id)
                                : 
                                base
                                (string.Format
                                (&quot;A different version than expected was found in aggregate {0}&quot;
                                , id))
                            {

                            }
                        }
                        
                        public class EventsOutOfOrderException : System.Exception
                        {
                            public EventsOutOfOrderException(AggregateKey id)
                                : 
                                base
                                (string.Format
                                (&quot;Eventstore gave event for aggregate {0} out of order&quot;
                                , id))
                            {

                            }
                        }
                        
                        public class MissingParameterLessConstructorException : System.Exception
                        {
                            public MissingParameterLessConstructorException(Type type)
                                : 
                                base
                                (string.Format
                                (&quot;{0} has no constructor without paramerters. This can be either public or private&quot;
                                , type.FullName))
                            {

                            }
                        }
                        
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide conicG">
        <span class="shout colors" >Piszemy więc projekty<br /> <span>implementacje
            👨‍💻
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/nuget/RabbitMQ.Client.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>

    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/infrE/01.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/Session3.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">SessionForEventSourcing</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">













































































                        public class SessionForEventSourcing : ISessionForEventSourcing
                        {
                            private readonly IEventRepository _repository;
                            private readonly Dictionary&amp;lt;AggregateKey, 
                            AggregateDescriptor&amp;gt; _trackedAggregates;
                        
                            public SessionForEventSourcing(IEventRepository repository)
                            {
                                if (repository == null)
                                    throw new ArgumentNullException(&amp;quot;repository&amp;quot;);
                        
                                _repository = repository;
                                _trackedAggregates = new Dictionary&amp;lt;AggregateKey, AggregateDescriptor&amp;gt;();
                            }
                        
                            public ExecutionStatus Add&amp;lt;T&amp;gt;(T aggregate) where T : AggregateRoot
                            {
                                try
                                {
                                    if (!IsTracked(aggregate.Key))
                                        _trackedAggregates.Add(aggregate.Key,
                                            new AggregateDescriptor
                                            {
                                                Aggregate = aggregate,
                                                Version = aggregate.Version
                                            });
                                    else if (_trackedAggregates[aggregate.Key].Aggregate != aggregate)
                                        throw new ConcurrencyException(aggregate.Key);
                                }
                                catch (Exception ex)
                                {
                                    if (ExecutionFlow.Options.ThrowExceptions)
                                    throw;
                        
                                    return ExecutionStatus.EventStoreError(ex);
                                }
                        
                                return ExecutionStatus.EventStoreOk();
                            }
                        
                            public ExecutionStatus&amp;lt;T&amp;gt; Get&amp;lt;T&amp;gt;(AggregateKey id, int? expectedVersion = null) where T : AggregateRoot
                            {
                                try
                                {
                                    //w pamięci sprawdzamy czy nie pr&amp;#243;bujemy ze złą wersją dodać zdarzenie
                                    if (IsTracked(id))
                                    {
                                        var trackedAggregate = (T)_trackedAggregates[id].Aggregate;
                                        if (expectedVersion != null &amp;amp;&amp;amp; trackedAggregate.Version != expectedVersion)
                                            throw new ConcurrencyException(trackedAggregate.Key);
                                        return ExecutionStatus&amp;lt;T&amp;gt;.EventStoreOk(trackedAggregate);
                                    }
                        
                                    //jeśli nie mamy w pamieci to odpytujemy repozytorium
                                    var aggregate = _repository.Get&amp;lt;T&amp;gt;(id);
                                    if (expectedVersion != null &amp;amp;&amp;amp; aggregate.Version != expectedVersion)
                                        throw new ConcurrencyException(id);
                                    Add(aggregate); //dodaj do tej warstwy pamięci
                        
                                    return ExecutionStatus&amp;lt;T&amp;gt;.EventStoreOk(aggregate);
                                }
                                catch (Exception ex)
                                {
                                    if (ExecutionFlow.Options.ThrowExceptions)
                                    throw;
                        
                                    return ExecutionStatus&amp;lt;T&amp;gt;.EventStoreError(ex);
                                }
                        
                        
                            }
                        
                            private bool IsTracked(AggregateKey id)
                            {
                                return _trackedAggregates.ContainsKey(id);
                            }
                        
                            public ExecutionStatus Commit()
                            {
                                try
                                {
                                    foreach (var descriptor in _trackedAggregates.Values)
                                    {
                                        _repository.Save(descriptor.Aggregate, descriptor.Version);
                                    }
                                    _trackedAggregates.Clear();
                                }
                                catch (Exception ex)
                                {
                                    if (ExecutionFlow.Options.ThrowExceptions)
                                    throw;
                        
                                    return ExecutionStatus.EventStoreError(ex);
                                }
                                return ExecutionStatus.EventStoreOk();
                            }
                        
                            private class AggregateDescriptor
                            {
                                public AggregateRoot Aggregate { get; set; }
                                public int Version { get; set; }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/Session3.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EventRepository</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
































                        public class EventRepository : IEventRepository
                        {
                            private readonly IEventStore _eventStore;
                            private readonly IEventPublisher _publisher;
                        
                            public EventRepository(IEventStore eventStore, IEventPublisher publisher)
                            {
                                if (eventStore == null)
                                    throw new ArgumentNullException(&quot;eventStore&quot;);
                                if (publisher == null)
                                    throw new ArgumentNullException(&quot;publisher&quot;);
                                _eventStore = eventStore;
                                _publisher = publisher;
                            }
                        
                            public void Save&lt;T&gt;(T aggregate, int? expectedVersion = null) where T : AggregateRoot
                            {
                                if (expectedVersion != null &amp;&amp; _eventStore.Get(
                                        aggregate.Key, expectedVersion.Value).Any())
                                    throw new ConcurrencyException(aggregate.Key);
                                var i = 0;
                                foreach (var @event in aggregate.GetUncommittedChanges())
                                {
                                    if (@event.Key == AggregateKey.Empty)
                                        @event.Key = aggregate.Key;
                                    if (@event.Key == AggregateKey.Empty)
                                        throw new AggregateOrEventMissingIdException(
                                            aggregate.GetType(), @event.GetType());
                                    i++;
                                    @event.Version = aggregate.Version + i;
                                    @event.TimeStamp = DateTimeOffset.UtcNow;
                                    _eventStore.Save(@event);
                                    _publisher.Publish(@event);
                                }
                                aggregate.MarkChangesAsCommitted();
                            }
                        
                            public T Get&lt;T&gt;(AggregateKey aggregateId) where T : AggregateRoot
                            {
                                return LoadAggregate&lt;T&gt;(aggregateId);
                            }
                        
                            private T LoadAggregate&lt;T&gt;(AggregateKey id) where T : AggregateRoot
                            {
                                var aggregate = GeekLemonConference.Application.EventSourcing.AggregateFactory.CreateAggregate&lt;T&gt;();
                        
                                //#ToFix
                                var events = _eventStore.Get(id, -1);
                                if (!events.Any())
                                    throw new AggregateNotFoundException(id);
                        
                                aggregate.LoadFromHistory(events);
                                return aggregate;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/infrE/02.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/Session4.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>


    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AppTime, aby czas można było testować</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 18px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 18px !important;">
                        public class Constants
                        {
                            public const string QUEUE_JUDGE_CREATED = &quot;judge_created&quot;;
                            public const string QUEUE_JUDGE_UPDATED = &quot;judge_updated&quot;;
                            public const string QUEUE_JUDGE_DELETED = &quot;judge_deleted&quot;;
                        
                            public const string QUEUE_CATEGORY_CREATED = &quot;category_created&quot;;
                            public const string QUEUE_CATEGORY_UPDATED = &quot;category_updated&quot;;
                        
                            public const string QUEUE_CALLFORSPEECH_SUBMITC = &quot;callforspeech_submit&quot;;
                            public const string QUEUE_CALLFORSPEECH_REJECTC = &quot;callforspeech_reject&quot;;
                            public const string QUEUE_CALLFORSPEECH_PRELIMINARY_ACCEPT = &quot;callforspeech_preminal_accept&quot;;
                            public const string QUEUE_CALLFORSPEECH_EVALUATE = &quot;callforspeech_evaluate&quot;;
                            public const string QUEUE_CALLFORSPEECH_ACCEPT = &quot;callforspeech_accept&quot;;
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AppTime, aby czas można było testować</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">














                        public static class DomainEventHelper
                        {
                            public static string WhatRabbitMQQueue(this DomainEvent @event)
                            {
                                string g = @event switch
                                {
                                    JudgeUpdatedEvent =&gt; Constants.QUEUE_JUDGE_UPDATED,
                                    JudgeCreatedEvent =&gt; Constants.QUEUE_JUDGE_CREATED,
                                    JudgeDeletedEvent =&gt; Constants.QUEUE_JUDGE_DELETED,
                                    CategoryCreateEvent =&gt; Constants.QUEUE_CATEGORY_CREATED,
                                    CategoryUpdateEvent =&gt; Constants.QUEUE_CATEGORY_UPDATED,
                                    CallForSpeechAcceptedEvent =&gt; Constants.QUEUE_CALLFORSPEECH_ACCEPT,
                                    CallForSpeechEvaulatedEvent =&gt; Constants.QUEUE_CALLFORSPEECH_EVALUATE,

                                    CallForSpeechPreliminaryAcceptEvent 
                                    =&gt; Constants.QUEUE_CALLFORSPEECH_PRELIMINARY_ACCEPT,

                                    CallForSpeechRejectedEvent =&gt; Constants.QUEUE_CALLFORSPEECH_REJECTC,
                                    CallForSpeechSubmitedEvent =&gt; Constants.QUEUE_CALLFORSPEECH_SUBMITC,
                                    _ =&gt; throw new NotImplementedException(),
                                };
                        
                                return g;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AppTime, aby czas można było testować</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">

















                        








                        public class GeekLemonEventPublisher : IEventPublisher
                        {
                            private readonly ConnectionFactory connectionFactory;
                        
                            public GeekLemonEventPublisher(IHostingEnvironment env)
                            {
                                connectionFactory = new ConnectionFactory();
                        
                                var builder = new ConfigurationBuilder()
                                .SetBasePath(env.ContentRootPath)
                                .AddJsonFile(&quot;appsettings.json&quot;, optional: false, reloadOnChange: false)
                                .AddEnvironmentVariables();
                        
                                builder.Build().GetSection(&quot;RabbitMqSetting&quot;).Bind(connectionFactory);
                            }
                        
                        
                        
                            public void Publish&lt;T&gt;(T @event) where T : DomainEvent
                            {
                                using (IConnection conn = connectionFactory.CreateConnection())
                                {
                                    using (IModel channel = conn.CreateModel())
                                    {
                                        var queue = @event.WhatRabbitMQQueue();
                        
                                        channel.QueueDeclare(
                                            queue: queue,
                                            durable: false,
                                            exclusive: false,
                                            autoDelete: false,
                                            arguments: null
                        
                                        );
                        
                                        var body = Encoding.UTF8.GetBytes(JsonConvert.SerializeObject(@event));
                        
                                        channel.BasicPublish(
                                            exchange: &quot;&quot;,
                                            routingKey: queue,
                                            basicProperties: null,
                                            body: body
                                        );
                                    }
                                }
                            }
                        
                        
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/Session5.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide conicG2">
        <span class="shout colors" >Jak wygląda zapisywanie zdarzeń do <br /> <span>bazy w pamięci RAM
            
        </span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">InMemoryEventStore</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 18px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 18px !important;">

                        public class InMemoryEventStore : IEventStore
                        {
                            private readonly Dictionary&lt;AggregateKey, List&lt;DomainEvent&gt;&gt; 
                            customerInMemDictionary = 
                            new Dictionary&lt;AggregateKey, List&lt;DomainEvent&gt;&gt;();

                            public List&lt;DomainEvent&gt; Get(AggregateKey aggregateId, int fromVersion)
                            {
                                List&lt;DomainEvent&gt; geekLemonEvents;
                                customerInMemDictionary.TryGetValue(aggregateId, out geekLemonEvents);
                                if (geekLemonEvents != null)
                                {
                                    return geekLemonEvents.Where(x =&gt; x.Version &gt; fromVersion).ToList();
                                }

                                return new List&lt;DomainEvent&gt;();
                            }

                            public void Save(DomainEvent @event)
                            {
                                List&lt;DomainEvent&gt; geekLemonEvents;
                                customerInMemDictionary.TryGetValue(@event.Key, out geekLemonEvents);
                                if (geekLemonEvents == null)
                                {
                                    geekLemonEvents = new List&lt;DomainEvent&gt;();
                                    customerInMemDictionary.Add(@event.Key, geekLemonEvents);
                                }
                                geekLemonEvents.Add(@event);
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide creamPPPGragient">
        <span class="shout colors" >Pora na instalatora EventStore
            👨‍💻
        </span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">GeekLemonConferenceInstallers</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">














                        public static partial class GeekLemonConferenceInstallers
                        {
                            public static IServiceCollection
                            AddDefaultEventStore(this IServiceCollection services)
                            {
                                services.AddScoped&lt;IEventStore, InMemoryEventStore&gt;();
                                return services;
                            }
                        
                            public static IServiceCollection AddBusAndRepository
                            (this IServiceCollection services,
                            IConfiguration configuration)
                            {
                                services.AddOptions();
                        
                                //AddOption&lt;RabbitMqConfiguration&gt;(services, configuration);
                                services.AddScoped&lt;ISessionForEventSourcing, SessionForEventSourcing&gt;();
                                services.AddSingleton&lt;IEventPublisher, GeekLemonEventPublisher&gt;();
                                services.AddScoped&lt;IEventRepository, EventRepository&gt;();
                        
                                //services.AddScoped&lt;IEventRepository, CacheRepository&gt;((services) =&gt;
                                //{
                                //    var iEventStore = services.GetRequiredService&lt;IEventStore&gt;();
                                //    var iEventPublisher = services.GetRequiredService&lt;IEventPublisher&gt;();
                                //    var eventRepository = new EventRepository(iEventStore, iEventPublisher);
                        
                                //    return new CacheRepository(eventRepository, iEventStore);
                                //});
                        
                                return services;
                            }
                        
                            private static void AddOption&lt;T&gt;(IServiceCollection services, IConfiguration configuration) where T : class
                            {
                                services.Configure&lt;T&gt;(configuration.GetSection(typeof(T).Name));
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">CacheRepository</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">








































































                        public class CacheRepository : IEventRepository
                        {
                            private readonly IEventRepository _repository;
                            private readonly IEventStore _eventStore;
                            private readonly MemoryCache _cache;
                            private readonly Func&lt;CacheItemPolicy&gt; _policyFactory;
                        
                            private static readonly ConcurrentDictionary&lt;string, object&gt; _locks =
                                new ConcurrentDictionary&lt;string, object&gt;();
                        
                            public CacheRepository(IEventRepository repository, IEventStore eventStore)
                            {
                                if (repository == null)
                                    throw new ArgumentNullException(&quot;repository&quot;);
                                if (eventStore == null)
                                    throw new ArgumentNullException(&quot;eventStore&quot;);
                        
                                _repository = repository;
                                _eventStore = eventStore;
                                _cache = MemoryCache.Default;
                                _policyFactory = () =&gt; new CacheItemPolicy
                                {
                                    SlidingExpiration = new TimeSpan(0, 0, 15, 0),
                                    RemovedCallback = x =&gt;
                                    {
                                        object o;
                                        _locks.TryRemove(x.CacheItem.Key, out o);
                                    }
                                };
                            }
                        
                            public void Save&lt;T&gt;(T aggregate, int? expectedVersion = null)
                                where T : AggregateRoot
                            {
                                var idstring = aggregate.Key.ToString();
                                try
                                {
                                    lock (_locks.GetOrAdd(idstring, _ =&gt; new object()))
                                    {
                                        if (aggregate.Key != AggregateKey.Empty &amp;&amp; !IsTracked(aggregate.Key))
                                            _cache.Add(idstring, aggregate, _policyFactory.Invoke());
                                        _repository.Save(aggregate, expectedVersion);
                                    }
                                }
                                catch (Exception)
                                {
                                    _cache.Remove(idstring);
                                    throw;
                                }
                            }
                        
                            public T Get&lt;T&gt;(AggregateKey aggregateId) where T : AggregateRoot
                            {
                                var idstring = aggregateId.ToString();
                                try
                                {
                                    lock (_locks.GetOrAdd(idstring, _ =&gt; new object()))
                                    {
                                        T aggregate;
                                        if (IsTracked(aggregateId))
                                        {
                                            aggregate = (T)_cache.Get(idstring);
                                            var events = _eventStore.Get(aggregateId, aggregate.Version);
                                            if (events.Any() &amp;&amp; events.First().Version != aggregate.Version + 1)
                                            {
                                                _cache.Remove(idstring);
                                            }
                                            else
                                            {
                                                aggregate.LoadFromHistory(events);
                                                return aggregate;
                                            }
                                        }
                                        //jeśli nie ma go w Cache to poszukać w repozytorium prawdziwym
                                        aggregate = _repository.Get&lt;T&gt;(aggregateId);
                                        _cache.Add(
                                            aggregateId.ToString(),
                                            aggregate,
                                            _policyFactory.Invoke());
                                        return aggregate;
                                    }
                                }
                                catch (Exception)
                                {
                                    _cache.Remove(idstring);
                                    throw;
                                }
                            }
                        
                            private bool IsTracked(AggregateKey id)
                            {
                                return _cache.Contains(id.ToString());
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide conicG">
        <span class="shout colors" >Piszemy więc projekty<br /> 
            <span>EventStorePlugin.MongoDb
            👨‍💻
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/03.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/02.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/Instalacje/10.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/Instalacje/11.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/Instalacje/12.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AppTime, aby czas można było testować</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        public class EventData
                        {
                            public const string IdFieldName = "_id";
                            public const string StreamIdFieldName = "_streamId";
                            public const string VersionFieldName = "_version";
                    
                            [BsonElement(IdFieldName)]
                            [BsonId(IdGenerator = typeof(GuidGenerator))]
                            public Guid Id { get; set; }
                    
                            [BsonElement(StreamIdFieldName)]
                            public string StreamId { get; set; }
                    
                            [BsonElement(VersionFieldName)]
                            public int Version { get; set; }
                    
                            [BsonElement("_payload")]
                            public DomainEvent PayLoad { get; set; }
                    
                            [BsonElement("_timestamp")]
                            public DateTimeOffset TimeStamp { get; set; }
                    
                            [BsonElement("_clrTypeFullname")]
                            public string AssemblyQualifiedName { get; set; }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide creamPP fullscreen " >
        <div class="grid-container-slidepoint">
            <div class="SlidePointImage">
                <img  src="pictures/iconsFr2/binary-code.png" />
            </div>
            <div class="SlidePointText">
                <ol class="nonumbers">
                    <li class="next bold">BSON</li>
                    <ol class="nonumbers">
                        <li class="next">Innaczej Binnarny JSON</li>
                        <li class="next">BSON ma swoje został stworzony w 2009 roku dla MongoDB</li>
                    </ol>
                </ol>
            </div>
          </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">IMongoDbContext</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        public interface IMongoDbContext
                        {
                            IMongoDatabase Database { get; }
                    
                            IClientSessionHandle Session { get; }
                    
                            IClientSessionHandle StartSession
                                ();
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">MongoDbContext</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
























                        


















                        public class MongoDbContext : IMongoDbContext
                        {
                            public IMongoDatabase Database { get; }
                        
                            public IClientSessionHandle Session { get; private set; }
                        
                            private MongoClient _client;
                        
                            public MongoDbContext()
                            {
                        
                                string connectionString = &quot;mongodb://localhost:27017/dbtest?readPreference=primary&quot;;
                                var mongoUrl = new MongoUrl(connectionString);
                                _client = new MongoClient(mongoUrl);
                                Database = _client.GetDatabase(&quot;GeekLemon&quot;);
                                ClassMapping();
                            }
                        
                            private static void ClassMapping()
                            {
                                if (!BsonClassMap.IsClassMapRegistered
                                (typeof(CategoryUpdateEvent))) 
                                { BsonClassMap.RegisterClassMap&lt;CategoryUpdateEvent&gt;(); }

                                if (!BsonClassMap.IsClassMapRegistered
                                (typeof(CategoryCreateEvent))) 
                                { BsonClassMap.RegisterClassMap&lt;CategoryCreateEvent&gt;(); }

                                if (!BsonClassMap.IsClassMapRegistered
                                (typeof(JudgeCreatedEvent))) 
                                { BsonClassMap.RegisterClassMap&lt;JudgeCreatedEvent&gt;(); }

                                if (!BsonClassMap.IsClassMapRegistered
                                (typeof(JudgeUpdatedEvent))) 
                                { BsonClassMap.RegisterClassMap&lt;JudgeUpdatedEvent&gt;(); }

                                if (!BsonClassMap.IsClassMapRegistered
                                (typeof(JudgeDeletedEvent))) 
                                { BsonClassMap.RegisterClassMap&lt;JudgeDeletedEvent&gt;(); }

                                if (!BsonClassMap.IsClassMapRegistered
                                (typeof(CallForSpeechAcceptedEvent))) 
                                { BsonClassMap.RegisterClassMap&lt;CallForSpeechAcceptedEvent&gt;(); }

                                if (!BsonClassMap.IsClassMapRegistered
                                (typeof(CallForSpeechPreliminaryAcceptEvent))) 
                                { BsonClassMap.RegisterClassMap&lt;CallForSpeechPreliminaryAcceptEvent&gt;(); }

                                if (!BsonClassMap.IsClassMapRegistered
                                (typeof(CallForSpeechRejectedEvent))) 
                                { BsonClassMap.RegisterClassMap&lt;CallForSpeechRejectedEvent&gt;(); }

                                if (!BsonClassMap.IsClassMapRegistered
                                (typeof(CallForSpeechEvaulatedEvent))) 
                                { BsonClassMap.RegisterClassMap&lt;CallForSpeechEvaulatedEvent&gt;(); }

                                if (!BsonClassMap.IsClassMapRegistered
                                (typeof(CallForSpeechSubmitedEvent))) 
                                { BsonClassMap.RegisterClassMap&lt;CallForSpeechSubmitedEvent&gt;(); }

                            }
                        
                            public IClientSessionHandle StartSession()
                            {
                                var session = _client.StartSession();
                                Session = session;
                                return session;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">MongoDbEventStore</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">





                        





                        





                        





                        





                        





                        public class MongoDbEventStore : IEventStore
                        {
                            private IMongoCollection&lt;EventData&gt; _events;
                        
                            private const string EventsCollection = &quot;eventstore&quot;;
                        
                            private readonly IMongoDbContext _mongoDbContext;
                        
                            public MongoDbEventStore(IEventPublisher publisher, IMongoDbContext mongoDbContext)
                            {
                                _mongoDbContext = mongoDbContext;
                                _events = _mongoDbContext.Database.GetCollection&lt;EventData&gt;(EventsCollection);
                            }
                        
                            public List&lt;DomainEvent&gt; Get
                            (Application.EventSourcing.AggregateKey aggregateId, int fromVersion)
                            {
                                try
                                {
                                    var filterBuilder = Builders&lt;EventData&gt;.Filter;
                                    var filter = filterBuilder.Eq(EventData.StreamIdFieldName, aggregateId) &amp;
                                                filterBuilder.Gte(EventData.VersionFieldName, fromVersion);
                        
                                    var result = _events.Find(filter);
                                    var r = result.ToList().Select(x =&gt; x.PayLoad).ToList();
                                    return r;
                                }
                                catch (Exception)
                                {
                                    throw;
                                }
                            }
                        
                            public void Save(DomainEvent @event)
                            {
                                using var session = _mongoDbContext.StartSession();
                        
                                try
                                {
                                    //You can do atomic mass add
                                    //but i have community version
                                    var eventData = new EventData
                                    {
                                        Id = Guid.NewGuid(),
                                        StreamId = @event.Key.Id,
                                        TimeStamp = @event.TimeStamp,
                                        AssemblyQualifiedName = @event.GetType().AssemblyQualifiedName,
                                        PayLoad = @event,
                                        Version = @event.Version
                                    };
                        
                                    _events.InsertOne(eventData);
                                }
                                catch (Exception exp)
                                {
                                    //session.AbortTransaction();
                                    throw;
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/monogoDB.gif" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">GeekLemonConferenceInstallers</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        public static partial class GeekLemonConferenceInstallers
                        {
                            public static IServiceCollection
                                AddEventStoreMongoDb
                                (this IServiceCollection services,
                                IConfiguration configuration)
                            {
                        
                                services.AddScoped&lt;IMongoDbContext, MongoDbContext&gt;();
                        
                                services.AddScoped&lt;IEventStore, MongoDbEventStore&gt;();
                        
                                return services;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide conicG">
        <span class="shout colors" >Piszemy więc projekty<br /> <span>EventStorePlugin.SQLite
            👨‍💻
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/Q-01.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/Q-02.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EvetStore w SQllite</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        BEGIN TRANSACTION;
                        CREATE TABLE IF NOT EXISTS &quot;EventStore&quot; (
                            &quot;Id&quot;    INTEGER NOT NULL UNIQUE,
                            &quot;Key&quot;    TEXT NOT NULL,
                            &quot;AssemblyQualifiedName&quot;    TEXT NOT NULL,
                            &quot;Value&quot;    TEXT NOT NULL,
                            &quot;Version&quot;    INTEGER,
                            PRIMARY KEY(&quot;Id&quot; AUTOINCREMENT)
                        );
                        COMMIT;
                        
                    </code>
                </pre>
            </div>
        </div>
    </section>   
     <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EventStoreSQLiteContext w SQllite</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 20px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 20px !important;">
                        public interface IEventStoreSQLiteContext
                        {
                            string ConnectionString { get; }
                        }
                        
                        public class EventStoreSQLiteContext : IEventStoreSQLiteContext
                        {
                            public EventStoreSQLiteContext(string connectionString)
                            {
                                _connectionString = connectionString;
                            }

                            private string _connectionString;

                            public string ConnectionString
                            {
                                get
                                {
                                    return _connectionString;
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AppTime, aby czas można było testować</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
































                        




















                        public class SqlLiteEventStore : IEventStore
                        {
                            private IEventStoreSQLiteContext _geekLemonContext;
                        
                            public SqlLiteEventStore(IEventStoreSQLiteContext context)
                            {
                                _geekLemonContext = context;
                            }
                        
                            public List&lt;DomainEvent&gt; Get(AggregateKey aggregateId, int fromVersion)
                            {
                                using var connection = new SqliteConnection
                                    (_geekLemonContext.ConnectionString);
                        
                                try
                                {
                                    var r = connection.Query&lt;EventTemp&gt;
                                    (@&quot;SELECT Id,Key, Value, AssemblyQualifiedName, Version FROM EventSTORE
                                        WHERE Key = @aggregateId and Version &gt; @Version;&quot;, new
                                    {
                                        @aggregateId = aggregateId.Id,
                                        @Version = fromVersion
                                    });
                        
                                    List&lt;DomainEvent&gt; de = new List&lt;DomainEvent&gt;();
                        
                                    foreach (var item in r)
                                    {
                                        Assembly asm = typeof(DomainEvent).Assembly;
                                        Type type = TypeRecon.ReconstructType(item.AssemblyQualifiedName, true, asm);
                        
                                        var domain = JsonConvert.
                                            DeserializeObject(item.Value, type);
                        
                                        de.Add(domain as DomainEvent);
                                    }
                        
                                    return de;
                                }
                                catch (Exception ex)
                                {
                                    throw;
                                }
                            }
                        
                            public void Save(DomainEvent @event)
                            {
                                using var connection = new SqliteConnection
                                    (_geekLemonContext.ConnectionString);
                        
                        
                                try
                                {
                                    var q = @&quot;INSERT INTO EventSTORE(Key, Value,
                                        AssemblyQualifiedName
                                        ,Version)
                                        VALUES (@Key, @Value, @AssemblyQualifiedName,@Version);&quot;;
                        
                        
                                    var result = connection.Execute(q, new
                                    {
                                        @Key = @event.Key.Id,
                                        @Value = JsonConvert.SerializeObject(@event),
                                        @AssemblyQualifiedName = @event.GetType().AssemblyQualifiedName,
                                        @Version = @event.Version,
                                    }
                                    );
                        
                                }
                                catch (Exception ex)
                                {
                                    throw;
                                }
                            }
                        
                        
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EventTemp</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        public class EventTemp
                        {
                            public string Key { get; set; }
                            public string Value { get; set; }
                            public string AssemblyQualifiedName { get; set; }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">Pomocnicza klas do odzyskiwania typów ze string</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 15px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 15px !important;">





















































            














            

                        public static class TypeRecon
                        {
                            public static Type ReconstructType(string assemblyQualifiedName, 
                            bool throwOnError = true, params Assembly[] referencedAssemblies)
                            {
                                foreach (Assembly asm in referencedAssemblies)
                                {
                                    var fullNameWithoutAssemblyName = assemblyQualifiedName.Replace($&quot;, {asm.FullName}&quot;, &quot;&quot;);
                                    var type = asm.GetType(fullNameWithoutAssemblyName, throwOnError: false);
                                    if (type != null) return type;
                                }
                        
                                if (assemblyQualifiedName.Contains(&quot;[[&quot;))
                                {
                                    Type type = ConstructGenericType(assemblyQualifiedName, throwOnError);
                                    if (type != null)
                                        return type;
                                }
                                else
                                {
                                    Type type = Type.GetType(assemblyQualifiedName, false);
                                    if (type != null)
                                        return type;
                                }
                        
                                if (throwOnError)
                                    throw new Exception
                                    ($&quot;The type \&quot;{assemblyQualifiedName}\&quot; cannot be found in referenced assemblies.&quot;);
                                else
                                    return null;
                            }
                        
                            private static Type ConstructGenericType(string assemblyQualifiedName, bool throwOnError = true)
                            {
                                Regex regex = new Regex
                                (@&quot;^(?&lt;name&gt;\w+(\.\w+)*)`(?&lt;count&gt;\d)\[(?&lt;subtypes&gt;\[.*\])\](, (?&lt;assembly&gt;\w+(\.\w+)*)[\w\s,=\.]+)$?&quot;,
                                 RegexOptions.Singleline | RegexOptions.ExplicitCapture);

                                Match match = regex.Match(assemblyQualifiedName);
                                if (!match.Success)
                                    if (!throwOnError) return null;
                                    else throw new Exception($&quot;Unable to parse the type&#39;s assembly qualified name: {assemblyQualifiedName}&quot;);
                        
                                string typeName = match.Groups[&quot;name&quot;].Value;
                                int n = int.Parse(match.Groups[&quot;count&quot;].Value);
                                string asmName = match.Groups[&quot;assembly&quot;].Value;
                                string subtypes = match.Groups[&quot;subtypes&quot;].Value;
                        
                                typeName = typeName + $&quot;`{n}&quot;;
                                Type genericType = ReconstructType(typeName, throwOnError);
                                if (genericType == null) return null;
                        
                                List&lt;string&gt; typeNames = new List&lt;string&gt;();
                                int ofs = 0;
                                while (ofs &lt; subtypes.Length &amp;&amp; subtypes[ofs] == &#39;[&#39;)
                                {
                                    int end = ofs, level = 0;
                                    do
                                    {
                                        switch (subtypes[end++])
                                        {
                                            case &#39;[&#39;: level++; break;
                                            case &#39;]&#39;: level--; break;
                                        }
                                    } while (level &gt; 0 &amp;&amp; end &lt; subtypes.Length);
                        
                                    if (level == 0)
                                    {
                                        typeNames.Add(subtypes.Substring(ofs + 1, end - ofs - 2));
                                        if (end &lt; subtypes.Length &amp;&amp; subtypes[end] == &#39;,&#39;)
                                            end++;
                                    }
                        
                                    ofs = end;
                                    n--;  // just for checking the count
                                }
                        
                                if (n != 0)
                                    // This shouldn&#39;t ever happen!
                                    throw new Exception(&quot;Generic type argument count mismatch! Type name: &quot; + assemblyQualifiedName);
                        
                                Type[] types = new Type[typeNames.Count];
                                for (int i = 0; i &lt; types.Length; i++)
                                {
                                    try
                                    {
                                        types[i] = ReconstructType(typeNames[i], throwOnError);
                                        if (types[i] == null)  // if throwOnError, should not reach this point if couldn&#39;t create the type
                                            return null;
                                    }
                                    catch (Exception ex)
                                    {
                                        throw new Exception($&quot;Unable to reconstruct generic type. Failed on creating the type argument {(i + 1)}: {typeNames[i]}. Error message: {ex.Message}&quot;);
                                    }
                                }
                        
                                Type resultType = genericType.MakeGenericType(types);
                                return resultType;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide conicG2">
        <span class="shout colors" >Instalator do EventStore SQLite
            👨‍💻
        </span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">GeekLemonConferenceInstallers</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        public static partial class GeekLemonConferenceInstallers
                        {
                            public static IServiceCollection
                                AddEventStoreSqlLite
                                (this IServiceCollection services,
                                IConfiguration configuration)
                            {
                                var connection = configuration.
                                    GetConnectionString(&quot;EventStoreSQLiteConnectionString&quot;);
                        
                                services.AddScoped&lt;IEventStoreSQLiteContext, EventStoreSQLiteContext&gt;
                                    (
                                        (services) =&gt;
                                        {
                                            var c =
                                            new EventStoreSQLiteContext(connection);
                                            return c;
                                        }
                                    );
                        
                                services.AddScoped&lt;IEventStore, SqlLiteEventStore&gt;();
                        
                                return services;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>

    <section class="slide conicG">
        <span class="shout colors" >Wracamy do projektu API<br /> <span>
            👨‍💻
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/04.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">Startup</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">






                        public class Startup
                        {
                            public IConfiguration Configuration { get; }
                            
                            public Startup(IConfiguration configuration)
                            {
                                Configuration = configuration;
                            }
                            
                            public void ConfigureServices(IServiceCollection services)
                            {
                                services.AddSwaggerGen(c => .........
                            
                                services.AddGeekLemonConferenceCQRS(Configuration);
                                services.AddGeekLemonPersistenceDapperSQLiteServices(Configuration);
                                //services.AddDefaultEventStore();
                                //services.AddEventStoreSqlLite(Configuration);
                                services.AddEventStoreMongoDb(Configuration);
                                services.AddBusAndRepository(Configuration);
                            
                                services.AddControllers();
                                services.AddCors(options =>
                                {
                                    options.AddPolicy("Open",
                                        builder => builder.AllowAnyOrigin().AllowAnyHeader().AllowAnyMethod());
                                });
                            }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">Startup</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">





                        public class Startup
                        {
                            public IConfiguration Configuration { get; }
                            
                            public Startup(IConfiguration configuration)
                            {
                                Configuration = configuration;
                            }
                            
                            public void ConfigureServices(IServiceCollection services)
                            {
                                services.AddSwaggerGen(c => .........
                            
                                services.AddGeekLemonConferenceCQRS(Configuration);
                                services.AddGeekLemonPersistenceDapperSQLiteServices(Configuration);
                                //services.AddDefaultEventStore();
                                services.AddEventStoreSqlLite(Configuration);
                                //services.AddEventStoreMongoDb(Configuration);
                                services.AddBusAndRepository(Configuration);
                            
                                services.AddControllers();
                                services.AddCors(options =>
                                {
                                    options.AddPolicy("Open",
                                        builder => builder.AllowAnyOrigin().AllowAnyHeader().AllowAnyMethod());
                                });
                            }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide creamPPPGragient">
        <span class="shout colors" >Wracamy do projektu CQRS<br /> <span>e
            👨‍💻
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/05.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/06.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/ADOBE/workflow.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">ESCreateCategoryCommand</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        public class ESCreateCategoryCommand : 
                        IRequest&lt;ESCreateCategoryCommandResponse&gt;
                        {
                        
                            public string Name { get; set; }
                        
                        
                            public string DisplayName { get; set; }
                        
                        
                            public string WhatWeAreLookingFor { get; set; }
                        
                            internal int Version { get; private set; }
                        
                            internal CategoryUniqueId UniqueId { get; private set; }
                        
                            public ESCreateCategoryCommand()
                            {
                                UniqueId = CategoryUniqueId.NewUniqueId();
                                Version = 0;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">ESCreateCategoryCommandHandler</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">












                        public class ESCreateCategoryCommandHandler
                        : IRequestHandler&lt;ESCreateCategoryCommand, ESCreateCategoryCommandResponse&gt;
                        {
                            private readonly ISessionForEventSourcing _sessionForEventSourcing;
                            private readonly IMapper _mapper;
                        
                            public ESCreateCategoryCommandHandler(
                                ISessionForEventSourcing sessionForEventSourcing, IMapper mapper)
                            {
                                _mapper = mapper;
                                _sessionForEventSourcing = sessionForEventSourcing;
                            }
                        
                            public async Task&lt;ESCreateCategoryCommandResponse&gt; Handle
                                (ESCreateCategoryCommand request, CancellationToken cancellationToken)
                            {
                                var validator = new ESCreateCategoryCommandValidator();
                                var validatorResult = await validator.ValidateAsync(request);
                        
                                if (!validatorResult.IsValid)
                                    return new ESCreateCategoryCommandResponse(validatorResult);
                        
                                var category = _mapper.Map&lt;Category&gt;(request);
                        
                                var item = new CategoryAggregate(category);
                        
                                _sessionForEventSourcing.Add&lt;CategoryAggregate&gt;(item);
                                _sessionForEventSourcing.Commit();
                        
                                var ids = _mapper.Map&lt;IdsDto&gt;(category.Ids());
                                return new ESCreateCategoryCommandResponse(ids);
                            }
                        
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">ESCreateCategoryCommandResponse</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 16px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 16px !important;">








                        public class ESCreateCategoryCommandResponse : BaseResponse
                        {
                            public IdsDto CategoryIds { get; set; }
                        
                            public ESCreateCategoryCommandResponse(IdsDto Ids)
                                 : base()
                            {
                                CategoryIds = Ids;
                            }
                        
                            public ESCreateCategoryCommandResponse() : base()
                            { }
                        
                            public ESCreateCategoryCommandResponse(ExecutionStatus status)
                                : base(status)
                            {
                        
                            }
                        
                            public ESCreateCategoryCommandResponse(ExecutionStatus status, string message)
                                : base(status, message)
                            {
                        
                            }
                        
                        
                            public ESCreateCategoryCommandResponse(ValidationResult validationResult)
                                : base(validationResult)
                            { }
                        
                            public ESCreateCategoryCommandResponse(string message)
                            : base(message)
                            { }
                        
                            public ESCreateCategoryCommandResponse(string message, bool success)
                                : base(message, success)
                            { }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/create-category.gif" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/ADOBE/workflow-02.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/ADOBE/workflow-03.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EsUpdateCategoryCommand</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        public class EsUpdateCategoryCommand
                        : IRequest&lt;EsUpdateCategoryCommandResponse&gt;
                        {
                            public Guid UniqueId { get; set; }
                        
                            public string Name { get; set; }
                        
                            public string DisplayName { get; set; }
                        
                            public string WhatWeAreLookingFor { get; set; }
                        
                            public int Version { get; set; }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EsUpdateCategoryCommandHandler</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">



























                        public class EsUpdateCategoryCommandHandler : IRequestHandler
                        &lt;EsUpdateCategoryCommand, EsUpdateCategoryCommandResponse&gt;                
                        {
                            private readonly ISessionForEventSourcing _sessionForEventSourcing;
                            private readonly IMapper _mapper;
                        
                            public EsUpdateCategoryCommandHandler(
                                ISessionForEventSourcing sessionForEventSourcing, IMapper mapper)
                            {
                                _mapper = mapper;
                                _sessionForEventSourcing = sessionForEventSourcing;
                            }
                        
                        
                            public async Task&lt;EsUpdateCategoryCommandResponse&gt; Handle
                                (EsUpdateCategoryCommand request, CancellationToken cancellationToken)
                            {
                                var validator = new EsUpdateCategoryCommandValidator();
                                var validatorResult = await validator.ValidateAsync(request);
                        
                                if (!validatorResult.IsValid)
                                    return new EsUpdateCategoryCommandResponse(validatorResult);
                        
                                var category = _mapper.Map&lt;Category&gt;(request);
                        
                                var eventstoreResult = Get&lt;CategoryAggregate&gt;
                                    (category.UniqueId.GetAggregateKey());
                        
                                if (!eventstoreResult.Success)
                                    return new EsUpdateCategoryCommandResponse
                                        (eventstoreResult.RemoveGeneric());
                        
                                if ((eventstoreResult.Value.Version - 1) &gt; category.Version )
                                    return new EsUpdateCategoryCommandResponse
                                        (ExecutionStatus.EventStoreConcurrencyError
                                        (@$&quot;You sended old version.
                                        Yours {category.Version}. Should be :{eventstoreResult.Value.Version - 1}&quot;));
                        
                                eventstoreResult.Value.Update(category);
                        
                                var status = _sessionForEventSourcing.Commit();
                        
                                return new EsUpdateCategoryCommandResponse(status);
                            }
                        
                            private ExecutionStatus&lt;T&gt; Get&lt;T&gt;
                            (AggregateKey id, int? expectedVersion = null) where T : AggregateRoot
                            {
                                var a = _sessionForEventSourcing.Get&lt;T&gt;(id, expectedVersion);
                                return a;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <!-- <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EsUpdateCategoryCommandResponse</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">






                        public async Task&lt;EsUpdateCategoryCommandResponse&gt; Handle
                            (EsUpdateCategoryCommand request, CancellationToken cancellationToken)
                        {
                            var validator = new EsUpdateCategoryCommandValidator();
                            var validatorResult = await validator.ValidateAsync(request);
                    
                            if (!validatorResult.IsValid)
                                return new EsUpdateCategoryCommandResponse(validatorResult);
                    
                            var category = _mapper.Map&lt;Category&gt;(request);
                    
                            var eventstoreResult = Get&lt;CategoryAggregate&gt;
                                (category.UniqueId.GetAggregateKey());
                    
                            if (!eventstoreResult.Success)
                                return new EsUpdateCategoryCommandResponse
                                    (eventstoreResult.RemoveGeneric());
                    
                            if (eventstoreResult.Value.Version &gt; category.Version)
                                return new EsUpdateCategoryCommandResponse
                                    (ExecutionStatus.EventStoreConcurrencyError
                                    (@$&quot;You sended old version.
                                    Yours {category.Version}. Should be :{eventstoreResult.Value.Version}&quot;));
                    
                            eventstoreResult.Value.Update(category);
                    
                            var status = _sessionForEventSourcing.Commit();
                    
                            return new EsUpdateCategoryCommandResponse(status);
                        }
                    
                        private ExecutionStatus&lt;T&gt; Get&lt;T&gt;(AggregateKey id, int? expectedVersion = null) where T : AggregateRoot
                        {
                            var a = _sessionForEventSourcing.Get&lt;T&gt;(id, expectedVersion);
                            return a;
                        }
                        
                    </code>
                </pre>
            </div>
        </div>
    </section> -->
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/update kategory.gif" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamPP">
        <span class="shout colors" ><span>Zobaczmy co trafiło do bazy EventStore
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/json-create-category-01.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/json-create-category-02.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/json-create-category-04.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/json-create-category-05.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/kolejka-0.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/kolejka-01.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/kolejka-02.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamGG">
        <span class="shout colors" ><span>Przykład z sędziami
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/07.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EsCreateJudgeCommand</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        public class EsCreateJudgeCommand : IRequest&lt;EsCreateJudgeCommandResponse&gt;
                        {
                            public string Login { get; set; }
                            public string Password { get; set; }
                            public NameDto Name { get; set; }
                            public DateTime Birthdate { get; set; }
                        
                            public int CategoryId { get; set; }
                            public CategoryDto Category
                            {
                                get
                                {
                                    return new CategoryDto() { Id = CategoryId };
                                }
                            }
                            internal JudgeUniqueId UniqueId { get; }
                        
                            public EsCreateJudgeCommand()
                            {
                                UniqueId = JudgeUniqueId.New();
                                Version = 0;
                            }
                        
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EsCreateJudgeCommandHandler</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">









                        public class EsCreateJudgeCommandHandler
                        : IRequestHandler&lt;EsCreateJudgeCommand, EsCreateJudgeCommandResponse&gt;
                        {
                            private readonly ISessionForEventSourcing _sessionForEventSourcing;
                            private readonly IMapper _mapper;
                        
                            public EsCreateJudgeCommandHandler(
                                ISessionForEventSourcing sessionForEventSourcing, IMapper mapper)
                            {
                                _mapper = mapper;
                                _sessionForEventSourcing = sessionForEventSourcing;
                            }
                        
                            public async Task&lt;EsCreateJudgeCommandResponse&gt; Handle
                                (EsCreateJudgeCommand request, CancellationToken cancellationToken)
                            {
                                var validator = new EsCreateJudgeCommandValidator();
                                var validatorResult = await validator.ValidateAsync(request);
                        
                                if (!validatorResult.IsValid)
                                    return new EsCreateJudgeCommandResponse(validatorResult);
                        
                                var judge = _mapper.Map&lt;Judge&gt;(request);
                        
                                var item = new JudgeAggregate(judge);
                        
                                _sessionForEventSourcing.Add&lt;JudgeAggregate&gt;(item);
                                _sessionForEventSourcing.Commit();
                        
                                var ids = _mapper.Map&lt;IdsDto&gt;(judge.Ids());
                                return new EsCreateJudgeCommandResponse(ids);
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/create-judge.gif" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EsUpdateJudgeCommand</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        public class EsUpdateJudgeCommand 
                        : IRequest&lt;EsUpdateJudgeCommandResponse&gt;
                        {
                            public Guid UniqueId { get; set; }
                        
                            public string Login { get; set; }
                            public string Password { get; set; }
                            public NameDto Name { get; set; }
                            public int CategoryId { get; set; }
                        
                            public int Version { get; set; }
                        
                            public CategoryDto Category
                            {
                                get
                                {
                                    return new CategoryDto() { Id = CategoryId };
                                }
                            }
                        
                            public DateTime Birthdate { get; set; }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EsUpdateJudgeCommandHandler</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">

























                        public class EsUpdateJudgeCommandHandler :
                        IRequestHandler&lt;EsUpdateJudgeCommand, EsUpdateJudgeCommandResponse&gt;
                        {
                            private readonly ISessionForEventSourcing _sessionForEventSourcing;
                            private readonly IMapper _mapper;
                        
                            public EsUpdateJudgeCommandHandler(
                                ISessionForEventSourcing sessionForEventSourcing, IMapper mapper)
                            {
                                _mapper = mapper;
                                _sessionForEventSourcing = sessionForEventSourcing;
                            }
                        
                            public async Task&lt;EsUpdateJudgeCommandResponse&gt; Handle
                            (EsUpdateJudgeCommand request, CancellationToken cancellationToken)
                            {
                                var validator = new EsUpdateJudgeCommandValidator();
                                var validatorResult = await validator.ValidateAsync(request);
                        
                                if (!validatorResult.IsValid)
                                    return new EsUpdateJudgeCommandResponse(validatorResult);
                        
                                var judgedto = _mapper.Map&lt;JudgeDto&gt;(request);
                                var judge = _mapper.Map&lt;Judge&gt;(judgedto);
                        
                                var eventstoreResult = Get&lt;JudgeAggregate&gt;(judge.UniqueId.GetAggregateKey());
                        
                                if (!eventstoreResult.Success)
                                    return await Task.FromResult(new
                                        EsUpdateJudgeCommandResponse(eventstoreResult.RemoveGeneric()));
                        
                                if ((eventstoreResult.Value.Version - 1) &gt; judge.Version)
                                    return new EsUpdateJudgeCommandResponse
                                        (ExecutionStatus.EventStoreConcurrencyError
                                        (@$&quot;You sended old version. Your version {judge.Version}. 
                                        Should be :{eventstoreResult.Value.Version - 1}&quot;));
                        
                                eventstoreResult.Value.Update(judge);
                                _sessionForEventSourcing.Commit();
                        
                                return new EsUpdateJudgeCommandResponse();
                            }
                        
                        
                        
                            private ExecutionStatus&lt;T&gt; Get&lt;T&gt;
                            (AggregateKey id, int? expectedVersion = null) where T : AggregateRoot
                            {
                                return _sessionForEventSourcing.Get&lt;T&gt;(id, expectedVersion);
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/update judge.gif" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/kolejka-04.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/kolejka-03.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>

    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/08.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>

 
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EsSubmitCallForSpeechCommand</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 17px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 17px !important;">









                        public class EsSubmitCallForSpeechCommand 
                            : IRequest&lt;EsSubmitCallForSpeechCommandResponse&gt;
                        {
                            public int CategoryId { get; set; }
                        
                            public CategoryDto Category
                            {
                                get
                                {
                                    return new CategoryDto() { Id = CategoryId };
                                }
                            }
                        
                            public int Version { get; }
                        
                            public CallForSpeechUniqueId UniqueId { get; }
                        
                            public EsSubmitCallForSpeechCommand()
                            {
                                UniqueId = CallForSpeechUniqueId.NewUniqueId();
                                Version = 0;
                            }
                        
                            public SpeakerDto Speaker { get; set; }
                        
                            public SpeechDto Speech { get; set; }
                            public string Number { get; set; }
                            public RegistrationDto Registration
                            {
                                get
                                {
                                    return new RegistrationDto()
                                    {
                                        RegistrationDate = AppTime.Now()
                                    };
                                }
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EsSubmitCallForSpeechCommandHandler</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">











                        public class EsSubmitCallForSpeechCommandHandler
                        : IRequestHandler&lt;EsSubmitCallForSpeechCommand, EsSubmitCallForSpeechCommandResponse&gt;
                        {
                            private readonly ISessionForEventSourcing _sessionForEventSourcing;
                            private readonly IMapper _mapper;
                        
                        
                            public EsSubmitCallForSpeechCommandHandler(
                                ISessionForEventSourcing sessionForEventSourcing, IMapper mapper)
                            {
                                _mapper = mapper;
                                _sessionForEventSourcing = sessionForEventSourcing;
                            }
                        
                        
                            public async Task&lt;EsSubmitCallForSpeechCommandResponse&gt; Handle
                                (EsSubmitCallForSpeechCommand request, CancellationToken cancellationToken)
                            {
                                var validator = new EsSubmitCallForSpeechCommandValidation();
                                var validatorResult = await validator.ValidateAsync(request);
                        
                                if (!validatorResult.IsValid)
                                    return new EsSubmitCallForSpeechCommandResponse(validatorResult);
                        
                                var csf = _mapper.Map&lt;CallForSpeech&gt;(request);
                        
                                var item = new CallForSpeechAggregate(csf);
                        
                                _sessionForEventSourcing.Add&lt;CallForSpeechAggregate&gt;(item);
                                _sessionForEventSourcing.Commit();
                        
                                var ids = _mapper.Map&lt;IdsDto&gt;(csf.Ids());
                                return new EsSubmitCallForSpeechCommandResponse(ids);
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/submit call for speech.gif" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AppTime, aby czas można było testować</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        public class EsEvaluateCallForSpeechCommand
                        : IRequest&lt;EsEvaluateCallForSpeechCommandResponse&gt;
                        {
                            public Guid CallForSpeechIdUnique { get; set; }
                            public int Version { get; set; }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EsEvaluateCallForSpeechCommandHandler</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">

































                        public class EsEvaluateCallForSpeechCommandHandler
                        : IRequestHandler&lt;EsEvaluateCallForSpeechCommand, EsEvaluateCallForSpeechCommandResponse&gt;
                        {
                            private readonly ISessionForEventSourcing _sessionForEventSourcing;
                            private readonly IMapper _mapper;
                            private readonly IScoringRulesFactory _scoringRulesFactory;
                        
                            public EsEvaluateCallForSpeechCommandHandler(
                                ISessionForEventSourcing sessionForEventSourcing, IMapper mapper,
                                IScoringRulesFactory scoringRulesFactory)
                            {
                                _mapper = mapper;
                                _sessionForEventSourcing = sessionForEventSourcing;
                                _scoringRulesFactory = scoringRulesFactory;
                            }
                        
                        
                            public async Task&lt;EsEvaluateCallForSpeechCommandResponse&gt; 
                            Handle(EsEvaluateCallForSpeechCommand request, CancellationToken cancellationToken)
                            {
                                var cfsuniqueId = _mapper.Map&lt;CallForSpeechUniqueId&gt;
                                    (request.CallForSpeechIdUnique);
                        
                                var eventstoreResult = Get&lt;CallForSpeechAggregate&gt;
                                    (cfsuniqueId.GetAggregateKey());
                        
                                if (!eventstoreResult.Success)
                                    return await Task.FromResult(new EsEvaluateCallForSpeechCommandResponse());
                        
                                var aggregateCallForSpeaker = eventstoreResult.Value;
                        
                                if (aggregateCallForSpeaker.Version &gt; request.Version)
                                    return new EsEvaluateCallForSpeechCommandResponse
                                        (ExecutionStatus.EventStoreConcurrencyError(@$&quot;You sended old version.
                                        Yours {request.Version}. 
                                        Should be :{aggregateCallForSpeaker.Version}&quot;));
                        
                        
                                var csf = _mapper.Map&lt;CallForSpeech&gt;(aggregateCallForSpeaker);
                        
                                var domainLogicResult = csf.TryEvaluate(_scoringRulesFactory.DefaultSet);
                                if (!domainLogicResult.Success)
                                    return new EsEvaluateCallForSpeechCommandResponse(domainLogicResult);
                        
                                aggregateCallForSpeaker.Evaulated(csf);
                                _sessionForEventSourcing.Commit();
                        
                                var scoredto = _mapper.Map&lt;ScoreDto&gt;(csf.ScoreResult);
                                return new EsEvaluateCallForSpeechCommandResponse(scoredto);
                            }
                        
                            private ExecutionStatus&lt;T&gt; Get&lt;T&gt;
                            (AggregateKey id, int? expectedVersion = null) where T : AggregateRoot
                            {
                                var a = _sessionForEventSourcing.Get&lt;T&gt;(id, expectedVersion);
                                return a;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>

    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/evaluate-call-for-speech.gif" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EsPreliminaryAcceptCallForSpeechCommand</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        public class EsPreliminaryAcceptCallForSpeechCommand
                        :
                            IRequest&lt;EsPreliminaryAcceptCallForSpeechCommandResponse&gt;
                        {
                            public Guid CallForSpeechUniqueId { get; set; }
                            public int JudgeId { get; set; }
                            public int Version { get; set; }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">EsPreliminaryAcceptCallForSpeechCommandHandler</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 15px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 15px !important;">

































                        public class EsPreliminaryAcceptCallForSpeechCommandHandler
                        : IRequestHandler&lt;EsPreliminaryAcceptCallForSpeechCommand, EsPreliminaryAcceptCallForSpeechCommandResponse&gt;
                        {
                            private readonly ISessionForEventSourcing _sessionForEventSourcing;
                            private readonly IMapper _mapper;
                            private readonly IZEsJudgeRepository _zEsJudgeRepository;
                        
                            public EsPreliminaryAcceptCallForSpeechCommandHandler(
                                ISessionForEventSourcing sessionForEventSourcing, IMapper mapper,
                                IZEsJudgeRepository zEsJudgeRepository)
                            {
                                _mapper = mapper;
                                _sessionForEventSourcing = sessionForEventSourcing;
                                _zEsJudgeRepository = zEsJudgeRepository;
                            }
                        
                        
                            public async Task&lt;EsPreliminaryAcceptCallForSpeechCommandResponse&gt;
                             Handle(EsPreliminaryAcceptCallForSpeechCommand request, CancellationToken cancellationToken)
                            {
                                var cfsuniqueId = _mapper.Map&lt;CallForSpeechUniqueId&gt;(request.CallForSpeechUniqueId);
                                var judgeId = _mapper.Map&lt;JudgeId&gt;(request.JudgeId);
                                
                                var databaseOperationJudge = await _zEsJudgeRepository.GetByIdAsync(judgeId);
                                
                                if (!databaseOperationJudge.Success)
                                    return new EsPreliminaryAcceptCallForSpeechCommandResponse
                                        (databaseOperationJudge.RemoveGeneric(),
                                        &quot;Judge Problem&quot;);
                                
                                var judge = databaseOperationJudge.Value;
                                
                                var eventstoreResult = Get&lt;CallForSpeechAggregate&gt;
                                    (cfsuniqueId.GetAggregateKey());
                                
                                if (!eventstoreResult.Success)
                                    return new EsPreliminaryAcceptCallForSpeechCommandResponse
                                        (eventstoreResult.RemoveGeneric());
                                
                                var aggregateCallForSpeaker = eventstoreResult.Value;
                                
                                if ((eventstoreResult.Value.Version - 1) &gt; (eventstoreResult.Version))
                                    return new EsPreliminaryAcceptCallForSpeechCommandResponse
                                        (ExecutionStatus.EventStoreConcurrencyError(@$&quot;You sended old version.
                                        Yours {request.Version}. Should be :{aggregateCallForSpeaker.Version - 1}&quot;));
                                
                                
                                var csf = _mapper.Map&lt;CallForSpeech&gt;(aggregateCallForSpeaker);
                                
                                var domainLogicResult = csf.TryPreliminaryAccept(judge);
                                if (!domainLogicResult.Success)
                                    return new EsPreliminaryAcceptCallForSpeechCommandResponse(domainLogicResult);
                                
                                aggregateCallForSpeaker.PreliminaryAccepted(csf);
                                _sessionForEventSourcing.Commit();
                                
                                return new EsPreliminaryAcceptCallForSpeechCommandResponse();
                            }
                        
                            private ExecutionStatus&lt;T&gt; Get&lt;T&gt;(AggregateKey id, int? expectedVersion = null) where T : AggregateRoot
                            {
                                var a = _sessionForEventSourcing.Get&lt;T&gt;(id, expectedVersion);
                                return a;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/callforspeechevething else.gif" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/kolejka-05.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/kolejka-06.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide conicG">
        <span class="shout colors" >Pora na subskrypcję strumienia zdarzeń z kolejki  <br />
            <span>RabbitMQ</span>
        </span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/background service/01.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">Constants</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 18px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 18px !important;">
                        public class Constants
                        {
                            public const string QUEUE_JUDGE_CREATED = &quot;judge_created&quot;;
                            public const string QUEUE_JUDGE_UPDATED = &quot;judge_updated&quot;;
                            public const string QUEUE_JUDGE_DELETED = &quot;judge_deleted&quot;;
                        
                            public const string QUEUE_CATEGORY_CREATED = &quot;category_created&quot;;
                            public const string QUEUE_CATEGORY_UPDATED = &quot;category_updated&quot;;
                        
                            public const string QUEUE_CALLFORSPEECH_SUBMITC = &quot;callforspeech_submit&quot;;
                            public const string QUEUE_CALLFORSPEECH_REJECTC = &quot;callforspeech_reject&quot;;
                            public const string QUEUE_CALLFORSPEECH_PRELIMINARY_ACCEPT = &quot;callforspeech_preminal_accept&quot;;
                            public const string QUEUE_CALLFORSPEECH_EVALUATE = &quot;callforspeech_evaluate&quot;;
                            public const string QUEUE_CALLFORSPEECH_ACCEPT = &quot;callforspeech_accept&quot;;
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">ISettings</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        public interface ISettings
                        {
                            TimeSpan Frequency { get; set; }
                            TimeSpan Timeout { get; set; }
                        }
                        
                        public class Settings : ISettings
                        {
                            public TimeSpan Frequency { get; set; }
                            public TimeSpan Timeout { get; set; }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">appsettings.json</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-json">
                    <code style="line-height: 19px !important;">
                        {
                            "ConnectionStrings": {
                              "GeekLemonConferenceConnectionString": "NotUsed",
                              "ZEsGeekLemonConferenceConnectionString": 
                              "DataSource=C:/Users/PanNiebieski/source/repos/GeekLemonConference/GeekLemonConference.Api/DataBase/ZEsGeekLemonDB.db"
                            },
                            "RabbitMqSetting": {
                              "username": "guest",
                              "password": "guest",
                              "hostname": "localhost",
                              "uri": "amqp://localhost:5672/",
                              "virtualhost": "/"
                            },
                            "Logging": {
                              "LogLevel": {
                                "Default": "Information",
                                "Microsoft": "Warning",
                                "Microsoft.Hosting.Lifetime": "Information"
                              }
                            },
                            "AllowedHosts": "*"
                          }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">MappingProfile</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        public class MappingProfile : Profile
                        {
                            public MappingProfile()
                            {
                                CreateMap&lt;CategoryCreateEvent, Category&gt;();
                                CreateMap&lt;CategoryUpdateEvent, Category&gt;();
                        
                                CreateMap&lt;JudgeCreatedEvent, Judge&gt;();
                                CreateMap&lt;JudgeUpdatedEvent, Judge&gt;();
                                CreateMap&lt;JudgeDeletedEvent, Judge&gt;();
                        
                                CreateMap&lt;CallForSpeechAcceptedEvent, CallForSpeech&gt;();
                                CreateMap&lt;CallForSpeechEvaulatedEvent, CallForSpeech&gt;();
                                CreateMap&lt;CallForSpeechPreliminaryAcceptEvent, CallForSpeech&gt;();
                                CreateMap&lt;CallForSpeechRejectedEvent, CallForSpeech&gt;();
                                CreateMap&lt;CallForSpeechSubmitedEvent, CallForSpeech&gt;();
                        
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">BackgroundEventHandlersServerService</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">




















































































                        public class BackgroundEventHandlersServerService : BackgroundService
                        {
                            private readonly ILogger Logger;
                            private readonly ISettings Settings;
                        
                            private readonly ISubscribeBase[] _subscribes;
                        
                            private string _ContentRootPath;
                        
                            public BackgroundEventHandlersServerService(ILogger logger, ISettings settings,
                                IHostingEnvironment env,
                                ISubscribeBase[] subscribes)
                            {
                                Settings = settings;
                                Logger = logger;
                                _subscribes = subscribes;
                        
                                _ContentRootPath = env.ContentRootPath;
                            }
                        
                        
                            protected async override Task ExecuteAsync(CancellationToken stoppingToken)
                            {
                                ConnectionFactory connectionFactory = new ConnectionFactory();
                                var builder = new ConfigurationBuilder()
                                    .SetBasePath(_ContentRootPath)
                                    .AddJsonFile(&quot;appsettings.json&quot;, optional: false, reloadOnChange: false)
                                    .AddEnvironmentVariables();
                        
                                builder.Build().GetSection(&quot;RabbitMqSetting&quot;).Bind(connectionFactory);
                        
                                using IConnection conn = connectionFactory.CreateConnection();
                                using IModel channel = conn.CreateModel();
                        
                                Console.WriteLine(&quot;CreateConnection CreateModel&quot;);
                        
                                try
                                {
                                    Console.ForegroundColor = ConsoleColor.DarkCyan;
                                    foreach (var item in _subscribes)
                                    {
                                        channel.QueueDeclare(
                                            queue: item.QUEUE_Name,
                                            durable: false,
                                            exclusive: false,
                                            autoDelete: false,
                        
                                            arguments: null
                                        );
                        
                                        Console.WriteLine($&quot;QueueDeclare {item.QUEUE_Name}&quot;);
                                    }
                        
                                    foreach (var item in _subscribes)
                                    {
                                        item.StartSubing(channel);
                                        Console.WriteLine($&quot;StartSubing {item.QUEUE_Name}&quot;);
                                    }
                                    Console.ForegroundColor = ConsoleColor.Gray;
                                }
                                catch (Exception ex)
                                {
                                    Console.ForegroundColor = ConsoleColor.Red;
                                    Console.WriteLine($&quot;Exception {ex}&quot;);
                                    Console.ForegroundColor = ConsoleColor.Gray;
                                    LogError(ex.Message);
                                }
                        
                                int i = 0;
                                while (!stoppingToken.IsCancellationRequested)
                                {
                                    i++;
                                    Console.ForegroundColor = (ConsoleColor)i;
                                    Console.WriteLine($&quot;Still Working and Still Waiting&quot;);
                                    Console.ForegroundColor = ConsoleColor.Gray;
                        
                                    if (i == 15)
                                    {
                                        Console.Clear();
                                        i = 0;
                                    }
                        
                        
                                    await Task.Delay(Settings.Frequency, stoppingToken);
                                }
                            }
                        
                            public async override Task StopAsync(CancellationToken cancellationToken)
                            {
                                foreach (var item in _subscribes)
                                {
                                    try
                                    {
                                        item.Dispose();
                                    }
                                    catch (Exception)
                                    {
                        
                                    }
                        
                                }
                        
                                await base.StopAsync(cancellationToken);
                            }
                        
                            private void LogError(string error)
                            {
                                Logger.Error(error);
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/background service/01.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/background service/diagram.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">ISubscribeBase</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 23px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 23px !important;">
                        public interface ISubscribeBase
                        {
                            string QUEUE_Name { get; }
                            DomainEvent DeserializeObject(string json);
                        
                            Task HandleBasicDeliver(string consumerTag,
                                ulong deliveryTag, bool redelivered, string exchange,
                                string routingKey,
                                IBasicProperties properties, ReadOnlyMemory&lt;byte&gt; body);
                        
                            void StartSubing(IModel channel);
                        
                            void Dispose();
                        
                            Task&lt;ExecutionStatus&gt; HandleEvent(DomainEvent @event);
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">SubscribeBase</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">























                        public abstract class SubscribeBase : ISubscribeBase
                        {
                            private MessageReceiverBase Consumer { get; set; }
                            private IModel _channel;
                        
                            public abstract string QUEUE_Name { get; }
                            public abstract DomainEvent DeserializeObject(string json);
                            public abstract Task&lt;ExecutionStatus&gt; HandleEvent(DomainEvent @event);
                        
                            public void StartSubing(IModel channel)
                            {
                                _channel = channel;
                                Consumer = new MessageReceiverBase(channel, this);
                                channel.BasicConsume(this.QUEUE_Name,
                                                   false, Consumer);
                            }
                        
                            public async Task HandleBasicDeliver(string consumerTag, ulong deliveryTag,
                                bool redelivered, string exchange, string routingKey, IBasicProperties
                                properties, ReadOnlyMemory&lt;byte&gt; body)
                            {
                                var json = Encoding.UTF8.GetString(body.Span);
                                var obj = DeserializeObject(json);
                                var status = await HandleEvent(obj);
                        
                                if (status.Success)
                                {
                                    try
                                    {
                                        _channel.BasicAck(deliveryTag, false);
                                    }
                                    catch (Exception ex)
                                    {
                        
                                        throw;
                                    }
                                }
                        
                            }
                        
                            public void Dispose()
                            {
                                Consumer.Dispose();
                            }
                        
                            
                        
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">MessageReceiverBase</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">













                        public class MessageReceiverBase : DefaultBasicConsumer
                        {
                            private readonly IModel _channel;
                    
                            private ISubscribeBase _messageReceiverBasez;
                    
                            public MessageReceiverBase(IModel channel, ISubscribeBase messageReceiverBasez)
                            {
                                _messageReceiverBasez = messageReceiverBasez;
                                _channel = channel;
                            }
                    
                            public override void HandleBasicDeliver(string consumerTag,
                                ulong deliveryTag, bool redelivered, string exchange,
                                string routingKey,
                                IBasicProperties properties,  ReadOnlyMemory&lt;byte&gt; body)
                            {
                    
                                Console.ForegroundColor = ConsoleColor.DarkGreen;
                                Console.WriteLine($"Consuming Message");
                                Console.WriteLine(string.Concat("Message received from the exchange ", exchange));
                                Console.WriteLine(string.Concat("Consumer tag: ", consumerTag));
                                Console.WriteLine(string.Concat("Delivery tag: ", deliveryTag));
                                Console.WriteLine(string.Concat("Routing tag: ", routingKey));
                    
                                var json = Encoding.UTF8.GetString(body.Span);
                                Console.WriteLine(string.Concat("Message: ", json));
                                Console.ForegroundColor = ConsoleColor.Gray;

                                _messageReceiverBasez.HandleBasicDeliver
                                    (consumerTag, deliveryTag, redelivered, exchange, routingKey, properties, body);
                    
                            }

                            public void Dispose()
                            {_channel.Dispose();}
                                     
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">SubscribeCreatedCategory</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">







                        public class SubscribeCreatedCategory : SubscribeBase
                        {
                            private IZEsCategoryRepository _zEsCategoryRepository;
                            private IMapper _mapper;
                        
                            public SubscribeCreatedCategory(IZEsCategoryRepository ZEsCategoryRepository,
                                IMapper mapper)
                            {
                                _zEsCategoryRepository = ZEsCategoryRepository;
                                _mapper = mapper;
                            }
                        

                            public override string QUEUE_Name =&gt; Constants.QUEUE_CATEGORY_CREATED;
                        

                            public override DomainEvent DeserializeObject(string json)
                            {
                                return JsonConvert.DeserializeObject&lt;CategoryCreateEvent&gt;(json);
                            }
                        

                            public async override Task&lt;ExecutionStatus&gt; HandleEvent(DomainEvent @event)
                            {
                                CategoryCreateEvent categoryCreateEvent = @event as CategoryCreateEvent;
                        
                                var category = _mapper.Map&lt;Category&gt;(categoryCreateEvent);
                        
                                var execution = await _zEsCategoryRepository.AddAsync(category);
                        
                                return execution.RemoveGeneric();
                            }

                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AppTime, aby czas można było testować</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        



                        




                        public class SubscribeUpdateCategory : SubscribeBase
                        {
                            private IZEsCategoryRepository _zEsCategoryRepository;
                            private IMapper _mapper;
                        
                            public SubscribeUpdateCategory(IZEsCategoryRepository ZEsCategoryRepository,
                                IMapper mapper)
                            {
                                _zEsCategoryRepository = ZEsCategoryRepository;
                                _mapper = mapper;
                            }
                        

                            public override string QUEUE_Name =&gt; Constants.QUEUE_CATEGORY_UPDATED;
                        

                            public override DomainEvent DeserializeObject(string json)
                            {
                                return JsonConvert.DeserializeObject&lt;CategoryUpdateEvent&gt;(json);
                            }
                        
                            public override async Task&lt;ExecutionStatus&gt; HandleEvent(DomainEvent @event)
                            {
                                CategoryUpdateEvent categoryCreateEvent = @event as CategoryUpdateEvent;
                        
                                var category = _mapper.Map&lt;Category&gt;(categoryCreateEvent);
                        
                                var execution = await
                                    _zEsCategoryRepository.UpdateByUniqueIdAsync(category);
                        
                                return execution;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">SubscribeDeleteJudge</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">








                        public class SubscribeDeleteJudge : SubscribeBase
                        {
                            private IZEsJudgeRepository _zEsJudgeRepository;
                            private IMapper _mapper;
                        
                            public SubscribeDeleteJudge(IZEsJudgeRepository zEsJudgeRepository,
                                IMapper mapper) :
                                base()
                            {
                                _zEsJudgeRepository = zEsJudgeRepository;
                                _mapper = mapper;
                            }
                        


                            public override string QUEUE_Name =&gt; Constants.QUEUE_JUDGE_DELETED;
                        


                            public override DomainEvent DeserializeObject(string json)
                            {
                                return JsonConvert.DeserializeObject&lt;JudgeDeletedEvent&gt;(json);
                            }
                        
                            public override async Task&lt;ExecutionStatus&gt; HandleEvent(DomainEvent @event)
                            {
                                JudgeDeletedEvent judgeDeletedEvent = @event as JudgeDeletedEvent;
                        
                                var execution = await
                                    _zEsJudgeRepository.DeleteAsync(judgeDeletedEvent.UniqueId);
                        
                                return execution;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">SubscribeSubmitCallForSpeech</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 17px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 17px !important;">



                        


                        



                        public class SubscribeSubmitCallForSpeech : SubscribeBase
                        {
                            private IZEsCallForSpeechRepository _ZEsCallForSpeechRepository;
                            private IMapper _mapper;
                    
                            public SubscribeSubmitCallForSpeech
                                (IZEsCallForSpeechRepository zEsCallForSpeechRepository,
                                IMapper mapper) :
                                base()
                            {
                                _ZEsCallForSpeechRepository = zEsCallForSpeechRepository;
                                _mapper = mapper;
                            }
                    
                    

                            public override string QUEUE_Name =&gt; Constants.QUEUE_CALLFORSPEECH_SUBMITC;
                    


                            public override DomainEvent DeserializeObject(string json)
                            {
                                return JsonConvert.DeserializeObject&lt;CallForSpeechSubmitedEvent&gt;(json);
                            }
                    
                            public async override Task&lt;ExecutionStatus&gt; HandleEvent(DomainEvent @event)
                            {
                                CallForSpeechSubmitedEvent CallForSpeechSubmitedEvent 
                                = @event as CallForSpeechSubmitedEvent;
                    
                                var cfs = _mapper.Map&lt;CallForSpeech&gt;(CallForSpeechSubmitedEvent);
                    
                                var execution = await
                                    _ZEsCallForSpeechRepository.SubmitAsync(cfs);
                    
                                return execution.RemoveGeneric();
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">SubscribeEvaluateCallForSpeech</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 17px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 17px !important;">












                        public class SubscribeEvaluateCallForSpeech : SubscribeBase
                        {
                            private IZEsCallForSpeechRepository _ZEsCallForSpeechRepository;
                            private IMapper _mapper;
                        
                            public SubscribeEvaluateCallForSpeech(
                                IZEsCallForSpeechRepository zEsCallForSpeechRepository,
                                IMapper mapper) :
                                base()
                            {
                                _ZEsCallForSpeechRepository = zEsCallForSpeechRepository;
                                _mapper = mapper;
                            }
                        


                            public override string QUEUE_Name =&gt; Constants.QUEUE_CALLFORSPEECH_EVALUATE;
                        


                            public override DomainEvent DeserializeObject(string json)
                            {
                                return JsonConvert.DeserializeObject&lt;CallForSpeechEvaulatedEvent&gt;(json);
                            }
                        
                            public async override Task&lt;ExecutionStatus&gt; HandleEvent(DomainEvent @event)
                            {
                                CallForSpeechEvaulatedEvent callForSpeechRejectedEvent =
                                    @event as CallForSpeechEvaulatedEvent;
                        
                                var cfs = _mapper.Map&lt;CallForSpeech&gt;(callForSpeechRejectedEvent);
                        
                                var execution = await
                                    _ZEsCallForSpeechRepository
                                    .SaveEvaluatationAsync
                                    (cfs.UniqueId, cfs.ScoreResult, cfs.Status);
                        
                                return execution;
                            }
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide creamGG">
        <span class="shout colors" ><span>Ważne jest zaznaczenie, że wiadomość została przez z nas obsłużona
        </span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">SubscribeBase BasicAck</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">
                        public abstract class SubscribeBase : ISubscribeBase
                        {
                            ................................
                            public async Task HandleBasicDeliver(string consumerTag, ulong deliveryTag,
                                bool redelivered, string exchange, string routingKey, IBasicProperties
                                properties, ReadOnlyMemory&lt;byte&gt; body)
                            {
                                var json = Encoding.UTF8.GetString(body.Span);
                                var obj = DeserializeObject(json);
                                var status = await HandleEvent(obj);
                            
                                if (status.Success)
                                {
                                    try
                                    {
                                        _channel.BasicAck(deliveryTag, false);
                                    }
                                    catch (Exception ex)
                                    {
                                        throw;
                                    }
                                }
                            
                            }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide creamGG">
        <span class="shout colors" ><span>Jak wstrzykiwanie zależności wygląda w tym projekcie ?
        </span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">Startup</h2>
            </div>
            <div class="PlaceCodeHere canscroll">
                <pre style="font-size: 19px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 19px !important;">


















                        public class Startup
                        {
                            public IConfiguration Configuration { get; }
                        
                            public Startup(IConfiguration configuration)
                            {
                                Configuration = configuration;
                            }
                        
                            public void ConfigureServices(IServiceCollection services)
                            {
                                services.AddAutoMapper(Assembly.GetExecutingAssembly());
                                services.AddGeekLemonPersistenceDapperSQLiteServices(Configuration);
                        
                                var seriFileLogger = new LoggerConfiguration()
                                .WriteTo.File(@&quot;D:\Temp\&quot;).CreateLogger();

                                services.AddSingleton&lt;Serilog.ILogger&gt;(seriFileLogger);
                        
                                services.AddSingleton&lt;ISettings&gt;(new Settings()
                                {
                                    Timeout = TimeSpan.FromSeconds(5),
                                    Frequency = TimeSpan.FromSeconds(5),
                                });
                        
                                services.AddTransient&lt;ISubscribeBase, SubscribeCreateJudge&gt;();
                                services.AddTransient&lt;ISubscribeBase, SubscribeUpdateJudge&gt;();
                                services.AddTransient&lt;ISubscribeBase, SubscribeDeleteJudge&gt;();
                                services.AddTransient&lt;ISubscribeBase, SubscribeCreatedCategory&gt;();
                                services.AddTransient&lt;ISubscribeBase, SubscribeUpdateCategory&gt;();
                                services.AddTransient&lt;ISubscribeBase, SubscribeSubmitCallForSpeech&gt;();
                                services.AddTransient&lt;ISubscribeBase, SubscribeRejectCallForSpeech&gt;();
                                services.AddTransient&lt;ISubscribeBase, SubscribePreminalAcceptCallForSpeech&gt;();
                                services.AddTransient&lt;ISubscribeBase, SubscribeEvaluateCallForSpeech&gt;();
                                services.AddTransient&lt;ISubscribeBase, SubscribeAcceptCallForSpeech&gt;();
                        
                                services.AddTransient&lt;ISubscribeBase[]&gt;
                                    (p =&gt; p.GetServices&lt;ISubscribeBase&gt;().ToArray());
                        
                                services.AddHostedService&lt;BackgroundEventHandlersServerService&gt;();
                            }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">Configure</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 23px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 23px !important;">



                        public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
                        {
                            if (env.IsDevelopment())
                            {
                                app.UseDeveloperExceptionPage();
                            }
                
                            app.UseRouting();
                
                            app.UseEndpoints(endpoints =>
                            {
                                endpoints.MapGet("/", async context =>
                                {
                                    await context.
                                    Response.WriteAsync
                                    ("GeekLemonConference.Infrastructure.BackgroundEventHandlersServer Working");
                                });
                            });
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/background service/04.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamGG">
        <span class="shout colors" ><span>Masz duży problem jeśli skopałeś (de)serializację
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/background service/05.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamGG">
        <span class="shout colors" ><span>Jak działa ta aplikacja w tle
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/background service/06.PNG" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/eventstore/howthisworks.gif" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide conicG">
        <span class="shout colors" >Skończyliśmy naszą aplikację GeekLemonConference<br />
           <span> 🥳
        </span></span>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/CQRS-03.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/CQRS-04.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/CQRS-05.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamPPPGragient">
        <span class="shout colors" >Fakty i mity EventSourcing <br />
           <span> 🤔
        </span></span>
    </section>
          
    <section class="slide creamPP   compact ">
        <h2>Fakty i mity EventSourcing </h2>
        <ol class="nonumbers">
            <li class="">Nie musisz mieć oddzielnej bazy</li>
            <li class="next">Nie musisz mieć kolejki</li>
            <li class="next">Nie musi to być baza NoSql (MongoDB)</li>
            <li class="next">Nie musi używać EventSourcingu 😆</li>
        </ol>
    </section>
    <section class="slide creamPPPGragient">
        <span class="shout colors" >Faktyczne aby zrozumieć 
            EventSourcing trzeba najpierw napisać najmniej złożone rozwiązania<br />
           <span> 😵
        </span></span>
    </section>
    <section class="slide creamGrey">
        <span class="shout colors" ><span>Czy teraz dla Ciebie EventStorming jest dla Ciebie czytelny.
            <br />🗒️
        </span></span>
    </section>
    <section class="slide" style="background-color:black">
        <figure>
            <img class="cover" src="pictures/event-storming-legend.jpg" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/corobi-zes.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/corobi3-zes.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/corobi4-zes.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/corobi5-zes.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide" style="background-color:white">
        <figure>
            <img class="cover" src="pictures/ADOBE/corobi6-zes.png" alt="blog">
            <figcaption class="white">Copyright © 2021 Diagram</figcaption>
        </figure>
    </section>
    <section class="slide creamG">
        <span class="shout colors" ><span>Podsumowanie
        </span></span>
    </section>
    <section class="slide prism over bhgry">
        <div class="grid-container">
            <div class="HeaderTitle PP PP"> 
                <h2 class="headerCODE PP PP">AppTime, aby czas można było testować</h2>
            </div>
            <div class="PlaceCodeHere">
                <pre style="font-size: 29px;overflow: hidden;  " class="language-csharp">
                    <code style="line-height: 29px !important;">
                        public class AppTime
                        {
                            public static Func&lt;DateTime&gt; CurrentTimeProvider
                            { get; set; } = () =&gt; DateTime.Now;
                                            
                            public static DateTime Now() =&gt; CurrentTimeProvider();
                        }
                    </code>
                </pre>
            </div>
        </div>
    </section>

    <!-- <div class="progress"></div> -->
    <footer class="badge badge-top-left">
        <a href="#" class="fullscreen">Fullscreen</a>
    </footer>

    <script src="vendors/gamepad/gamepad.js"></script>
    <script src="vendors/shower/shower.min.js"></script>
    <script src="vendors/shower-gamepad/shower.gamepad.js"></script>

    <!-- Prism.js -->
    <script src="vendors/prism/prism.js"></script>
    <script src="vendors/prism/custom-prism.js"></script>

</body>

</html>